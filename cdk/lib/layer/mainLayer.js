"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const resourceawarestack_1 = require("../resourceawarestack");
const securityLayer_1 = require("./securityLayer");
const configurationLayer_1 = require("./configurationLayer");
const storageLayer_1 = require("./storageLayer");
const databaseLayer_1 = require("./databaseLayer");
const ingestionConsumptionLayer_1 = require("./ingestionConsumptionLayer");
const processingLayer_1 = require("./processingLayer");
class MainLayer extends resourceawarestack_1.ResourceAwareStack {
    constructor(scope, id, props) {
        super(scope, id, props);
        this.buildResources();
    }
    buildResources() {
        // security layer
        let securityLayer = new securityLayer_1.SecurityLayer(this, 'SecurityLayer', this.properties);
        // configuration layer
        let configLayerProps = new resourceawarestack_1.ParameterAwareProps(this.properties);
        let ssmProperties = new Map();
        ssmProperties.set("Region", this.region);
        ssmProperties.set("ClientId", securityLayer.getUserPoolClientId());
        ssmProperties.set("UserpoolId", securityLayer.getUserPoolId());
        ssmProperties.set("UserPoolURL", securityLayer.getUserPoolUrl());
        ssmProperties.set("IdentityPoolId", securityLayer.getIdentityPoolId());
        // MISSING PARAMETER - Uncomment the next line to create the parameter
        // ssmProperties.set("Session", "null");
        configLayerProps.addParameter('ssmParameters', ssmProperties);
        // MISSING PARAMETER  - side effect - uncomment the next line to fix it
        // let configLayer =
        new configurationLayer_1.ConfigurationLayer(this, 'ConfigurationLayer', configLayerProps);
        // storage layer
        let storageLayer = new storageLayer_1.StorageLayer(this, 'StorageStorage', this.properties);
        // UNCOMMENT the following section if you want to have the CDN created. It will take 20 minutes to build/destroy
        /*
        let cdnLayerProps = new ParameterAwareProps(this.properties);
        cdnLayerProps.addParameter('appbucket',storageLayer.getResource('appbucket'));
          new ContentDeliveryLayer(this,'ContentDeliveryLayer',cdnLayerProps);
          */
        // database layer
        let databaseLayer = new databaseLayer_1.DatabaseLayer(this, 'DatabaseLayer', this.properties);
        // processing layer
        let processingLayerProps = new resourceawarestack_1.ParameterAwareProps(this.properties);
        // MISSING PARAMETER - side effect - uncomment the next line
        // processingLayerProps.addParameter('parameter.session', configLayer.getResource('parameter.session'));
        processingLayerProps.addParameter('table.sessionControl', databaseLayer.getResource('table.sessionControl'));
        processingLayerProps.addParameter('table.sessionTopX', databaseLayer.getResource('table.sessionTopX'));
        processingLayerProps.addParameter('table.session', databaseLayer.getResource('table.session'));
        let processingLayer = new processingLayer_1.ProcessingLayer(this, 'ProcessingLayer', processingLayerProps);
        // Ingestion/consumption layer
        let ingestionConsumptionLayerProps = new resourceawarestack_1.ParameterAwareProps(processingLayerProps);
        ingestionConsumptionLayerProps.addParameter('rawbucketarn', storageLayer.getRawDataBucketArn());
        ingestionConsumptionLayerProps.addParameter('userpool', securityLayer.getUserPoolArn());
        ingestionConsumptionLayerProps.addParameter('userpoolid', securityLayer.getUserPoolId());
        ingestionConsumptionLayerProps.addParameter('table.session', databaseLayer.getResource('table.session'));
        ingestionConsumptionLayerProps.addParameter('table.sessiontopx', databaseLayer.getResource('table.sessiontopx'));
        ingestionConsumptionLayerProps.addParameter('lambda.allocate', processingLayer.getAllocateFunctionRef());
        ingestionConsumptionLayerProps.addParameter('lambda.deallocate', processingLayer.getDeallocateFunctionArn());
        ingestionConsumptionLayerProps.addParameter('lambda.scoreboard', processingLayer.getScoreboardFunctionRef());
        ingestionConsumptionLayerProps.addParameter('security.playersrole', securityLayer.getResource('security.playersrole'));
        ingestionConsumptionLayerProps.addParameter('security.managersrole', securityLayer.getResource('security.managersrole'));
        new ingestionConsumptionLayer_1.IngestionConsumptionLayer(this, 'IngestionConsumptionLayer', ingestionConsumptionLayerProps);
    }
}
exports.MainLayer = MainLayer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbkxheWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbkxheWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsOERBQXFHO0FBRXJHLG1EQUFnRDtBQUNoRCw2REFBMEQ7QUFDMUQsaURBQThDO0FBQzlDLG1EQUFnRDtBQUNoRCwyRUFBd0U7QUFDeEUsdURBQW9EO0FBSXBELE1BQWEsU0FBVSxTQUFRLHVDQUFrQjtJQUUvQyxZQUFZLEtBQVUsRUFBRSxFQUFVLEVBQUUsS0FBNEI7UUFDOUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFRCxjQUFjO1FBRVosaUJBQWlCO1FBQ2pCLElBQUksYUFBYSxHQUNmLElBQUksNkJBQWEsQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUU1RCxzQkFBc0I7UUFDdEIsSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLHdDQUFtQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVoRSxJQUFJLGFBQWEsR0FBRyxJQUFJLEdBQUcsRUFBaUIsQ0FBQztRQUM3QyxhQUFhLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsYUFBYSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQztRQUNuRSxhQUFhLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxhQUFhLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQztRQUMvRCxhQUFhLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxhQUFhLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQztRQUNqRSxhQUFhLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLGFBQWEsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLENBQUM7UUFDdkUsc0VBQXNFO1FBQ3RFLHdDQUF3QztRQUN4QyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsZUFBZSxFQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzdELHVFQUF1RTtRQUN4RSxvQkFBb0I7UUFDakIsSUFBSSx1Q0FBa0IsQ0FBQyxJQUFJLEVBQUUsb0JBQW9CLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztRQUV2RSxnQkFBZ0I7UUFDaEIsSUFBSSxZQUFZLEdBQ2QsSUFBSSwyQkFBWSxDQUFDLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFHNUQsZ0hBQWdIO1FBQ2hIOzs7O1lBSUk7UUFHSixpQkFBaUI7UUFDakIsSUFBSSxhQUFhLEdBQ2YsSUFBSSw2QkFBYSxDQUFDLElBQUksRUFBRSxlQUFlLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTVELG1CQUFtQjtRQUNuQixJQUFJLG9CQUFvQixHQUFHLElBQUksd0NBQW1CLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BFLDREQUE0RDtRQUM1RCx3R0FBd0c7UUFDdEcsb0JBQW9CLENBQUMsWUFBWSxDQUFDLHNCQUFzQixFQUFFLGFBQWEsQ0FBQyxXQUFXLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO1FBQzdHLG9CQUFvQixDQUFDLFlBQVksQ0FBQyxtQkFBbUIsRUFBRSxhQUFhLENBQUMsV0FBVyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQztRQUN2RyxvQkFBb0IsQ0FBQyxZQUFZLENBQUMsZUFBZSxFQUFFLGFBQWEsQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztRQUNqRyxJQUFJLGVBQWUsR0FBRyxJQUFJLGlDQUFlLENBQUMsSUFBSSxFQUFFLGlCQUFpQixFQUFFLG9CQUFvQixDQUFDLENBQUM7UUFFekYsOEJBQThCO1FBQzlCLElBQUksOEJBQThCLEdBQUcsSUFBSSx3Q0FBbUIsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBQ25GLDhCQUE4QixDQUFDLFlBQVksQ0FBQyxjQUFjLEVBQUUsWUFBWSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQztRQUNoRyw4QkFBOEIsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFDLGFBQWEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZGLDhCQUE4QixDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsYUFBYSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUM7UUFDekYsOEJBQThCLENBQUMsWUFBWSxDQUFDLGVBQWUsRUFBQyxhQUFhLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7UUFDeEcsOEJBQThCLENBQUMsWUFBWSxDQUFDLG1CQUFtQixFQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDO1FBQ2hILDhCQUE4QixDQUFDLFlBQVksQ0FBQyxpQkFBaUIsRUFBQyxlQUFlLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxDQUFDO1FBQ3hHLDhCQUE4QixDQUFDLFlBQVksQ0FBQyxtQkFBbUIsRUFBQyxlQUFlLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDO1FBQzVHLDhCQUE4QixDQUFDLFlBQVksQ0FBQyxtQkFBbUIsRUFBQyxlQUFlLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDO1FBQzVHLDhCQUE4QixDQUFDLFlBQVksQ0FBQyxzQkFBc0IsRUFBRSxhQUFhLENBQUMsV0FBVyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQztRQUN2SCw4QkFBOEIsQ0FBQyxZQUFZLENBQUMsdUJBQXVCLEVBQUUsYUFBYSxDQUFDLFdBQVcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUM7UUFDekgsSUFBSSxxREFBeUIsQ0FBQyxJQUFJLEVBQUUsMkJBQTJCLEVBQUMsOEJBQThCLENBQUMsQ0FBQztJQUNsRyxDQUFDO0NBQ0Y7QUFyRUQsOEJBcUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwIH0gZnJvbSAnQGF3cy1jZGsvY2RrJztcbmltcG9ydCB7IElQYXJhbWV0ZXJBd2FyZVByb3BzLCBQYXJhbWV0ZXJBd2FyZVByb3BzLCBSZXNvdXJjZUF3YXJlU3RhY2t9IGZyb20gJy4uL3Jlc291cmNlYXdhcmVzdGFjayc7XG5cbmltcG9ydCB7IFNlY3VyaXR5TGF5ZXIgfSBmcm9tICcuL3NlY3VyaXR5TGF5ZXInO1xuaW1wb3J0IHsgQ29uZmlndXJhdGlvbkxheWVyIH0gZnJvbSAnLi9jb25maWd1cmF0aW9uTGF5ZXInO1xuaW1wb3J0IHsgU3RvcmFnZUxheWVyIH0gZnJvbSAnLi9zdG9yYWdlTGF5ZXInO1xuaW1wb3J0IHsgRGF0YWJhc2VMYXllciB9IGZyb20gJy4vZGF0YWJhc2VMYXllcic7XG5pbXBvcnQgeyBJbmdlc3Rpb25Db25zdW1wdGlvbkxheWVyIH0gZnJvbSAnLi9pbmdlc3Rpb25Db25zdW1wdGlvbkxheWVyJztcbmltcG9ydCB7IFByb2Nlc3NpbmdMYXllciB9IGZyb20gJy4vcHJvY2Vzc2luZ0xheWVyJztcbmltcG9ydCB7IENvbnRlbnREZWxpdmVyeUxheWVyIH0gZnJvbSAnLi9jb250ZW50RGVsaXZlcnlMYXllcic7XG5cblxuZXhwb3J0IGNsYXNzIE1haW5MYXllciBleHRlbmRzIFJlc291cmNlQXdhcmVTdGFjayAge1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBBcHAsIGlkOiBzdHJpbmcsIHByb3BzPzogSVBhcmFtZXRlckF3YXJlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQsIHByb3BzKTtcbiAgICB0aGlzLmJ1aWxkUmVzb3VyY2VzKCk7XG4gIH1cblxuICBidWlsZFJlc291cmNlcygpIHtcblxuICAgIC8vIHNlY3VyaXR5IGxheWVyXG4gICAgbGV0IHNlY3VyaXR5TGF5ZXIgPVxuICAgICAgbmV3IFNlY3VyaXR5TGF5ZXIodGhpcywgJ1NlY3VyaXR5TGF5ZXInLCB0aGlzLnByb3BlcnRpZXMpO1xuICAgIFxuICAgIC8vIGNvbmZpZ3VyYXRpb24gbGF5ZXJcbiAgICBsZXQgY29uZmlnTGF5ZXJQcm9wcyA9IG5ldyBQYXJhbWV0ZXJBd2FyZVByb3BzKHRoaXMucHJvcGVydGllcyk7XG4gICAgXG4gICAgbGV0IHNzbVByb3BlcnRpZXMgPSBuZXcgTWFwPHN0cmluZyxzdHJpbmc+KCk7XG4gICAgc3NtUHJvcGVydGllcy5zZXQoXCJSZWdpb25cIiwgdGhpcy5yZWdpb24pO1xuICAgIHNzbVByb3BlcnRpZXMuc2V0KFwiQ2xpZW50SWRcIiwgc2VjdXJpdHlMYXllci5nZXRVc2VyUG9vbENsaWVudElkKCkpO1xuICAgIHNzbVByb3BlcnRpZXMuc2V0KFwiVXNlcnBvb2xJZFwiLCBzZWN1cml0eUxheWVyLmdldFVzZXJQb29sSWQoKSk7XG4gICAgc3NtUHJvcGVydGllcy5zZXQoXCJVc2VyUG9vbFVSTFwiLCBzZWN1cml0eUxheWVyLmdldFVzZXJQb29sVXJsKCkpO1xuICAgIHNzbVByb3BlcnRpZXMuc2V0KFwiSWRlbnRpdHlQb29sSWRcIiwgc2VjdXJpdHlMYXllci5nZXRJZGVudGl0eVBvb2xJZCgpKTtcbiAgICAvLyBNSVNTSU5HIFBBUkFNRVRFUiAtIFVuY29tbWVudCB0aGUgbmV4dCBsaW5lIHRvIGNyZWF0ZSB0aGUgcGFyYW1ldGVyXG4gICAgLy8gc3NtUHJvcGVydGllcy5zZXQoXCJTZXNzaW9uXCIsIFwibnVsbFwiKTtcbiAgICBjb25maWdMYXllclByb3BzLmFkZFBhcmFtZXRlcignc3NtUGFyYW1ldGVycycsc3NtUHJvcGVydGllcyk7XG4gICAgLy8gTUlTU0lORyBQQVJBTUVURVIgIC0gc2lkZSBlZmZlY3QgLSB1bmNvbW1lbnQgdGhlIG5leHQgbGluZSB0byBmaXggaXRcbiAgIC8vIGxldCBjb25maWdMYXllciA9XG4gICAgICBuZXcgQ29uZmlndXJhdGlvbkxheWVyKHRoaXMsICdDb25maWd1cmF0aW9uTGF5ZXInLCBjb25maWdMYXllclByb3BzKTtcblxuICAgIC8vIHN0b3JhZ2UgbGF5ZXJcbiAgICBsZXQgc3RvcmFnZUxheWVyID1cbiAgICAgIG5ldyBTdG9yYWdlTGF5ZXIodGhpcywgJ1N0b3JhZ2VTdG9yYWdlJywgdGhpcy5wcm9wZXJ0aWVzKTtcblxuXG4gICAgLy8gVU5DT01NRU5UIHRoZSBmb2xsb3dpbmcgc2VjdGlvbiBpZiB5b3Ugd2FudCB0byBoYXZlIHRoZSBDRE4gY3JlYXRlZC4gSXQgd2lsbCB0YWtlIDIwIG1pbnV0ZXMgdG8gYnVpbGQvZGVzdHJveVxuICAgIC8qXG4gICAgbGV0IGNkbkxheWVyUHJvcHMgPSBuZXcgUGFyYW1ldGVyQXdhcmVQcm9wcyh0aGlzLnByb3BlcnRpZXMpO1xuICAgIGNkbkxheWVyUHJvcHMuYWRkUGFyYW1ldGVyKCdhcHBidWNrZXQnLHN0b3JhZ2VMYXllci5nZXRSZXNvdXJjZSgnYXBwYnVja2V0JykpO1xuICAgICAgbmV3IENvbnRlbnREZWxpdmVyeUxheWVyKHRoaXMsJ0NvbnRlbnREZWxpdmVyeUxheWVyJyxjZG5MYXllclByb3BzKTtcbiAgICAgICovXG5cblxuICAgIC8vIGRhdGFiYXNlIGxheWVyXG4gICAgbGV0IGRhdGFiYXNlTGF5ZXIgPVxuICAgICAgbmV3IERhdGFiYXNlTGF5ZXIodGhpcywgJ0RhdGFiYXNlTGF5ZXInLCB0aGlzLnByb3BlcnRpZXMpO1xuICAgIFxuICAgIC8vIHByb2Nlc3NpbmcgbGF5ZXJcbiAgICBsZXQgcHJvY2Vzc2luZ0xheWVyUHJvcHMgPSBuZXcgUGFyYW1ldGVyQXdhcmVQcm9wcyh0aGlzLnByb3BlcnRpZXMpO1xuICAgIC8vIE1JU1NJTkcgUEFSQU1FVEVSIC0gc2lkZSBlZmZlY3QgLSB1bmNvbW1lbnQgdGhlIG5leHQgbGluZVxuICAgIC8vIHByb2Nlc3NpbmdMYXllclByb3BzLmFkZFBhcmFtZXRlcigncGFyYW1ldGVyLnNlc3Npb24nLCBjb25maWdMYXllci5nZXRSZXNvdXJjZSgncGFyYW1ldGVyLnNlc3Npb24nKSk7XG4gICAgICBwcm9jZXNzaW5nTGF5ZXJQcm9wcy5hZGRQYXJhbWV0ZXIoJ3RhYmxlLnNlc3Npb25Db250cm9sJywgZGF0YWJhc2VMYXllci5nZXRSZXNvdXJjZSgndGFibGUuc2Vzc2lvbkNvbnRyb2wnKSk7XG4gICAgICBwcm9jZXNzaW5nTGF5ZXJQcm9wcy5hZGRQYXJhbWV0ZXIoJ3RhYmxlLnNlc3Npb25Ub3BYJywgZGF0YWJhc2VMYXllci5nZXRSZXNvdXJjZSgndGFibGUuc2Vzc2lvblRvcFgnKSk7XG4gICAgICBwcm9jZXNzaW5nTGF5ZXJQcm9wcy5hZGRQYXJhbWV0ZXIoJ3RhYmxlLnNlc3Npb24nLCBkYXRhYmFzZUxheWVyLmdldFJlc291cmNlKCd0YWJsZS5zZXNzaW9uJykpO1xuICAgIGxldCBwcm9jZXNzaW5nTGF5ZXIgPSBuZXcgUHJvY2Vzc2luZ0xheWVyKHRoaXMsICdQcm9jZXNzaW5nTGF5ZXInLCBwcm9jZXNzaW5nTGF5ZXJQcm9wcyk7XG5cbiAgICAvLyBJbmdlc3Rpb24vY29uc3VtcHRpb24gbGF5ZXJcbiAgICBsZXQgaW5nZXN0aW9uQ29uc3VtcHRpb25MYXllclByb3BzID0gbmV3IFBhcmFtZXRlckF3YXJlUHJvcHMocHJvY2Vzc2luZ0xheWVyUHJvcHMpO1xuICAgIGluZ2VzdGlvbkNvbnN1bXB0aW9uTGF5ZXJQcm9wcy5hZGRQYXJhbWV0ZXIoJ3Jhd2J1Y2tldGFybicsIHN0b3JhZ2VMYXllci5nZXRSYXdEYXRhQnVja2V0QXJuKCkpO1xuICAgIGluZ2VzdGlvbkNvbnN1bXB0aW9uTGF5ZXJQcm9wcy5hZGRQYXJhbWV0ZXIoJ3VzZXJwb29sJyxzZWN1cml0eUxheWVyLmdldFVzZXJQb29sQXJuKCkpO1xuICAgIGluZ2VzdGlvbkNvbnN1bXB0aW9uTGF5ZXJQcm9wcy5hZGRQYXJhbWV0ZXIoJ3VzZXJwb29saWQnLCBzZWN1cml0eUxheWVyLmdldFVzZXJQb29sSWQoKSk7XG4gICAgaW5nZXN0aW9uQ29uc3VtcHRpb25MYXllclByb3BzLmFkZFBhcmFtZXRlcigndGFibGUuc2Vzc2lvbicsZGF0YWJhc2VMYXllci5nZXRSZXNvdXJjZSgndGFibGUuc2Vzc2lvbicpKTtcbiAgICBpbmdlc3Rpb25Db25zdW1wdGlvbkxheWVyUHJvcHMuYWRkUGFyYW1ldGVyKCd0YWJsZS5zZXNzaW9udG9weCcsZGF0YWJhc2VMYXllci5nZXRSZXNvdXJjZSgndGFibGUuc2Vzc2lvbnRvcHgnKSk7XG4gICAgaW5nZXN0aW9uQ29uc3VtcHRpb25MYXllclByb3BzLmFkZFBhcmFtZXRlcignbGFtYmRhLmFsbG9jYXRlJyxwcm9jZXNzaW5nTGF5ZXIuZ2V0QWxsb2NhdGVGdW5jdGlvblJlZigpKTtcbiAgICBpbmdlc3Rpb25Db25zdW1wdGlvbkxheWVyUHJvcHMuYWRkUGFyYW1ldGVyKCdsYW1iZGEuZGVhbGxvY2F0ZScscHJvY2Vzc2luZ0xheWVyLmdldERlYWxsb2NhdGVGdW5jdGlvbkFybigpKTtcbiAgICBpbmdlc3Rpb25Db25zdW1wdGlvbkxheWVyUHJvcHMuYWRkUGFyYW1ldGVyKCdsYW1iZGEuc2NvcmVib2FyZCcscHJvY2Vzc2luZ0xheWVyLmdldFNjb3JlYm9hcmRGdW5jdGlvblJlZigpKTtcbiAgICBpbmdlc3Rpb25Db25zdW1wdGlvbkxheWVyUHJvcHMuYWRkUGFyYW1ldGVyKCdzZWN1cml0eS5wbGF5ZXJzcm9sZScsIHNlY3VyaXR5TGF5ZXIuZ2V0UmVzb3VyY2UoJ3NlY3VyaXR5LnBsYXllcnNyb2xlJykpO1xuICAgIGluZ2VzdGlvbkNvbnN1bXB0aW9uTGF5ZXJQcm9wcy5hZGRQYXJhbWV0ZXIoJ3NlY3VyaXR5Lm1hbmFnZXJzcm9sZScsIHNlY3VyaXR5TGF5ZXIuZ2V0UmVzb3VyY2UoJ3NlY3VyaXR5Lm1hbmFnZXJzcm9sZScpKTtcbiAgICBuZXcgSW5nZXN0aW9uQ29uc3VtcHRpb25MYXllcih0aGlzLCAnSW5nZXN0aW9uQ29uc3VtcHRpb25MYXllcicsaW5nZXN0aW9uQ29uc3VtcHRpb25MYXllclByb3BzKTsgXG4gIH1cbn0iXX0=