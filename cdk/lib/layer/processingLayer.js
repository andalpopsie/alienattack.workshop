"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const resourceawarestack_1 = require("./../resourceawarestack");
const Lambda = require("@aws-cdk/aws-lambda");
const IAM = require("@aws-cdk/aws-iam");
const SQS = require("@aws-cdk/aws-sqs");
const path = require('path');
const lambdasLocation = path.join(__dirname, '..', '..', 'lambdas');
class ProcessingLayer extends resourceawarestack_1.ResourceAwareConstruct {
    getAllocateFunctionArn() {
        return this.allocateFunction.functionArn;
    }
    getAllocateFunctionRef() {
        return this.allocateFunction;
    }
    getDeallocateFunctionArn() {
        return this.deallocateFunction.functionArn;
        ;
    }
    getScoreboardFunctionArn() {
        return this.scoreboardFunction.functionArn;
    }
    getScoreboardFunctionRef() {
        return this.scoreboardFunction;
    }
    constructor(parent, name, props) {
        super(parent, name, props);
        let createdFunction = null;
        createdFunction = this.getAllocateGamerFunction();
        if (createdFunction)
            this.allocateFunction = createdFunction;
        createdFunction = this.getDeallocateGamerFunction();
        if (createdFunction)
            this.deallocateFunction = createdFunction;
        createdFunction = this.getScoreboardFunction();
        if (createdFunction)
            this.scoreboardFunction = createdFunction;
    }
    getAllocateGamerFunction() {
        /**
    * This function requires access to
    * SystemsManager
    *      process.env.SESSION_PARAMETER = /<getAppRefName>/session
    * DynamoDB Tables
    *      process.env.SESSION_CONTROL_TABLENAME = getAppRefName+'SessionControl'
    */
        // MISSING PARAMETER - side effect - remove the next line, uncomment the next one.
        let sessionParameter = { parameterName: '/' + this.properties.getAppRefName().toLocaleLowerCase() + '/session' };
        //let sessionParameter : CfnParameter = <CfnParameter> this.properties.getParameter('parameter.session');
        let sessionControlTable = this.properties.getParameter('table.sessioncontrol');
        if (sessionParameter && sessionControlTable) {
            let createdFunction = new Lambda.Function(this, this.properties.getAppRefName() + 'AllocateGamerFn', {
                runtime: Lambda.Runtime.NodeJS610,
                handler: 'index.handler',
                code: Lambda.Code.asset(path.join(lambdasLocation, 'allocateGamer')),
                environment: {
                    'SESSION_CONTROL_TABLENAME': sessionControlTable.tableName,
                    'SESSION_PARAMETER': sessionParameter.parameterName
                },
                functionName: this.properties.getAppRefName() + 'AllocateGamerFn',
                description: 'This function supports the allocation of gamers when the game is to start',
                memorySize: 128,
                timeout: 60,
                role: new IAM.Role(this, this.properties.getAppRefName() + 'AllocateGamerFn_Role', {
                    roleName: this.properties.getAppRefName() + 'AllocateGamerFn_Role',
                    assumedBy: new IAM.ServicePrincipal('lambda.amazonaws.com'),
                    managedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole'],
                    inlinePolicies: {
                        'DynamoDBPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource(sessionControlTable.tableArn)
                            .addAction('dynamodb:GetItem')
                            .addAction('dynamodb:UpdateItem')
                            .addAction('dynamodb:Scan')
                            .addAction('dynamodb:Query')),
                        'SystemsManagerPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:ssm:' + this.properties.region + ':' + this.properties.accountId + ':parameter' + sessionParameter.parameterName)
                            .addAction('ssm:GetParameter')
                            .addAction('ssm:GetParameters')),
                    }
                })
            });
            return createdFunction;
        }
        else
            return undefined;
    }
    getDeallocateGamerFunction() {
        /**
         * This function requires access to
         * SystemsManager
         *      process.env.SESSION_PARAMETER = /<getAppRefName>/session
         * DynamoDB Tables
         *      process.env.SESSION_CONTROL_TABLENAME = getAppRefName+'SessionControl'
         */
        // MISSING PARAMETER - side effect - remove the next line, uncomment the next one.
        let sessionParameter = { parameterName: '/' + this.properties.getAppRefName().toLocaleLowerCase() + '/session' };
        //let sessionParameter: CfnParameter = <CfnParameter>  this.properties.getParameter('parameter.session');
        let sessionControlTable = this.properties.getParameter('table.sessionControl');
        if (sessionParameter && sessionControlTable) {
            let createdFunction = new Lambda.Function(this, this.properties.getAppRefName() + 'DeallocateGamerFn', {
                runtime: Lambda.Runtime.NodeJS610,
                handler: 'index.handler',
                code: Lambda.Code.asset(path.join(lambdasLocation, 'deallocateGamer')),
                environment: {
                    'SESSION_CONTROL_TABLENAME': sessionControlTable.tableName,
                    'SESSION_PARAMETER': sessionParameter.parameterName
                },
                functionName: this.properties.getAppRefName() + 'DeallocateGamerFn',
                description: 'This function deallocates the gamer when a relevant event is identified (sign out, close window etc)',
                memorySize: 128,
                timeout: 60,
                role: new IAM.Role(this, this.properties.getAppRefName() + 'DeallocateGamerFn_Role', {
                    roleName: this.properties.getAppRefName() + 'DeallocateGamerFn_Role',
                    assumedBy: new IAM.ServicePrincipal('lambda.amazonaws.com'),
                    managedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole'],
                    inlinePolicies: {
                        'DynamoDBPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource(sessionControlTable.tableArn)
                            .addAction('dynamodb:GetItem')
                            .addAction('dynamodb:UpdateItem')
                            .addAction('dynamodb:Scan')
                            .addAction('dynamodb:Query')),
                        'SystemsManagerPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:ssm:' + this.properties.region + ':' + this.properties.accountId + ':parameter' + sessionParameter.parameterName)
                            .addAction('ssm:GetParameter')
                            .addAction('ssm:GetParameters')),
                    }
                })
            });
            return createdFunction;
        }
        else
            return undefined;
    }
    getScoreboardFunction() {
        let dlq = new SQS.Queue(this, this.properties.getAppRefName() + 'DLQ', {
            queueName: this.properties.getAppRefName() + 'DLQ'
        });
        /**
         * This function requires access to
         * Queue
         *      process.env.DLQ_URL = "https://sqs.us-east-1.amazonaws.com/232189948602/SpaceInvaders_DLQ"
         * SystemsManager
         *      process.env.SESSION_PARAMETER = /<getAppRefName>/session
         * DynamoDB Tables
         *      process.env.SESSION_TABLENAME = getAppRefName+'Session'
         *      process.env.SESSION_CONTROL_TABLENAME = getAppRefName+'SessionControl'
         *      process.env.SESSIONTOPX_TABLENAME = getAppRefName+'SessionTopX'
         */
        // MISSING PARAMETER - side effect - remove the next line, uncomment the next one.
        let sessionParameter = { parameterName: '/' + this.properties.getAppRefName().toLocaleLowerCase() + '/session' };
        //let sessionParameter: CfnParameter | undefined = <CfnParameter> this.properties.getParameter('parameter.session');
        let sessionControlTable = this.properties.getParameter('table.sessionControl');
        let sessionTopX = this.properties.getParameter('table.sessionTopX');
        let sessionTable = this.properties.getParameter('table.session');
        if (sessionParameter && sessionControlTable && sessionTopX && sessionTable) {
            let createdFunction = new Lambda.Function(this, this.properties.getAppRefName() + 'ScoreboardFn', {
                runtime: Lambda.Runtime.NodeJS610,
                handler: 'index.handler',
                code: Lambda.Code.asset(path.join(lambdasLocation, 'scoreboard')),
                environment: {
                    'DLQ_URL': dlq.queueUrl,
                    'SESSION_PARAMETER': sessionParameter.parameterName,
                    'SESSION_TABLENAME': sessionTable.tableName,
                    'SESSION_CONTROL_TABLENAME': sessionControlTable.tableName,
                    'SESSION_TOPX_TABLENAME': sessionTopX.tableName,
                    'TopXValue': '10'
                },
                functionName: this.properties.getAppRefName() + 'ScoreboardFn',
                description: 'This function computes the scoreboard',
                memorySize: 128,
                timeout: 60,
                role: new IAM.Role(this, this.properties.getAppRefName() + 'ScoreboardFn_Role', {
                    roleName: this.properties.getAppRefName() + 'ScoreboardFn_Role',
                    assumedBy: new IAM.ServicePrincipal('lambda.amazonaws.com'),
                    managedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole'],
                    inlinePolicies: {
                        'DynamoDBPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:dynamodb:' + this.properties.region + ':' + this.properties.accountId + ':table/' + this.properties.getAppRefName() + '*')
                            .addAction('dynamodb:GetItem')
                            .addAction('dynamodb:UpdateItem')
                            .addAction('dynamodb:Scan')
                            .addAction('dynamodb:Query')
                            .addAction('dynamodb:Batch*')
                            .addAction('dynamodb:PutItem')
                            .addAction('dynamodb:DeleteItem')),
                        'SystemsManagerPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:ssm:' + this.properties.region + ':' + this.properties.accountId + ':parameter/' + this.properties.getAppRefName().toLowerCase() + '*')
                            .addAction('ssm:Get*')
                            .addAction('ssm:Get*')
                            .addAction('ssm:List*')),
                        'SQSPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource(dlq.queueArn)
                            .addAction('sqs:SendMessage')),
                        'KinesisPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addActions("kinesis:SubscribeToShard", "kinesis:GetShardIterator", "kinesis:GetRecords", "kinesis:DescribeStream")
                            .addAllResources())
                    }
                })
            });
            return createdFunction;
        }
        else
            return undefined;
    }
}
exports.ProcessingLayer = ProcessingLayer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzc2luZ0xheWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicHJvY2Vzc2luZ0xheWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsZ0VBQXNGO0FBRXRGLDhDQUErQztBQUMvQyx3Q0FBeUM7QUFFekMsd0NBQXlDO0FBS3pDLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUU3QixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBQyxJQUFJLEVBQUMsSUFBSSxFQUFDLFNBQVMsQ0FBQyxDQUFDO0FBRWpFLE1BQWEsZUFBZ0IsU0FBUSwyQ0FBc0I7SUFHaEQsc0JBQXNCO1FBQ3pCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztJQUM3QyxDQUFDO0lBQ00sc0JBQXNCO1FBQ3pCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDO0lBQ2pDLENBQUM7SUFHTSx3QkFBd0I7UUFDM0IsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDO1FBQUEsQ0FBQztJQUNoRCxDQUFDO0lBR00sd0JBQXdCO1FBQzNCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQztJQUMvQyxDQUFDO0lBQ00sd0JBQXdCO1FBQzNCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDO0lBQ25DLENBQUM7SUFFRCxZQUFZLE1BQWlCLEVBQUUsSUFBWSxFQUFFLEtBQTJCO1FBQ3BFLEtBQUssQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzNCLElBQUksZUFBZSxHQUF1QyxJQUFJLENBQUM7UUFFL0QsZUFBZSxHQUFHLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1FBQ2xELElBQUksZUFBZTtZQUFFLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxlQUFlLENBQUM7UUFFN0QsZUFBZSxHQUFHLElBQUksQ0FBQywwQkFBMEIsRUFBRSxDQUFDO1FBQ3BELElBQUksZUFBZTtZQUFFLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxlQUFlLENBQUM7UUFFL0QsZUFBZSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBQy9DLElBQUksZUFBZTtZQUFFLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxlQUFlLENBQUM7SUFFbkUsQ0FBQztJQUVPLHdCQUF3QjtRQUM1Qjs7Ozs7O01BTUY7UUFDRSxrRkFBa0Y7UUFDbEYsSUFBSSxnQkFBZ0IsR0FBRyxFQUFFLGFBQWEsRUFBRyxHQUFHLEdBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxHQUFDLFVBQVUsRUFBQyxDQUFDO1FBQzdHLHlHQUF5RztRQUN6RyxJQUFJLG1CQUFtQixHQUFtQixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQy9GLElBQUksZ0JBQWdCLElBQUksbUJBQW1CLEVBQUU7WUFDekMsSUFBSSxlQUFlLEdBQ2YsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxHQUFHLGlCQUFpQixFQUFFO2dCQUMzRSxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTO2dCQUNqQyxPQUFPLEVBQUUsZUFBZTtnQkFDeEIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFDLGVBQWUsQ0FBQyxDQUFDO2dCQUNuRSxXQUFXLEVBQUU7b0JBQ1QsMkJBQTJCLEVBQUUsbUJBQW1CLENBQUMsU0FBUztvQkFDMUQsbUJBQW1CLEVBQUUsZ0JBQWdCLENBQUMsYUFBYTtpQkFDdEQ7Z0JBQ0MsWUFBWSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLEdBQUcsaUJBQWlCO2dCQUNqRSxXQUFXLEVBQUUsMkVBQTJFO2dCQUN4RixVQUFVLEVBQUUsR0FBRztnQkFDZixPQUFPLEVBQUUsRUFBRTtnQkFDWCxJQUFJLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxHQUFHLHNCQUFzQixFQUFFO29CQUNqRixRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsR0FBRyxzQkFBc0I7b0JBQ2hFLFNBQVMsRUFBRSxJQUFJLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBc0IsQ0FBQztvQkFDM0QsaUJBQWlCLEVBQUUsQ0FBQyxrRUFBa0UsQ0FBQztvQkFDdkYsY0FBYyxFQUFFO3dCQUNkLHFCQUFxQixFQUNqQixJQUFJLEdBQUcsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxZQUFZLENBQ2pDLElBQUksR0FBRyxDQUFDLGVBQWUsRUFBRTs2QkFDcEIsS0FBSyxFQUFFOzZCQUNQLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUM7NkJBQ3pDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQzs2QkFDN0IsU0FBUyxDQUFDLHFCQUFxQixDQUFDOzZCQUNoQyxTQUFTLENBQUMsZUFBZSxDQUFDOzZCQUMxQixTQUFTLENBQUMsZ0JBQWdCLENBQUMsQ0FDbkM7d0JBQ0wsMkJBQTJCLEVBQ3ZCLElBQUksR0FBRyxDQUFDLGNBQWMsRUFBRSxDQUFDLFlBQVksQ0FDakMsSUFBSSxHQUFHLENBQUMsZUFBZSxFQUFFOzZCQUNwQixLQUFLLEVBQUU7NkJBQ1AsV0FBVyxDQUFDLGNBQWMsR0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBQyxHQUFHLEdBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEdBQUMsWUFBWSxHQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQzs2QkFDNUgsU0FBUyxDQUFDLGtCQUFrQixDQUFDOzZCQUM3QixTQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FDdEM7cUJBQ1I7aUJBQ0osQ0FBQzthQUNMLENBQUMsQ0FBQztZQUNQLE9BQU8sZUFBZSxDQUFDO1NBQzFCOztZQUNJLE9BQU8sU0FBUyxDQUFDO0lBQzFCLENBQUM7SUFFTywwQkFBMEI7UUFDOUI7Ozs7OztXQU1HO1FBQ0gsa0ZBQWtGO1FBQ2xGLElBQUksZ0JBQWdCLEdBQUcsRUFBRSxhQUFhLEVBQUcsR0FBRyxHQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLENBQUMsaUJBQWlCLEVBQUUsR0FBQyxVQUFVLEVBQUMsQ0FBQztRQUM3Ryx5R0FBeUc7UUFDekcsSUFBSSxtQkFBbUIsR0FBOEIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUMxRyxJQUFJLGdCQUFnQixJQUFJLG1CQUFtQixFQUFFO1lBQ3pDLElBQUksZUFBZSxHQUNmLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsR0FBRyxtQkFBbUIsRUFBRTtnQkFDN0UsT0FBTyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUztnQkFDakMsT0FBTyxFQUFFLGVBQWU7Z0JBQ3hCLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBQyxpQkFBaUIsQ0FBQyxDQUFDO2dCQUNyRSxXQUFXLEVBQUU7b0JBQ1QsMkJBQTJCLEVBQUUsbUJBQW1CLENBQUMsU0FBUztvQkFDMUQsbUJBQW1CLEVBQUUsZ0JBQWdCLENBQUMsYUFBYTtpQkFDdEQ7Z0JBQ0MsWUFBWSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLEdBQUcsbUJBQW1CO2dCQUNuRSxXQUFXLEVBQUUsc0dBQXNHO2dCQUNuSCxVQUFVLEVBQUUsR0FBRztnQkFDZixPQUFPLEVBQUUsRUFBRTtnQkFDWCxJQUFJLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxHQUFHLHdCQUF3QixFQUFFO29CQUNuRixRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsR0FBRyx3QkFBd0I7b0JBQ2xFLFNBQVMsRUFBRSxJQUFJLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxzQkFBc0IsQ0FBQztvQkFDM0QsaUJBQWlCLEVBQUUsQ0FBQyxrRUFBa0UsQ0FBQztvQkFDdkYsY0FBYyxFQUFFO3dCQUNkLHFCQUFxQixFQUNqQixJQUFJLEdBQUcsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxZQUFZLENBQ2pDLElBQUksR0FBRyxDQUFDLGVBQWUsRUFBRTs2QkFDcEIsS0FBSyxFQUFFOzZCQUNQLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUM7NkJBQ3pDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQzs2QkFDN0IsU0FBUyxDQUFDLHFCQUFxQixDQUFDOzZCQUNoQyxTQUFTLENBQUMsZUFBZSxDQUFDOzZCQUMxQixTQUFTLENBQUMsZ0JBQWdCLENBQUMsQ0FDbkM7d0JBQ0wsMkJBQTJCLEVBQ3ZCLElBQUksR0FBRyxDQUFDLGNBQWMsRUFBRSxDQUFDLFlBQVksQ0FDakMsSUFBSSxHQUFHLENBQUMsZUFBZSxFQUFFOzZCQUNwQixLQUFLLEVBQUU7NkJBQ1AsV0FBVyxDQUFDLGNBQWMsR0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBQyxHQUFHLEdBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEdBQUMsWUFBWSxHQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQzs2QkFDNUgsU0FBUyxDQUFDLGtCQUFrQixDQUFDOzZCQUM3QixTQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FDdEM7cUJBQ1I7aUJBQ0osQ0FBQzthQUNMLENBQUMsQ0FBQztZQUNQLE9BQU8sZUFBZSxDQUFDO1NBQzFCOztZQUNJLE9BQU8sU0FBUyxDQUFDO0lBQzFCLENBQUM7SUFFTyxxQkFBcUI7UUFFekIsSUFBSSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxHQUFHLEtBQUssRUFBRTtZQUNuRSxTQUFTLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsR0FBRyxLQUFLO1NBQ3JELENBQUMsQ0FBQTtRQUVGOzs7Ozs7Ozs7O1dBVUc7UUFDSCxrRkFBa0Y7UUFDbEYsSUFBSSxnQkFBZ0IsR0FBRyxFQUFFLGFBQWEsRUFBRyxHQUFHLEdBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxHQUFDLFVBQVUsRUFBQyxDQUFDO1FBQzdHLG9IQUFvSDtRQUNwSCxJQUFJLG1CQUFtQixHQUE4QixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1FBQzFHLElBQUksV0FBVyxHQUE4QixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQy9GLElBQUksWUFBWSxHQUE4QixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUM1RixJQUFJLGdCQUFnQixJQUFJLG1CQUFtQixJQUFJLFdBQVcsSUFBSSxZQUFZLEVBQUU7WUFDeEUsSUFBSSxlQUFlLEdBQ2YsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxHQUFHLGNBQWMsRUFBRTtnQkFDeEUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUztnQkFDakMsT0FBTyxFQUFFLGVBQWU7Z0JBQ3hCLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBQyxZQUFZLENBQUMsQ0FBQztnQkFDaEUsV0FBVyxFQUFFO29CQUNULFNBQVMsRUFBRSxHQUFHLENBQUMsUUFBUTtvQkFDdkIsbUJBQW1CLEVBQUUsZ0JBQWdCLENBQUMsYUFBYTtvQkFDbkQsbUJBQW1CLEVBQUUsWUFBWSxDQUFDLFNBQVM7b0JBQzNDLDJCQUEyQixFQUFFLG1CQUFtQixDQUFDLFNBQVM7b0JBQzFELHdCQUF3QixFQUFFLFdBQVcsQ0FBQyxTQUFTO29CQUMvQyxXQUFXLEVBQUUsSUFBSTtpQkFDcEI7Z0JBQ0MsWUFBWSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLEdBQUcsY0FBYztnQkFDOUQsV0FBVyxFQUFFLHVDQUF1QztnQkFDcEQsVUFBVSxFQUFFLEdBQUc7Z0JBQ2YsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsSUFBSSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsR0FBRyxtQkFBbUIsRUFBRTtvQkFDOUUsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLEdBQUcsbUJBQW1CO29CQUM3RCxTQUFTLEVBQUUsSUFBSSxHQUFHLENBQUMsZ0JBQWdCLENBQUMsc0JBQXNCLENBQUM7b0JBQzNELGlCQUFpQixFQUFFLENBQUMsa0VBQWtFLENBQUM7b0JBQ3ZGLGNBQWMsRUFBRTt3QkFDZCxxQkFBcUIsRUFDakIsSUFBSSxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUMsWUFBWSxDQUNqQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLEVBQUU7NkJBQ3BCLEtBQUssRUFBRTs2QkFDUCxXQUFXLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxHQUFHLFNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsRUFBRSxHQUFHLEdBQUcsQ0FBQzs2QkFDL0ksU0FBUyxDQUFDLGtCQUFrQixDQUFDOzZCQUM3QixTQUFTLENBQUMscUJBQXFCLENBQUM7NkJBQ2hDLFNBQVMsQ0FBQyxlQUFlLENBQUM7NkJBQzFCLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQzs2QkFDM0IsU0FBUyxDQUFDLGlCQUFpQixDQUFDOzZCQUM1QixTQUFTLENBQUMsa0JBQWtCLENBQUM7NkJBQzdCLFNBQVMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUN4Qzt3QkFDTCwyQkFBMkIsRUFDdkIsSUFBSSxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUMsWUFBWSxDQUNqQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLEVBQUU7NkJBQ3BCLEtBQUssRUFBRTs2QkFDUCxXQUFXLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsR0FBRyxhQUFhLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxXQUFXLEVBQUUsR0FBRyxHQUFHLENBQUM7NkJBQzVKLFNBQVMsQ0FBQyxVQUFVLENBQUM7NkJBQ3JCLFNBQVMsQ0FBQyxVQUFVLENBQUM7NkJBQ3JCLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FDOUI7d0JBQ0wsZ0JBQWdCLEVBQ1osSUFBSSxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUMsWUFBWSxDQUNqQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLEVBQUU7NkJBQ3BCLEtBQUssRUFBRTs2QkFDUCxXQUFXLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQzs2QkFDekIsU0FBUyxDQUFDLGlCQUFpQixDQUFDLENBQ3BDO3dCQUNMLG9CQUFvQixFQUNoQixJQUFJLEdBQUcsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxZQUFZLENBQ2pDLElBQUksR0FBRyxDQUFDLGVBQWUsRUFBRTs2QkFDcEIsS0FBSyxFQUFFOzZCQUNQLFVBQVUsQ0FDUCwwQkFBMEIsRUFDMUIsMEJBQTBCLEVBQzFCLG9CQUFvQixFQUNwQix3QkFBd0IsQ0FDM0I7NkJBQ0EsZUFBZSxFQUFFLENBQ3pCO3FCQUNSO2lCQUNKLENBQUM7YUFDTCxDQUFDLENBQUM7WUFDUCxPQUFPLGVBQWUsQ0FBQztTQUMxQjs7WUFDSSxPQUFPLFNBQVMsQ0FBQztJQUMxQixDQUFDO0NBRUo7QUF2UEQsMENBdVBDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnQGF3cy1jZGsvY2RrJztcbmltcG9ydCB7IFJlc291cmNlQXdhcmVDb25zdHJ1Y3QsIElQYXJhbWV0ZXJBd2FyZVByb3BzIH0gZnJvbSAnLi8uLi9yZXNvdXJjZWF3YXJlc3RhY2snXG5cbmltcG9ydCBMYW1iZGEgPSByZXF1aXJlKCdAYXdzLWNkay9hd3MtbGFtYmRhJyk7XG5pbXBvcnQgSUFNID0gcmVxdWlyZSgnQGF3cy1jZGsvYXdzLWlhbScpO1xuXG5pbXBvcnQgU1FTID0gcmVxdWlyZSgnQGF3cy1jZGsvYXdzLXNxcycpO1xuLy8gTUlTU0lORyBQQVJBTUVURVIgIC0gc2lkZSBlZmZlY3QgLSB1bmNvbW1lbnQgdGhlIG5leHQgbGluZSB0byBmaXggaXRcbi8vIGltcG9ydCB7IENmblBhcmFtZXRlciB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1zc20nO1xuaW1wb3J0IHsgVGFibGUgfSBmcm9tICdAYXdzLWNkay9hd3MtZHluYW1vZGInO1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG5jb25zdCBsYW1iZGFzTG9jYXRpb24gPSBwYXRoLmpvaW4oX19kaXJuYW1lLCcuLicsJy4uJywnbGFtYmRhcycpOy5cblxuZXhwb3J0IGNsYXNzIFByb2Nlc3NpbmdMYXllciBleHRlbmRzIFJlc291cmNlQXdhcmVDb25zdHJ1Y3Qge1xuXG4gICAgcHJpdmF0ZSBhbGxvY2F0ZUZ1bmN0aW9uOiBMYW1iZGEuRnVuY3Rpb247XG4gICAgcHVibGljIGdldEFsbG9jYXRlRnVuY3Rpb25Bcm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFsbG9jYXRlRnVuY3Rpb24uZnVuY3Rpb25Bcm47XG4gICAgfVxuICAgIHB1YmxpYyBnZXRBbGxvY2F0ZUZ1bmN0aW9uUmVmKCkgOiBMYW1iZGEuRnVuY3Rpb24ge1xuICAgICAgICByZXR1cm4gdGhpcy5hbGxvY2F0ZUZ1bmN0aW9uO1xuICAgIH1cblxuICAgIHByaXZhdGUgZGVhbGxvY2F0ZUZ1bmN0aW9uOiBMYW1iZGEuRnVuY3Rpb247XG4gICAgcHVibGljIGdldERlYWxsb2NhdGVGdW5jdGlvbkFybigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVhbGxvY2F0ZUZ1bmN0aW9uLmZ1bmN0aW9uQXJuOztcbiAgICB9XG5cbiAgICBwcml2YXRlIHNjb3JlYm9hcmRGdW5jdGlvbiA6IExhbWJkYS5GdW5jdGlvbjtcbiAgICBwdWJsaWMgZ2V0U2NvcmVib2FyZEZ1bmN0aW9uQXJuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zY29yZWJvYXJkRnVuY3Rpb24uZnVuY3Rpb25Bcm47XG4gICAgfVxuICAgIHB1YmxpYyBnZXRTY29yZWJvYXJkRnVuY3Rpb25SZWYoKSA6IExhbWJkYS5GdW5jdGlvbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjb3JlYm9hcmRGdW5jdGlvbjtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQ6IENvbnN0cnVjdCwgbmFtZTogc3RyaW5nLCBwcm9wczogSVBhcmFtZXRlckF3YXJlUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocGFyZW50LCBuYW1lLCBwcm9wcyk7XG4gICAgICAgIGxldCBjcmVhdGVkRnVuY3Rpb246IExhbWJkYS5GdW5jdGlvbiB8IHVuZGVmaW5lZCB8IG51bGwgPSBudWxsO1xuXG4gICAgICAgIGNyZWF0ZWRGdW5jdGlvbiA9IHRoaXMuZ2V0QWxsb2NhdGVHYW1lckZ1bmN0aW9uKCk7XG4gICAgICAgIGlmIChjcmVhdGVkRnVuY3Rpb24pIHRoaXMuYWxsb2NhdGVGdW5jdGlvbiA9IGNyZWF0ZWRGdW5jdGlvbjtcblxuICAgICAgICBjcmVhdGVkRnVuY3Rpb24gPSB0aGlzLmdldERlYWxsb2NhdGVHYW1lckZ1bmN0aW9uKCk7XG4gICAgICAgIGlmIChjcmVhdGVkRnVuY3Rpb24pIHRoaXMuZGVhbGxvY2F0ZUZ1bmN0aW9uID0gY3JlYXRlZEZ1bmN0aW9uO1xuXG4gICAgICAgIGNyZWF0ZWRGdW5jdGlvbiA9IHRoaXMuZ2V0U2NvcmVib2FyZEZ1bmN0aW9uKCk7XG4gICAgICAgIGlmIChjcmVhdGVkRnVuY3Rpb24pIHRoaXMuc2NvcmVib2FyZEZ1bmN0aW9uID0gY3JlYXRlZEZ1bmN0aW9uO1xuICAgICAgICBcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEFsbG9jYXRlR2FtZXJGdW5jdGlvbigpIHtcbiAgICAgICAgLyoqXG4gICAgKiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIGFjY2VzcyB0byBcbiAgICAqIFN5c3RlbXNNYW5hZ2VyXG4gICAgKiAgICAgIHByb2Nlc3MuZW52LlNFU1NJT05fUEFSQU1FVEVSID0gLzxnZXRBcHBSZWZOYW1lPi9zZXNzaW9uXG4gICAgKiBEeW5hbW9EQiBUYWJsZXNcbiAgICAqICAgICAgcHJvY2Vzcy5lbnYuU0VTU0lPTl9DT05UUk9MX1RBQkxFTkFNRSA9IGdldEFwcFJlZk5hbWUrJ1Nlc3Npb25Db250cm9sJ1xuICAgICovXG4gICAgICAgIC8vIE1JU1NJTkcgUEFSQU1FVEVSIC0gc2lkZSBlZmZlY3QgLSByZW1vdmUgdGhlIG5leHQgbGluZSwgdW5jb21tZW50IHRoZSBuZXh0IG9uZS5cbiAgICAgICAgbGV0IHNlc3Npb25QYXJhbWV0ZXIgPSB7IHBhcmFtZXRlck5hbWUgOiAnLycrdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKS50b0xvY2FsZUxvd2VyQ2FzZSgpKycvc2Vzc2lvbid9O1xuICAgICAgICAvL2xldCBzZXNzaW9uUGFyYW1ldGVyIDogQ2ZuUGFyYW1ldGVyID0gPENmblBhcmFtZXRlcj4gdGhpcy5wcm9wZXJ0aWVzLmdldFBhcmFtZXRlcigncGFyYW1ldGVyLnNlc3Npb24nKTtcbiAgICAgICAgbGV0IHNlc3Npb25Db250cm9sVGFibGUgOiBUYWJsZSA9IDxUYWJsZT4gdGhpcy5wcm9wZXJ0aWVzLmdldFBhcmFtZXRlcigndGFibGUuc2Vzc2lvbmNvbnRyb2wnKTtcbiAgICAgICAgaWYgKHNlc3Npb25QYXJhbWV0ZXIgJiYgc2Vzc2lvbkNvbnRyb2xUYWJsZSkge1xuICAgICAgICAgICAgbGV0IGNyZWF0ZWRGdW5jdGlvbjogTGFtYmRhLkZ1bmN0aW9uID1cbiAgICAgICAgICAgICAgICBuZXcgTGFtYmRhLkZ1bmN0aW9uKHRoaXMsIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnQWxsb2NhdGVHYW1lckZuJywge1xuICAgICAgICAgICAgICAgICAgICBydW50aW1lOiBMYW1iZGEuUnVudGltZS5Ob2RlSlM2MTAsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6ICdpbmRleC5oYW5kbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgY29kZTogTGFtYmRhLkNvZGUuYXNzZXQocGF0aC5qb2luKGxhbWJkYXNMb2NhdGlvbiwnYWxsb2NhdGVHYW1lcicpKSxcbiAgICAgICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdTRVNTSU9OX0NPTlRST0xfVEFCTEVOQU1FJzogc2Vzc2lvbkNvbnRyb2xUYWJsZS50YWJsZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnU0VTU0lPTl9QQVJBTUVURVInOiBzZXNzaW9uUGFyYW1ldGVyLnBhcmFtZXRlck5hbWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAsIGZ1bmN0aW9uTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdBbGxvY2F0ZUdhbWVyRm4nXG4gICAgICAgICAgICAgICAgICAgICwgZGVzY3JpcHRpb246ICdUaGlzIGZ1bmN0aW9uIHN1cHBvcnRzIHRoZSBhbGxvY2F0aW9uIG9mIGdhbWVycyB3aGVuIHRoZSBnYW1lIGlzIHRvIHN0YXJ0J1xuICAgICAgICAgICAgICAgICAgICAsIG1lbW9yeVNpemU6IDEyOFxuICAgICAgICAgICAgICAgICAgICAsIHRpbWVvdXQ6IDYwXG4gICAgICAgICAgICAgICAgICAgICwgcm9sZTogbmV3IElBTS5Sb2xlKHRoaXMsIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnQWxsb2NhdGVHYW1lckZuX1JvbGUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb2xlTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdBbGxvY2F0ZUdhbWVyRm5fUm9sZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICwgYXNzdW1lZEJ5OiBuZXcgSUFNLlNlcnZpY2VQcmluY2lwYWwoJ2xhbWJkYS5hbWF6b25hd3MuY29tJylcbiAgICAgICAgICAgICAgICAgICAgICAgICwgbWFuYWdlZFBvbGljeUFybnM6IFsnYXJuOmF3czppYW06OmF3czpwb2xpY3kvc2VydmljZS1yb2xlL0FXU0xhbWJkYUJhc2ljRXhlY3V0aW9uUm9sZSddXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGlubGluZVBvbGljaWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0R5bmFtb0RCUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKHNlc3Npb25Db250cm9sVGFibGUudGFibGVBcm4pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6R2V0SXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6VXBkYXRlSXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6U2NhbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6UXVlcnknKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTeXN0ZW1zTWFuYWdlclBlcm1pc3Npb25zJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lEb2N1bWVudCgpLmFkZFN0YXRlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5U3RhdGVtZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxsb3coKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRSZXNvdXJjZSgnYXJuOmF3czpzc206Jyt0aGlzLnByb3BlcnRpZXMucmVnaW9uKyc6Jyt0aGlzLnByb3BlcnRpZXMuYWNjb3VudElkKyc6cGFyYW1ldGVyJytzZXNzaW9uUGFyYW1ldGVyLnBhcmFtZXRlck5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3NtOkdldFBhcmFtZXRlcicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3NtOkdldFBhcmFtZXRlcnMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWRGdW5jdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREZWFsbG9jYXRlR2FtZXJGdW5jdGlvbigpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgYWNjZXNzIHRvIFxuICAgICAgICAgKiBTeXN0ZW1zTWFuYWdlclxuICAgICAgICAgKiAgICAgIHByb2Nlc3MuZW52LlNFU1NJT05fUEFSQU1FVEVSID0gLzxnZXRBcHBSZWZOYW1lPi9zZXNzaW9uXG4gICAgICAgICAqIER5bmFtb0RCIFRhYmxlc1xuICAgICAgICAgKiAgICAgIHByb2Nlc3MuZW52LlNFU1NJT05fQ09OVFJPTF9UQUJMRU5BTUUgPSBnZXRBcHBSZWZOYW1lKydTZXNzaW9uQ29udHJvbCdcbiAgICAgICAgICovXG4gICAgICAgIC8vIE1JU1NJTkcgUEFSQU1FVEVSIC0gc2lkZSBlZmZlY3QgLSByZW1vdmUgdGhlIG5leHQgbGluZSwgdW5jb21tZW50IHRoZSBuZXh0IG9uZS5cbiAgICAgICAgbGV0IHNlc3Npb25QYXJhbWV0ZXIgPSB7IHBhcmFtZXRlck5hbWUgOiAnLycrdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKS50b0xvY2FsZUxvd2VyQ2FzZSgpKycvc2Vzc2lvbid9O1xuICAgICAgICAvL2xldCBzZXNzaW9uUGFyYW1ldGVyOiBDZm5QYXJhbWV0ZXIgPSA8Q2ZuUGFyYW1ldGVyPiAgdGhpcy5wcm9wZXJ0aWVzLmdldFBhcmFtZXRlcigncGFyYW1ldGVyLnNlc3Npb24nKTtcbiAgICAgICAgbGV0IHNlc3Npb25Db250cm9sVGFibGU6IFRhYmxlIHwgdW5kZWZpbmVkID0gPFRhYmxlPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCd0YWJsZS5zZXNzaW9uQ29udHJvbCcpO1xuICAgICAgICBpZiAoc2Vzc2lvblBhcmFtZXRlciAmJiBzZXNzaW9uQ29udHJvbFRhYmxlKSB7XG4gICAgICAgICAgICBsZXQgY3JlYXRlZEZ1bmN0aW9uOiBMYW1iZGEuRnVuY3Rpb24gPVxuICAgICAgICAgICAgICAgIG5ldyBMYW1iZGEuRnVuY3Rpb24odGhpcywgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdEZWFsbG9jYXRlR2FtZXJGbicsIHtcbiAgICAgICAgICAgICAgICAgICAgcnVudGltZTogTGFtYmRhLlJ1bnRpbWUuTm9kZUpTNjEwLFxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiAnaW5kZXguaGFuZGxlcicsXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IExhbWJkYS5Db2RlLmFzc2V0KHBhdGguam9pbihsYW1iZGFzTG9jYXRpb24sJ2RlYWxsb2NhdGVHYW1lcicpKSxcbiAgICAgICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdTRVNTSU9OX0NPTlRST0xfVEFCTEVOQU1FJzogc2Vzc2lvbkNvbnRyb2xUYWJsZS50YWJsZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnU0VTU0lPTl9QQVJBTUVURVInOiBzZXNzaW9uUGFyYW1ldGVyLnBhcmFtZXRlck5hbWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAsIGZ1bmN0aW9uTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdEZWFsbG9jYXRlR2FtZXJGbidcbiAgICAgICAgICAgICAgICAgICAgLCBkZXNjcmlwdGlvbjogJ1RoaXMgZnVuY3Rpb24gZGVhbGxvY2F0ZXMgdGhlIGdhbWVyIHdoZW4gYSByZWxldmFudCBldmVudCBpcyBpZGVudGlmaWVkIChzaWduIG91dCwgY2xvc2Ugd2luZG93IGV0YyknXG4gICAgICAgICAgICAgICAgICAgICwgbWVtb3J5U2l6ZTogMTI4XG4gICAgICAgICAgICAgICAgICAgICwgdGltZW91dDogNjBcbiAgICAgICAgICAgICAgICAgICAgLCByb2xlOiBuZXcgSUFNLlJvbGUodGhpcywgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdEZWFsbG9jYXRlR2FtZXJGbl9Sb2xlJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9sZU5hbWU6IHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnRGVhbGxvY2F0ZUdhbWVyRm5fUm9sZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICwgYXNzdW1lZEJ5OiBuZXcgSUFNLlNlcnZpY2VQcmluY2lwYWwoJ2xhbWJkYS5hbWF6b25hd3MuY29tJylcbiAgICAgICAgICAgICAgICAgICAgICAgICwgbWFuYWdlZFBvbGljeUFybnM6IFsnYXJuOmF3czppYW06OmF3czpwb2xpY3kvc2VydmljZS1yb2xlL0FXU0xhbWJkYUJhc2ljRXhlY3V0aW9uUm9sZSddXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGlubGluZVBvbGljaWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0R5bmFtb0RCUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKHNlc3Npb25Db250cm9sVGFibGUudGFibGVBcm4pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6R2V0SXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6VXBkYXRlSXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6U2NhbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6UXVlcnknKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTeXN0ZW1zTWFuYWdlclBlcm1pc3Npb25zJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lEb2N1bWVudCgpLmFkZFN0YXRlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5U3RhdGVtZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxsb3coKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRSZXNvdXJjZSgnYXJuOmF3czpzc206Jyt0aGlzLnByb3BlcnRpZXMucmVnaW9uKyc6Jyt0aGlzLnByb3BlcnRpZXMuYWNjb3VudElkKyc6cGFyYW1ldGVyJytzZXNzaW9uUGFyYW1ldGVyLnBhcmFtZXRlck5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3NtOkdldFBhcmFtZXRlcicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3NtOkdldFBhcmFtZXRlcnMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWRGdW5jdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRTY29yZWJvYXJkRnVuY3Rpb24oKSB7XG5cbiAgICAgICAgbGV0IGRscSA9IG5ldyBTUVMuUXVldWUodGhpcywgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdETFEnLCB7XG4gICAgICAgICAgICBxdWV1ZU5hbWU6IHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnRExRJ1xuICAgICAgICB9KVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIGZ1bmN0aW9uIHJlcXVpcmVzIGFjY2VzcyB0byBcbiAgICAgICAgICogUXVldWVcbiAgICAgICAgICogICAgICBwcm9jZXNzLmVudi5ETFFfVVJMID0gXCJodHRwczovL3Nxcy51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS8yMzIxODk5NDg2MDIvU3BhY2VJbnZhZGVyc19ETFFcIlxuICAgICAgICAgKiBTeXN0ZW1zTWFuYWdlclxuICAgICAgICAgKiAgICAgIHByb2Nlc3MuZW52LlNFU1NJT05fUEFSQU1FVEVSID0gLzxnZXRBcHBSZWZOYW1lPi9zZXNzaW9uXG4gICAgICAgICAqIER5bmFtb0RCIFRhYmxlc1xuICAgICAgICAgKiAgICAgIHByb2Nlc3MuZW52LlNFU1NJT05fVEFCTEVOQU1FID0gZ2V0QXBwUmVmTmFtZSsnU2Vzc2lvbidcbiAgICAgICAgICogICAgICBwcm9jZXNzLmVudi5TRVNTSU9OX0NPTlRST0xfVEFCTEVOQU1FID0gZ2V0QXBwUmVmTmFtZSsnU2Vzc2lvbkNvbnRyb2wnXG4gICAgICAgICAqICAgICAgcHJvY2Vzcy5lbnYuU0VTU0lPTlRPUFhfVEFCTEVOQU1FID0gZ2V0QXBwUmVmTmFtZSsnU2Vzc2lvblRvcFgnXG4gICAgICAgICAqL1xuICAgICAgICAvLyBNSVNTSU5HIFBBUkFNRVRFUiAtIHNpZGUgZWZmZWN0IC0gcmVtb3ZlIHRoZSBuZXh0IGxpbmUsIHVuY29tbWVudCB0aGUgbmV4dCBvbmUuXG4gICAgICAgIGxldCBzZXNzaW9uUGFyYW1ldGVyID0geyBwYXJhbWV0ZXJOYW1lIDogJy8nK3RoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkudG9Mb2NhbGVMb3dlckNhc2UoKSsnL3Nlc3Npb24nfTtcbiAgICAgICAgLy9sZXQgc2Vzc2lvblBhcmFtZXRlcjogQ2ZuUGFyYW1ldGVyIHwgdW5kZWZpbmVkID0gPENmblBhcmFtZXRlcj4gdGhpcy5wcm9wZXJ0aWVzLmdldFBhcmFtZXRlcigncGFyYW1ldGVyLnNlc3Npb24nKTtcbiAgICAgICAgbGV0IHNlc3Npb25Db250cm9sVGFibGU6IFRhYmxlIHwgdW5kZWZpbmVkID0gPFRhYmxlPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCd0YWJsZS5zZXNzaW9uQ29udHJvbCcpO1xuICAgICAgICBsZXQgc2Vzc2lvblRvcFg6IFRhYmxlIHwgdW5kZWZpbmVkID0gPFRhYmxlPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCd0YWJsZS5zZXNzaW9uVG9wWCcpO1xuICAgICAgICBsZXQgc2Vzc2lvblRhYmxlOiBUYWJsZSB8IHVuZGVmaW5lZCA9IDxUYWJsZT4gdGhpcy5wcm9wZXJ0aWVzLmdldFBhcmFtZXRlcigndGFibGUuc2Vzc2lvbicpO1xuICAgICAgICBpZiAoc2Vzc2lvblBhcmFtZXRlciAmJiBzZXNzaW9uQ29udHJvbFRhYmxlICYmIHNlc3Npb25Ub3BYICYmIHNlc3Npb25UYWJsZSkge1xuICAgICAgICAgICAgbGV0IGNyZWF0ZWRGdW5jdGlvbjogTGFtYmRhLkZ1bmN0aW9uID1cbiAgICAgICAgICAgICAgICBuZXcgTGFtYmRhLkZ1bmN0aW9uKHRoaXMsIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnU2NvcmVib2FyZEZuJywge1xuICAgICAgICAgICAgICAgICAgICBydW50aW1lOiBMYW1iZGEuUnVudGltZS5Ob2RlSlM2MTAsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6ICdpbmRleC5oYW5kbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgY29kZTogTGFtYmRhLkNvZGUuYXNzZXQocGF0aC5qb2luKGxhbWJkYXNMb2NhdGlvbiwnc2NvcmVib2FyZCcpKSxcbiAgICAgICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdETFFfVVJMJzogZGxxLnF1ZXVlVXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1NFU1NJT05fUEFSQU1FVEVSJzogc2Vzc2lvblBhcmFtZXRlci5wYXJhbWV0ZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1NFU1NJT05fVEFCTEVOQU1FJzogc2Vzc2lvblRhYmxlLnRhYmxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdTRVNTSU9OX0NPTlRST0xfVEFCTEVOQU1FJzogc2Vzc2lvbkNvbnRyb2xUYWJsZS50YWJsZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnU0VTU0lPTl9UT1BYX1RBQkxFTkFNRSc6IHNlc3Npb25Ub3BYLnRhYmxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdUb3BYVmFsdWUnOiAnMTAnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLCBmdW5jdGlvbk5hbWU6IHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnU2NvcmVib2FyZEZuJ1xuICAgICAgICAgICAgICAgICAgICAsIGRlc2NyaXB0aW9uOiAnVGhpcyBmdW5jdGlvbiBjb21wdXRlcyB0aGUgc2NvcmVib2FyZCdcbiAgICAgICAgICAgICAgICAgICAgLCBtZW1vcnlTaXplOiAxMjhcbiAgICAgICAgICAgICAgICAgICAgLCB0aW1lb3V0OiA2MFxuICAgICAgICAgICAgICAgICAgICAsIHJvbGU6IG5ldyBJQU0uUm9sZSh0aGlzLCB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ1Njb3JlYm9hcmRGbl9Sb2xlJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9sZU5hbWU6IHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnU2NvcmVib2FyZEZuX1JvbGUnXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGFzc3VtZWRCeTogbmV3IElBTS5TZXJ2aWNlUHJpbmNpcGFsKCdsYW1iZGEuYW1hem9uYXdzLmNvbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAsIG1hbmFnZWRQb2xpY3lBcm5zOiBbJ2Fybjphd3M6aWFtOjphd3M6cG9saWN5L3NlcnZpY2Utcm9sZS9BV1NMYW1iZGFCYXNpY0V4ZWN1dGlvblJvbGUnXVxuICAgICAgICAgICAgICAgICAgICAgICAgLCBpbmxpbmVQb2xpY2llczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdEeW5hbW9EQlBlcm1pc3Npb25zJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lEb2N1bWVudCgpLmFkZFN0YXRlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5U3RhdGVtZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxsb3coKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRSZXNvdXJjZSgnYXJuOmF3czpkeW5hbW9kYjonICsgdGhpcy5wcm9wZXJ0aWVzLnJlZ2lvbiArICc6JyArIHRoaXMucHJvcGVydGllcy5hY2NvdW50SWQgKyAnOnRhYmxlLycgKyB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJyonKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOkdldEl0ZW0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOlVwZGF0ZUl0ZW0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOlNjYW4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOlF1ZXJ5JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdkeW5hbW9kYjpCYXRjaConKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOlB1dEl0ZW0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOkRlbGV0ZUl0ZW0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTeXN0ZW1zTWFuYWdlclBlcm1pc3Npb25zJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lEb2N1bWVudCgpLmFkZFN0YXRlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5U3RhdGVtZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxsb3coKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRSZXNvdXJjZSgnYXJuOmF3czpzc206JyArIHRoaXMucHJvcGVydGllcy5yZWdpb24gKyAnOicgKyB0aGlzLnByb3BlcnRpZXMuYWNjb3VudElkICsgJzpwYXJhbWV0ZXIvJyArIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkudG9Mb3dlckNhc2UoKSArICcqJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdzc206R2V0KicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3NtOkdldConKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ3NzbTpMaXN0KicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1NRU1Blcm1pc3Npb25zJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lEb2N1bWVudCgpLmFkZFN0YXRlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5U3RhdGVtZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxsb3coKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRSZXNvdXJjZShkbHEucXVldWVBcm4pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3FzOlNlbmRNZXNzYWdlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnS2luZXNpc1Blcm1pc3Npb25zJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lEb2N1bWVudCgpLmFkZFN0YXRlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5U3RhdGVtZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxsb3coKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb25zKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImtpbmVzaXM6U3Vic2NyaWJlVG9TaGFyZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImtpbmVzaXM6R2V0U2hhcmRJdGVyYXRvclwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImtpbmVzaXM6R2V0UmVjb3Jkc1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImtpbmVzaXM6RGVzY3JpYmVTdHJlYW1cIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWxsUmVzb3VyY2VzKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWRGdW5jdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG59XG5cbiJdfQ==