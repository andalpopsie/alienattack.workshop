"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const resourceawarestack_1 = require("./../resourceawarestack");
const Lambda = require("@aws-cdk/aws-lambda");
const IAM = require("@aws-cdk/aws-iam");
const SQS = require("@aws-cdk/aws-sqs");
const lambdasLocation = './lambdas/';
class ProcessingLayer extends resourceawarestack_1.ResourceAwareConstruct {
    getAllocateFunctionArn() {
        return this.allocateFunction.functionArn;
    }
    getAllocateFunctionRef() {
        return this.allocateFunction;
    }
    getDeallocateFunctionArn() {
        return this.deallocateFunction.functionArn;
        ;
    }
    getScoreboardFunctionArn() {
        return this.scoreboardFunction.functionArn;
    }
    getScoreboardFunctionRef() {
        return this.scoreboardFunction;
    }
    constructor(parent, name, props) {
        super(parent, name, props);
        let createdFunction = null;
        createdFunction = this.getAllocateGamerFunction();
        if (createdFunction)
            this.allocateFunction = createdFunction;
        createdFunction = this.getDeallocateGamerFunction();
        if (createdFunction)
            this.deallocateFunction = createdFunction;
        createdFunction = this.getScoreboardFunction();
        if (createdFunction)
            this.scoreboardFunction = createdFunction;
        /*
        new Lambda.Function(this, 'PostregistrationFunction' + props.suffix, {
            runtime: Lambda.Runtime.NodeJS810,
            handler: 'index.handler',
            code: Lambda.Code.asset('./../lambdas/postRegistration')
        });
        */
    }
    getAllocateGamerFunction() {
        /**
    * This function requires access to
    * SystemsManager
    *      process.env.SESSION_PARAMETER = /<getAppRefName>/session
    * DynamoDB Tables
    *      process.env.SESSION_CONTROL_TABLENAME = getAppRefName+'SessionControl'
    */
        // MISSING PARAMETER - side effect - remove the next line, uncomment the next one.
        let sessionParameter = { parameterName: '/' + this.properties.getAppRefName().toLocaleLowerCase() + '/session' };
        //let sessionParameter : CfnParameter = <CfnParameter> this.properties.getParameter('parameter.session');
        let sessionControlTable = this.properties.getParameter('table.sessioncontrol');
        if (sessionParameter && sessionControlTable) {
            let createdFunction = new Lambda.Function(this, this.properties.getAppRefName() + 'AllocateGamerFn', {
                runtime: Lambda.Runtime.NodeJS610,
                handler: 'index.handler',
                code: Lambda.Code.asset(lambdasLocation + 'allocateGamer'),
                environment: {
                    'SESSION_CONTROL_TABLENAME': sessionControlTable.tableName,
                    'SESSION_PARAMETER': sessionParameter.parameterName
                },
                functionName: this.properties.getAppRefName() + 'AllocateGamerFn',
                description: 'This function supports the allocation of gamers when the game is to start',
                memorySize: 128,
                timeout: 60,
                role: new IAM.Role(this, this.properties.getAppRefName() + 'AllocateGamerFn_Role', {
                    roleName: this.properties.getAppRefName() + 'AllocateGamerFn_Role',
                    assumedBy: new IAM.ServicePrincipal('lambda.amazonaws.com'),
                    managedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole'],
                    inlinePolicies: {
                        'DynamoDBPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource(sessionControlTable.tableArn)
                            .addAction('dynamodb:GetItem')
                            .addAction('dynamodb:UpdateItem')
                            .addAction('dynamodb:Scan')
                            .addAction('dynamodb:Query')),
                        'SystemsManagerPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:ssm:' + this.properties.region + ':' + this.properties.accountId + ':parameter' + sessionParameter.parameterName)
                            .addAction('ssm:GetParameter')
                            .addAction('ssm:GetParameters')),
                    }
                })
            });
            return createdFunction;
        }
        else
            return undefined;
    }
    getDeallocateGamerFunction() {
        /**
         * This function requires access to
         * SystemsManager
         *      process.env.SESSION_PARAMETER = /<getAppRefName>/session
         * DynamoDB Tables
         *      process.env.SESSION_CONTROL_TABLENAME = getAppRefName+'SessionControl'
         */
        // MISSING PARAMETER - side effect - remove the next line, uncomment the next one.
        let sessionParameter = { parameterName: '/' + this.properties.getAppRefName().toLocaleLowerCase() + '/session' };
        //let sessionParameter: CfnParameter = <CfnParameter>  this.properties.getParameter('parameter.session');
        let sessionControlTable = this.properties.getParameter('table.sessionControl');
        if (sessionParameter && sessionControlTable) {
            let createdFunction = new Lambda.Function(this, this.properties.getAppRefName() + 'DeallocateGamerFn', {
                runtime: Lambda.Runtime.NodeJS610,
                handler: 'index.handler',
                code: Lambda.Code.asset(lambdasLocation + 'deallocateGamer'),
                environment: {
                    'SESSION_CONTROL_TABLENAME': sessionControlTable.tableName,
                    'SESSION_PARAMETER': sessionParameter.parameterName
                },
                functionName: this.properties.getAppRefName() + 'DeallocateGamerFn',
                description: 'This function deallocates the gamer when a relevant event is identified (sign out, close window etc)',
                memorySize: 128,
                timeout: 60,
                role: new IAM.Role(this, this.properties.getAppRefName() + 'DeallocateGamerFn_Role', {
                    roleName: this.properties.getAppRefName() + 'DeallocateGamerFn_Role',
                    assumedBy: new IAM.ServicePrincipal('lambda.amazonaws.com'),
                    managedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole'],
                    inlinePolicies: {
                        'DynamoDBPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource(sessionControlTable.tableArn)
                            .addAction('dynamodb:GetItem')
                            .addAction('dynamodb:UpdateItem')
                            .addAction('dynamodb:Scan')
                            .addAction('dynamodb:Query')),
                        'SystemsManagerPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:ssm:' + this.properties.region + ':' + this.properties.accountId + ':parameter' + sessionParameter.parameterName)
                            .addAction('ssm:GetParameter')
                            .addAction('ssm:GetParameters')),
                    }
                })
            });
            return createdFunction;
        }
        else
            return undefined;
    }
    getScoreboardFunction() {
        let dlq = new SQS.Queue(this, this.properties.getAppRefName() + 'DLQ', {
            queueName: this.properties.getAppRefName() + 'DLQ'
        });
        /**
         * This function requires access to
         * Queue
         *      process.env.DLQ_URL = "https://sqs.us-east-1.amazonaws.com/232189948602/SpaceInvaders_DLQ"
         * SystemsManager
         *      process.env.SESSION_PARAMETER = /<getAppRefName>/session
         * DynamoDB Tables
         *      process.env.SESSION_TABLENAME = getAppRefName+'Session'
         *      process.env.SESSION_CONTROL_TABLENAME = getAppRefName+'SessionControl'
         *      process.env.SESSIONTOPX_TABLENAME = getAppRefName+'SessionTopX'
         */
        // MISSING PARAMETER - side effect - remove the next line, uncomment the next one.
        let sessionParameter = { parameterName: '/' + this.properties.getAppRefName().toLocaleLowerCase() + '/session' };
        //let sessionParameter: CfnParameter | undefined = <CfnParameter> this.properties.getParameter('parameter.session');
        let sessionControlTable = this.properties.getParameter('table.sessionControl');
        let sessionTopX = this.properties.getParameter('table.sessionTopX');
        let sessionTable = this.properties.getParameter('table.session');
        if (sessionParameter && sessionControlTable && sessionTopX && sessionTable) {
            let createdFunction = new Lambda.Function(this, this.properties.getAppRefName() + 'ScoreboardFn', {
                runtime: Lambda.Runtime.NodeJS610,
                handler: 'index.handler',
                code: Lambda.Code.asset(lambdasLocation + 'scoreboard'),
                environment: {
                    'DLQ_URL': dlq.queueUrl,
                    'SESSION_PARAMETER': sessionParameter.parameterName,
                    'SESSION_TABLENAME': sessionTable.tableName,
                    'SESSION_CONTROL_TABLENAME': sessionControlTable.tableName,
                    'SESSION_TOPX_TABLENAME': sessionTopX.tableName,
                    'TopXValue': '10'
                },
                functionName: this.properties.getAppRefName() + 'ScoreboardFn',
                description: 'This function computes the scoreboard',
                memorySize: 128,
                timeout: 60,
                role: new IAM.Role(this, this.properties.getAppRefName() + 'ScoreboardFn_Role', {
                    roleName: this.properties.getAppRefName() + 'ScoreboardFn_Role',
                    assumedBy: new IAM.ServicePrincipal('lambda.amazonaws.com'),
                    managedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole'],
                    inlinePolicies: {
                        'DynamoDBPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:dynamodb:' + this.properties.region + ':' + this.properties.accountId + ':table/' + this.properties.getAppRefName() + '*')
                            .addAction('dynamodb:GetItem')
                            .addAction('dynamodb:UpdateItem')
                            .addAction('dynamodb:Scan')
                            .addAction('dynamodb:Query')
                            .addAction('dynamodb:Batch*')
                            .addAction('dynamodb:PutItem')
                            .addAction('dynamodb:DeleteItem')),
                        'SystemsManagerPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:ssm:' + this.properties.region + ':' + this.properties.accountId + ':parameter/' + this.properties.getAppRefName().toLowerCase() + '*')
                            .addAction('ssm:Get*')
                            .addAction('ssm:Get*')
                            .addAction('ssm:List*')),
                        'SQSPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource(dlq.queueArn)
                            .addAction('sqs:SendMessage')),
                        'KinesisPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addActions("kinesis:SubscribeToShard", "kinesis:GetShardIterator", "kinesis:GetRecords", "kinesis:DescribeStream")
                            .addAllResources())
                    }
                })
            });
            return createdFunction;
        }
        else
            return undefined;
    }
}
exports.ProcessingLayer = ProcessingLayer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzc2luZ0xheWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicHJvY2Vzc2luZ0xheWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsZ0VBQXNGO0FBRXRGLDhDQUErQztBQUMvQyx3Q0FBeUM7QUFFekMsd0NBQXlDO0FBSXpDLE1BQU0sZUFBZSxHQUFHLFlBQVksQ0FBQztBQUVyQyxNQUFhLGVBQWdCLFNBQVEsMkNBQXNCO0lBR2hELHNCQUFzQjtRQUN6QixPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUM7SUFDN0MsQ0FBQztJQUNNLHNCQUFzQjtRQUN6QixPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztJQUNqQyxDQUFDO0lBR00sd0JBQXdCO1FBQzNCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQztRQUFBLENBQUM7SUFDaEQsQ0FBQztJQUdNLHdCQUF3QjtRQUMzQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUM7SUFDL0MsQ0FBQztJQUNNLHdCQUF3QjtRQUMzQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztJQUNuQyxDQUFDO0lBRUQsWUFBWSxNQUFpQixFQUFFLElBQVksRUFBRSxLQUEyQjtRQUNwRSxLQUFLLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMzQixJQUFJLGVBQWUsR0FBdUMsSUFBSSxDQUFDO1FBRS9ELGVBQWUsR0FBRyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztRQUNsRCxJQUFJLGVBQWU7WUFBRSxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsZUFBZSxDQUFDO1FBRTdELGVBQWUsR0FBRyxJQUFJLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztRQUNwRCxJQUFJLGVBQWU7WUFBRSxJQUFJLENBQUMsa0JBQWtCLEdBQUcsZUFBZSxDQUFDO1FBRS9ELGVBQWUsR0FBRyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FB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QUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEdBQUcsYUFBYSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxFQUFFLENBQUMsV0FBVyxFQUFFLEdBQUcsR0FBRyxDQUFDOzZCQUM1SixTQUFTLENBQUMsVUFBVSxDQUFDOzZCQUNyQixTQUFTLENBQUMsVUFBVSxDQUFDOzZCQUNyQixTQUFTLENBQUMsV0FBVyxDQUFDLENBQzlCO3dCQUNMLGdCQUFnQixFQUNaLElBQUksR0FBRyxDQUFDLGNBQWMsRUFBRSxDQUFDLFlBQVksQ0FDakMsSUFBSSxHQUFHLENBQUMsZUFBZSxFQUFFOzZCQUNwQixLQUFLLEVBQUU7NkJBQ1AsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUM7NkJBQ3pCLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUNwQzt3QkFDTCxvQkFBb0IsRUFDaEIsSUFBSSxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUMsWUFBWSxDQUNqQyxJQUFJLEdBQUcsQ0FBQyxlQUFlLEVBQUU7NkJBQ3BCLEtBQUssRUFBRTs2QkFDUCxVQUFVLENBQ1AsMEJBQTBCLEVBQzFCLDBCQUEwQixFQUMxQixvQkFBb0IsRUFDcEIsd0JBQXdCLENBQzNCOzZCQUNBLGVBQWUsRUFBRSxDQUN6QjtxQkFDUjtpQkFDSixDQUFDO2FBQ0wsQ0FBQyxDQUFDO1lBQ1AsT0FBTyxlQUFlLENBQUM7U0FDMUI7O1lBQ0ksT0FBTyxTQUFTLENBQUM7SUFDMUIsQ0FBQztDQUVKO0FBOVBELDBDQThQQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ0Bhd3MtY2RrL2Nkayc7XG5pbXBvcnQgeyBSZXNvdXJjZUF3YXJlQ29uc3RydWN0LCBJUGFyYW1ldGVyQXdhcmVQcm9wcyB9IGZyb20gJy4vLi4vcmVzb3VyY2Vhd2FyZXN0YWNrJ1xuXG5pbXBvcnQgTGFtYmRhID0gcmVxdWlyZSgnQGF3cy1jZGsvYXdzLWxhbWJkYScpO1xuaW1wb3J0IElBTSA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2F3cy1pYW0nKTtcblxuaW1wb3J0IFNRUyA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2F3cy1zcXMnKTtcbmltcG9ydCB7IENmblBhcmFtZXRlciB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1zc20nO1xuaW1wb3J0IHsgVGFibGUgfSBmcm9tICdAYXdzLWNkay9hd3MtZHluYW1vZGInO1xuXG5jb25zdCBsYW1iZGFzTG9jYXRpb24gPSAnLi9sYW1iZGFzLyc7XG5cbmV4cG9ydCBjbGFzcyBQcm9jZXNzaW5nTGF5ZXIgZXh0ZW5kcyBSZXNvdXJjZUF3YXJlQ29uc3RydWN0IHtcblxuICAgIHByaXZhdGUgYWxsb2NhdGVGdW5jdGlvbjogTGFtYmRhLkZ1bmN0aW9uO1xuICAgIHB1YmxpYyBnZXRBbGxvY2F0ZUZ1bmN0aW9uQXJuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hbGxvY2F0ZUZ1bmN0aW9uLmZ1bmN0aW9uQXJuO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0QWxsb2NhdGVGdW5jdGlvblJlZigpIDogTGFtYmRhLkZ1bmN0aW9uIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWxsb2NhdGVGdW5jdGlvbjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGRlYWxsb2NhdGVGdW5jdGlvbjogTGFtYmRhLkZ1bmN0aW9uO1xuICAgIHB1YmxpYyBnZXREZWFsbG9jYXRlRnVuY3Rpb25Bcm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlYWxsb2NhdGVGdW5jdGlvbi5mdW5jdGlvbkFybjs7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzY29yZWJvYXJkRnVuY3Rpb24gOiBMYW1iZGEuRnVuY3Rpb247XG4gICAgcHVibGljIGdldFNjb3JlYm9hcmRGdW5jdGlvbkFybigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NvcmVib2FyZEZ1bmN0aW9uLmZ1bmN0aW9uQXJuO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0U2NvcmVib2FyZEZ1bmN0aW9uUmVmKCkgOiBMYW1iZGEuRnVuY3Rpb24ge1xuICAgICAgICByZXR1cm4gdGhpcy5zY29yZWJvYXJkRnVuY3Rpb247XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IocGFyZW50OiBDb25zdHJ1Y3QsIG5hbWU6IHN0cmluZywgcHJvcHM6IElQYXJhbWV0ZXJBd2FyZVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHBhcmVudCwgbmFtZSwgcHJvcHMpO1xuICAgICAgICBsZXQgY3JlYXRlZEZ1bmN0aW9uOiBMYW1iZGEuRnVuY3Rpb24gfCB1bmRlZmluZWQgfCBudWxsID0gbnVsbDtcblxuICAgICAgICBjcmVhdGVkRnVuY3Rpb24gPSB0aGlzLmdldEFsbG9jYXRlR2FtZXJGdW5jdGlvbigpO1xuICAgICAgICBpZiAoY3JlYXRlZEZ1bmN0aW9uKSB0aGlzLmFsbG9jYXRlRnVuY3Rpb24gPSBjcmVhdGVkRnVuY3Rpb247XG5cbiAgICAgICAgY3JlYXRlZEZ1bmN0aW9uID0gdGhpcy5nZXREZWFsbG9jYXRlR2FtZXJGdW5jdGlvbigpO1xuICAgICAgICBpZiAoY3JlYXRlZEZ1bmN0aW9uKSB0aGlzLmRlYWxsb2NhdGVGdW5jdGlvbiA9IGNyZWF0ZWRGdW5jdGlvbjtcblxuICAgICAgICBjcmVhdGVkRnVuY3Rpb24gPSB0aGlzLmdldFNjb3JlYm9hcmRGdW5jdGlvbigpO1xuICAgICAgICBpZiAoY3JlYXRlZEZ1bmN0aW9uKSB0aGlzLnNjb3JlYm9hcmRGdW5jdGlvbiA9IGNyZWF0ZWRGdW5jdGlvbjtcbiAgICAgICAgXG4gICAgICAgIC8qXG4gICAgICAgIG5ldyBMYW1iZGEuRnVuY3Rpb24odGhpcywgJ1Bvc3RyZWdpc3RyYXRpb25GdW5jdGlvbicgKyBwcm9wcy5zdWZmaXgsIHtcbiAgICAgICAgICAgIHJ1bnRpbWU6IExhbWJkYS5SdW50aW1lLk5vZGVKUzgxMCxcbiAgICAgICAgICAgIGhhbmRsZXI6ICdpbmRleC5oYW5kbGVyJyxcbiAgICAgICAgICAgIGNvZGU6IExhbWJkYS5Db2RlLmFzc2V0KCcuLy4uL2xhbWJkYXMvcG9zdFJlZ2lzdHJhdGlvbicpXG4gICAgICAgIH0pO1xuICAgICAgICAqL1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QWxsb2NhdGVHYW1lckZ1bmN0aW9uKCkge1xuICAgICAgICAvKipcbiAgICAqIFRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgYWNjZXNzIHRvIFxuICAgICogU3lzdGVtc01hbmFnZXJcbiAgICAqICAgICAgcHJvY2Vzcy5lbnYuU0VTU0lPTl9QQVJBTUVURVIgPSAvPGdldEFwcFJlZk5hbWU+L3Nlc3Npb25cbiAgICAqIER5bmFtb0RCIFRhYmxlc1xuICAgICogICAgICBwcm9jZXNzLmVudi5TRVNTSU9OX0NPTlRST0xfVEFCTEVOQU1FID0gZ2V0QXBwUmVmTmFtZSsnU2Vzc2lvbkNvbnRyb2wnXG4gICAgKi9cbiAgICAgICAgLy8gTUlTU0lORyBQQVJBTUVURVIgLSBzaWRlIGVmZmVjdCAtIHJlbW92ZSB0aGUgbmV4dCBsaW5lLCB1bmNvbW1lbnQgdGhlIG5leHQgb25lLlxuICAgICAgICBsZXQgc2Vzc2lvblBhcmFtZXRlciA9IHsgcGFyYW1ldGVyTmFtZSA6ICcvJyt0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpLnRvTG9jYWxlTG93ZXJDYXNlKCkrJy9zZXNzaW9uJ307XG4gICAgICAgIC8vbGV0IHNlc3Npb25QYXJhbWV0ZXIgOiBDZm5QYXJhbWV0ZXIgPSA8Q2ZuUGFyYW1ldGVyPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCdwYXJhbWV0ZXIuc2Vzc2lvbicpO1xuICAgICAgICBsZXQgc2Vzc2lvbkNvbnRyb2xUYWJsZSA6IFRhYmxlID0gPFRhYmxlPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCd0YWJsZS5zZXNzaW9uY29udHJvbCcpO1xuICAgICAgICBpZiAoc2Vzc2lvblBhcmFtZXRlciAmJiBzZXNzaW9uQ29udHJvbFRhYmxlKSB7XG4gICAgICAgICAgICBsZXQgY3JlYXRlZEZ1bmN0aW9uOiBMYW1iZGEuRnVuY3Rpb24gPVxuICAgICAgICAgICAgICAgIG5ldyBMYW1iZGEuRnVuY3Rpb24odGhpcywgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdBbGxvY2F0ZUdhbWVyRm4nLCB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bnRpbWU6IExhbWJkYS5SdW50aW1lLk5vZGVKUzYxMCxcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcjogJ2luZGV4LmhhbmRsZXInLFxuICAgICAgICAgICAgICAgICAgICBjb2RlOiBMYW1iZGEuQ29kZS5hc3NldChsYW1iZGFzTG9jYXRpb24rJ2FsbG9jYXRlR2FtZXInKSxcbiAgICAgICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdTRVNTSU9OX0NPTlRST0xfVEFCTEVOQU1FJzogc2Vzc2lvbkNvbnRyb2xUYWJsZS50YWJsZU5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnU0VTU0lPTl9QQVJBTUVURVInOiBzZXNzaW9uUGFyYW1ldGVyLnBhcmFtZXRlck5hbWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAsIGZ1bmN0aW9uTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdBbGxvY2F0ZUdhbWVyRm4nXG4gICAgICAgICAgICAgICAgICAgICwgZGVzY3JpcHRpb246ICdUaGlzIGZ1bmN0aW9uIHN1cHBvcnRzIHRoZSBhbGxvY2F0aW9uIG9mIGdhbWVycyB3aGVuIHRoZSBnYW1lIGlzIHRvIHN0YXJ0J1xuICAgICAgICAgICAgICAgICAgICAsIG1lbW9yeVNpemU6IDEyOFxuICAgICAgICAgICAgICAgICAgICAsIHRpbWVvdXQ6IDYwXG4gICAgICAgICAgICAgICAgICAgICwgcm9sZTogbmV3IElBTS5Sb2xlKHRoaXMsIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnQWxsb2NhdGVHYW1lckZuX1JvbGUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb2xlTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdBbGxvY2F0ZUdhbWVyRm5fUm9sZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICwgYXNzdW1lZEJ5OiBuZXcgSUFNLlNlcnZpY2VQcmluY2lwYWwoJ2xhbWJkYS5hbWF6b25hd3MuY29tJylcbiAgICAgICAgICAgICAgICAgICAgICAgICwgbWFuYWdlZFBvbGljeUFybnM6IFsnYXJuOmF3czppYW06OmF3czpwb2xpY3kvc2VydmljZS1yb2xlL0FXU0xhbWJkYUJhc2ljRXhlY3V0aW9uUm9sZSddXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGlubGluZVBvbGljaWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0R5bmFtb0RCUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKHNlc3Npb25Db250cm9sVGFibGUudGFibGVBcm4pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6R2V0SXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6VXBkYXRlSXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6U2NhbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6UXVlcnknKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTeXN0ZW1zTWFuYWdlclBlcm1pc3Npb25zJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lEb2N1bWVudCgpLmFkZFN0YXRlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5U3RhdGVtZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxsb3coKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRSZXNvdXJjZSgnYXJuOmF3czpzc206Jyt0aGlzLnByb3BlcnRpZXMucmVnaW9uKyc6Jyt0aGlzLnByb3BlcnRpZXMuYWNjb3VudElkKyc6cGFyYW1ldGVyJytzZXNzaW9uUGFyYW1ldGVyLnBhcmFtZXRlck5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3NtOkdldFBhcmFtZXRlcicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3NtOkdldFBhcmFtZXRlcnMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZWRGdW5jdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXREZWFsbG9jYXRlR2FtZXJGdW5jdGlvbigpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgYWNjZXNzIHRvIFxuICAgICAgICAgKiBTeXN0ZW1zTWFuYWdlclxuICAgICAgICAgKiAgICAgIHByb2Nlc3MuZW52LlNFU1NJT05fUEFSQU1FVEVSID0gLzxnZXRBcHBSZWZOYW1lPi9zZXNzaW9uXG4gICAgICAgICAqIER5bmFtb0RCIFRhYmxlc1xuICAgICAgICAgKiAgICAgIHByb2Nlc3MuZW52LlNFU1NJT05fQ09OVFJPTF9UQUJMRU5BTUUgPSBnZXRBcHBSZWZOYW1lKydTZXNzaW9uQ29udHJvbCdcbiAgICAgICAgICovXG4gICAgICAgIC8vIE1JU1NJTkcgUEFSQU1FVEVSIC0gc2lkZSBlZmZlY3QgLSByZW1vdmUgdGhlIG5leHQgbGluZSwgdW5jb21tZW50IHRoZSBuZXh0IG9uZS5cbiAgICAgICAgbGV0IHNlc3Npb25QYXJhbWV0ZXIgPSB7IHBhcmFtZXRlck5hbWUgOiAnLycrdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKS50b0xvY2FsZUxvd2VyQ2FzZSgpKycvc2Vzc2lvbid9O1xuICAgICAgICAvL2xldCBzZXNzaW9uUGFyYW1ldGVyOiBDZm5QYXJhbWV0ZXIgPSA8Q2ZuUGFyYW1ldGVyPiAgdGhpcy5wcm9wZXJ0aWVzLmdldFBhcmFtZXRlcigncGFyYW1ldGVyLnNlc3Npb24nKTtcbiAgICAgICAgbGV0IHNlc3Npb25Db250cm9sVGFibGU6IFRhYmxlIHwgdW5kZWZpbmVkID0gPFRhYmxlPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCd0YWJsZS5zZXNzaW9uQ29udHJvbCcpO1xuICAgICAgICBpZiAoc2Vzc2lvblBhcmFtZXRlciAmJiBzZXNzaW9uQ29udHJvbFRhYmxlKSB7XG4gICAgICAgICAgICBsZXQgY3JlYXRlZEZ1bmN0aW9uOiBMYW1iZGEuRnVuY3Rpb24gPVxuICAgICAgICAgICAgICAgIG5ldyBMYW1iZGEuRnVuY3Rpb24odGhpcywgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdEZWFsbG9jYXRlR2FtZXJGbicsIHtcbiAgICAgICAgICAgICAgICAgICAgcnVudGltZTogTGFtYmRhLlJ1bnRpbWUuTm9kZUpTNjEwLFxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiAnaW5kZXguaGFuZGxlcicsXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IExhbWJkYS5Db2RlLmFzc2V0KGxhbWJkYXNMb2NhdGlvbisnZGVhbGxvY2F0ZUdhbWVyJyksXG4gICAgICAgICAgICAgICAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnU0VTU0lPTl9DT05UUk9MX1RBQkxFTkFNRSc6IHNlc3Npb25Db250cm9sVGFibGUudGFibGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1NFU1NJT05fUEFSQU1FVEVSJzogc2Vzc2lvblBhcmFtZXRlci5wYXJhbWV0ZXJOYW1lXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLCBmdW5jdGlvbk5hbWU6IHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnRGVhbGxvY2F0ZUdhbWVyRm4nXG4gICAgICAgICAgICAgICAgICAgICwgZGVzY3JpcHRpb246ICdUaGlzIGZ1bmN0aW9uIGRlYWxsb2NhdGVzIHRoZSBnYW1lciB3aGVuIGEgcmVsZXZhbnQgZXZlbnQgaXMgaWRlbnRpZmllZCAoc2lnbiBvdXQsIGNsb3NlIHdpbmRvdyBldGMpJ1xuICAgICAgICAgICAgICAgICAgICAsIG1lbW9yeVNpemU6IDEyOFxuICAgICAgICAgICAgICAgICAgICAsIHRpbWVvdXQ6IDYwXG4gICAgICAgICAgICAgICAgICAgICwgcm9sZTogbmV3IElBTS5Sb2xlKHRoaXMsIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnRGVhbGxvY2F0ZUdhbWVyRm5fUm9sZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGVOYW1lOiB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ0RlYWxsb2NhdGVHYW1lckZuX1JvbGUnXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGFzc3VtZWRCeTogbmV3IElBTS5TZXJ2aWNlUHJpbmNpcGFsKCdsYW1iZGEuYW1hem9uYXdzLmNvbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAsIG1hbmFnZWRQb2xpY3lBcm5zOiBbJ2Fybjphd3M6aWFtOjphd3M6cG9saWN5L3NlcnZpY2Utcm9sZS9BV1NMYW1iZGFCYXNpY0V4ZWN1dGlvblJvbGUnXVxuICAgICAgICAgICAgICAgICAgICAgICAgLCBpbmxpbmVQb2xpY2llczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdEeW5hbW9EQlBlcm1pc3Npb25zJzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lEb2N1bWVudCgpLmFkZFN0YXRlbWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5U3RhdGVtZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWxsb3coKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRSZXNvdXJjZShzZXNzaW9uQ29udHJvbFRhYmxlLnRhYmxlQXJuKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOkdldEl0ZW0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOlVwZGF0ZUl0ZW0nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOlNjYW4nKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOlF1ZXJ5JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU3lzdGVtc01hbmFnZXJQZXJtaXNzaW9ucyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5RG9jdW1lbnQoKS5hZGRTdGF0ZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeVN0YXRlbWVudCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFsbG93KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkUmVzb3VyY2UoJ2Fybjphd3M6c3NtOicrdGhpcy5wcm9wZXJ0aWVzLnJlZ2lvbisnOicrdGhpcy5wcm9wZXJ0aWVzLmFjY291bnRJZCsnOnBhcmFtZXRlcicrc2Vzc2lvblBhcmFtZXRlci5wYXJhbWV0ZXJOYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ3NzbTpHZXRQYXJhbWV0ZXInKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ3NzbTpHZXRQYXJhbWV0ZXJzJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdGVkRnVuY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0U2NvcmVib2FyZEZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGxldCBkbHEgPSBuZXcgU1FTLlF1ZXVlKHRoaXMsIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnRExRJywge1xuICAgICAgICAgICAgcXVldWVOYW1lOiB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ0RMUSdcbiAgICAgICAgfSlcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyBhY2Nlc3MgdG8gXG4gICAgICAgICAqIFF1ZXVlXG4gICAgICAgICAqICAgICAgcHJvY2Vzcy5lbnYuRExRX1VSTCA9IFwiaHR0cHM6Ly9zcXMudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vMjMyMTg5OTQ4NjAyL1NwYWNlSW52YWRlcnNfRExRXCJcbiAgICAgICAgICogU3lzdGVtc01hbmFnZXJcbiAgICAgICAgICogICAgICBwcm9jZXNzLmVudi5TRVNTSU9OX1BBUkFNRVRFUiA9IC88Z2V0QXBwUmVmTmFtZT4vc2Vzc2lvblxuICAgICAgICAgKiBEeW5hbW9EQiBUYWJsZXNcbiAgICAgICAgICogICAgICBwcm9jZXNzLmVudi5TRVNTSU9OX1RBQkxFTkFNRSA9IGdldEFwcFJlZk5hbWUrJ1Nlc3Npb24nXG4gICAgICAgICAqICAgICAgcHJvY2Vzcy5lbnYuU0VTU0lPTl9DT05UUk9MX1RBQkxFTkFNRSA9IGdldEFwcFJlZk5hbWUrJ1Nlc3Npb25Db250cm9sJ1xuICAgICAgICAgKiAgICAgIHByb2Nlc3MuZW52LlNFU1NJT05UT1BYX1RBQkxFTkFNRSA9IGdldEFwcFJlZk5hbWUrJ1Nlc3Npb25Ub3BYJ1xuICAgICAgICAgKi9cbiAgICAgICAgLy8gTUlTU0lORyBQQVJBTUVURVIgLSBzaWRlIGVmZmVjdCAtIHJlbW92ZSB0aGUgbmV4dCBsaW5lLCB1bmNvbW1lbnQgdGhlIG5leHQgb25lLlxuICAgICAgICBsZXQgc2Vzc2lvblBhcmFtZXRlciA9IHsgcGFyYW1ldGVyTmFtZSA6ICcvJyt0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpLnRvTG9jYWxlTG93ZXJDYXNlKCkrJy9zZXNzaW9uJ307XG4gICAgICAgIC8vbGV0IHNlc3Npb25QYXJhbWV0ZXI6IENmblBhcmFtZXRlciB8IHVuZGVmaW5lZCA9IDxDZm5QYXJhbWV0ZXI+IHRoaXMucHJvcGVydGllcy5nZXRQYXJhbWV0ZXIoJ3BhcmFtZXRlci5zZXNzaW9uJyk7XG4gICAgICAgIGxldCBzZXNzaW9uQ29udHJvbFRhYmxlOiBUYWJsZSB8IHVuZGVmaW5lZCA9IDxUYWJsZT4gdGhpcy5wcm9wZXJ0aWVzLmdldFBhcmFtZXRlcigndGFibGUuc2Vzc2lvbkNvbnRyb2wnKTtcbiAgICAgICAgbGV0IHNlc3Npb25Ub3BYOiBUYWJsZSB8IHVuZGVmaW5lZCA9IDxUYWJsZT4gdGhpcy5wcm9wZXJ0aWVzLmdldFBhcmFtZXRlcigndGFibGUuc2Vzc2lvblRvcFgnKTtcbiAgICAgICAgbGV0IHNlc3Npb25UYWJsZTogVGFibGUgfCB1bmRlZmluZWQgPSA8VGFibGU+IHRoaXMucHJvcGVydGllcy5nZXRQYXJhbWV0ZXIoJ3RhYmxlLnNlc3Npb24nKTtcbiAgICAgICAgaWYgKHNlc3Npb25QYXJhbWV0ZXIgJiYgc2Vzc2lvbkNvbnRyb2xUYWJsZSAmJiBzZXNzaW9uVG9wWCAmJiBzZXNzaW9uVGFibGUpIHtcbiAgICAgICAgICAgIGxldCBjcmVhdGVkRnVuY3Rpb246IExhbWJkYS5GdW5jdGlvbiA9XG4gICAgICAgICAgICAgICAgbmV3IExhbWJkYS5GdW5jdGlvbih0aGlzLCB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ1Njb3JlYm9hcmRGbicsIHtcbiAgICAgICAgICAgICAgICAgICAgcnVudGltZTogTGFtYmRhLlJ1bnRpbWUuTm9kZUpTNjEwLFxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiAnaW5kZXguaGFuZGxlcicsXG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IExhbWJkYS5Db2RlLmFzc2V0KGxhbWJkYXNMb2NhdGlvbisnc2NvcmVib2FyZCcpLFxuICAgICAgICAgICAgICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0RMUV9VUkwnOiBkbHEucXVldWVVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAnU0VTU0lPTl9QQVJBTUVURVInOiBzZXNzaW9uUGFyYW1ldGVyLnBhcmFtZXRlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnU0VTU0lPTl9UQUJMRU5BTUUnOiBzZXNzaW9uVGFibGUudGFibGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1NFU1NJT05fQ09OVFJPTF9UQUJMRU5BTUUnOiBzZXNzaW9uQ29udHJvbFRhYmxlLnRhYmxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdTRVNTSU9OX1RPUFhfVEFCTEVOQU1FJzogc2Vzc2lvblRvcFgudGFibGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1RvcFhWYWx1ZSc6ICcxMCdcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAsIGZ1bmN0aW9uTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdTY29yZWJvYXJkRm4nXG4gICAgICAgICAgICAgICAgICAgICwgZGVzY3JpcHRpb246ICdUaGlzIGZ1bmN0aW9uIGNvbXB1dGVzIHRoZSBzY29yZWJvYXJkJ1xuICAgICAgICAgICAgICAgICAgICAsIG1lbW9yeVNpemU6IDEyOFxuICAgICAgICAgICAgICAgICAgICAsIHRpbWVvdXQ6IDYwXG4gICAgICAgICAgICAgICAgICAgICwgcm9sZTogbmV3IElBTS5Sb2xlKHRoaXMsIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnU2NvcmVib2FyZEZuX1JvbGUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb2xlTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdTY29yZWJvYXJkRm5fUm9sZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICwgYXNzdW1lZEJ5OiBuZXcgSUFNLlNlcnZpY2VQcmluY2lwYWwoJ2xhbWJkYS5hbWF6b25hd3MuY29tJylcbiAgICAgICAgICAgICAgICAgICAgICAgICwgbWFuYWdlZFBvbGljeUFybnM6IFsnYXJuOmF3czppYW06OmF3czpwb2xpY3kvc2VydmljZS1yb2xlL0FXU0xhbWJkYUJhc2ljRXhlY3V0aW9uUm9sZSddXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGlubGluZVBvbGljaWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0R5bmFtb0RCUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKCdhcm46YXdzOmR5bmFtb2RiOicgKyB0aGlzLnByb3BlcnRpZXMucmVnaW9uICsgJzonICsgdGhpcy5wcm9wZXJ0aWVzLmFjY291bnRJZCArICc6dGFibGUvJyArIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnKicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6R2V0SXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6VXBkYXRlSXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6U2NhbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6UXVlcnknKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOkJhdGNoKicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6UHV0SXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6RGVsZXRlSXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1N5c3RlbXNNYW5hZ2VyUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKCdhcm46YXdzOnNzbTonICsgdGhpcy5wcm9wZXJ0aWVzLnJlZ2lvbiArICc6JyArIHRoaXMucHJvcGVydGllcy5hY2NvdW50SWQgKyAnOnBhcmFtZXRlci8nICsgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKS50b0xvd2VyQ2FzZSgpICsgJyonKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ3NzbTpHZXQqJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdzc206R2V0KicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3NtOkxpc3QqJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU1FTUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKGRscS5xdWV1ZUFybilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdzcXM6U2VuZE1lc3NhZ2UnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdLaW5lc2lzUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbnMoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwia2luZXNpczpTdWJzY3JpYmVUb1NoYXJkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwia2luZXNpczpHZXRTaGFyZEl0ZXJhdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwia2luZXNpczpHZXRSZWNvcmRzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwia2luZXNpczpEZXNjcmliZVN0cmVhbVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBbGxSZXNvdXJjZXMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlZEZ1bmN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbn1cblxuIl19