"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const resourceawarestack_1 = require("./../resourceawarestack");
const Lambda = require("@aws-cdk/aws-lambda");
const IAM = require("@aws-cdk/aws-iam");
const SQS = require("@aws-cdk/aws-sqs");
const path = require('path');
const lambdasLocation = path.join(__dirname, '..', '..', 'lambdas');
class ProcessingLayer extends resourceawarestack_1.ResourceAwareConstruct {
    getAllocateFunctionArn() {
        return this.allocateFunction.functionArn;
    }
    getAllocateFunctionRef() {
        return this.allocateFunction;
    }
    getDeallocateFunctionArn() {
        return this.deallocateFunction.functionArn;
        ;
    }
    getScoreboardFunctionArn() {
        return this.scoreboardFunction.functionArn;
    }
    getScoreboardFunctionRef() {
        return this.scoreboardFunction;
    }
    constructor(parent, name, props) {
        super(parent, name, props);
        let createdFunction = null;
        createdFunction = this.getAllocateGamerFunction();
        if (createdFunction)
            this.allocateFunction = createdFunction;
        createdFunction = this.getDeallocateGamerFunction();
        if (createdFunction)
            this.deallocateFunction = createdFunction;
        createdFunction = this.getScoreboardFunction();
        if (createdFunction)
            this.scoreboardFunction = createdFunction;
    }
    getAllocateGamerFunction() {
        /**
    * This function requires access to
    * SystemsManager
    *      process.env.SESSION_PARAMETER = /<getAppRefName>/session
    * DynamoDB Tables
    *      process.env.SESSION_CONTROL_TABLENAME = getAppRefName+'SessionControl'
    */
        // MISSING PARAMETER - side effect - remove the next line, uncomment the next one.
        let sessionParameter = { parameterName: '/' + this.properties.getAppRefName().toLocaleLowerCase() + '/session' };
        //let sessionParameter : CfnParameter = <CfnParameter> this.properties.getParameter('parameter.session');
        let sessionControlTable = this.properties.getParameter('table.sessioncontrol');
        if (sessionParameter && sessionControlTable) {
            let createdFunction = new Lambda.Function(this, this.properties.getAppRefName() + 'AllocateGamerFn', {
                runtime: Lambda.Runtime.NodeJS610,
                handler: 'index.handler',
                code: Lambda.Code.asset(path.join(lambdasLocation, 'allocateGamer')),
                environment: {
                    'SESSION_CONTROL_TABLENAME': sessionControlTable.tableName,
                    'SESSION_PARAMETER': sessionParameter.parameterName
                },
                functionName: this.properties.getAppRefName() + 'AllocateGamerFn',
                description: 'This function supports the allocation of gamers when the game is to start',
                memorySize: 128,
                timeout: 60,
                role: new IAM.Role(this, this.properties.getAppRefName() + 'AllocateGamerFn_Role', {
                    roleName: this.properties.getAppRefName() + 'AllocateGamerFn_Role',
                    assumedBy: new IAM.ServicePrincipal('lambda.amazonaws.com'),
                    managedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole'],
                    inlinePolicies: {
                        'DynamoDBPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource(sessionControlTable.tableArn)
                            .addAction('dynamodb:GetItem')
                            .addAction('dynamodb:UpdateItem')
                            .addAction('dynamodb:Scan')
                            .addAction('dynamodb:Query')),
                        'SystemsManagerPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:ssm:' + this.properties.region + ':' + this.properties.accountId + ':parameter' + sessionParameter.parameterName)
                            .addAction('ssm:GetParameter')
                            .addAction('ssm:GetParameters')),
                    }
                })
            });
            return createdFunction;
        }
        else
            return undefined;
    }
    getDeallocateGamerFunction() {
        /**
         * This function requires access to
         * SystemsManager
         *      process.env.SESSION_PARAMETER = /<getAppRefName>/session
         * DynamoDB Tables
         *      process.env.SESSION_CONTROL_TABLENAME = getAppRefName+'SessionControl'
         */
        // MISSING PARAMETER - side effect - remove the next line, uncomment the next one.
        let sessionParameter = { parameterName: '/' + this.properties.getAppRefName().toLocaleLowerCase() + '/session' };
        //let sessionParameter: CfnParameter = <CfnParameter>  this.properties.getParameter('parameter.session');
        let sessionControlTable = this.properties.getParameter('table.sessionControl');
        if (sessionParameter && sessionControlTable) {
            let createdFunction = new Lambda.Function(this, this.properties.getAppRefName() + 'DeallocateGamerFn', {
                runtime: Lambda.Runtime.NodeJS610,
                handler: 'index.handler',
                code: Lambda.Code.asset(path.join(lambdasLocation, 'deallocateGamer')),
                environment: {
                    'SESSION_CONTROL_TABLENAME': sessionControlTable.tableName,
                    'SESSION_PARAMETER': sessionParameter.parameterName
                },
                functionName: this.properties.getAppRefName() + 'DeallocateGamerFn',
                description: 'This function deallocates the gamer when a relevant event is identified (sign out, close window etc)',
                memorySize: 128,
                timeout: 60,
                role: new IAM.Role(this, this.properties.getAppRefName() + 'DeallocateGamerFn_Role', {
                    roleName: this.properties.getAppRefName() + 'DeallocateGamerFn_Role',
                    assumedBy: new IAM.ServicePrincipal('lambda.amazonaws.com'),
                    managedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole'],
                    inlinePolicies: {
                        'DynamoDBPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource(sessionControlTable.tableArn)
                            .addAction('dynamodb:GetItem')
                            .addAction('dynamodb:UpdateItem')
                            .addAction('dynamodb:Scan')
                            .addAction('dynamodb:Query')),
                        'SystemsManagerPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:ssm:' + this.properties.region + ':' + this.properties.accountId + ':parameter' + sessionParameter.parameterName)
                            .addAction('ssm:GetParameter')
                            .addAction('ssm:GetParameters')),
                    }
                })
            });
            return createdFunction;
        }
        else
            return undefined;
    }
    getScoreboardFunction() {
        let dlq = new SQS.Queue(this, this.properties.getAppRefName() + 'DLQ', {
            queueName: this.properties.getAppRefName() + 'DLQ'
        });
        /**
         * This function requires access to
         * Queue
         *      process.env.DLQ_URL = "https://sqs.us-east-1.amazonaws.com/232189948602/SpaceInvaders_DLQ"
         * SystemsManager
         *      process.env.SESSION_PARAMETER = /<getAppRefName>/session
         * DynamoDB Tables
         *      process.env.SESSION_TABLENAME = getAppRefName+'Session'
         *      process.env.SESSION_CONTROL_TABLENAME = getAppRefName+'SessionControl'
         *      process.env.SESSIONTOPX_TABLENAME = getAppRefName+'SessionTopX'
         */
        // MISSING PARAMETER - side effect - remove the next line, uncomment the next one.
        let sessionParameter = { parameterName: '/' + this.properties.getAppRefName().toLocaleLowerCase() + '/session' };
        //let sessionParameter: CfnParameter | undefined = <CfnParameter> this.properties.getParameter('parameter.session');
        let sessionControlTable = this.properties.getParameter('table.sessionControl');
        let sessionTopX = this.properties.getParameter('table.sessionTopX');
        let sessionTable = this.properties.getParameter('table.session');
        if (sessionParameter && sessionControlTable && sessionTopX && sessionTable) {
            let createdFunction = new Lambda.Function(this, this.properties.getAppRefName() + 'ScoreboardFn', {
                runtime: Lambda.Runtime.NodeJS610,
                handler: 'index.handler',
                code: Lambda.Code.asset(path.join(lambdasLocation, 'scoreboard')),
                environment: {
                    'DLQ_URL': dlq.queueUrl,
                    'SESSION_PARAMETER': sessionParameter.parameterName,
                    'SESSION_TABLENAME': sessionTable.tableName,
                    'SESSION_CONTROL_TABLENAME': sessionControlTable.tableName,
                    'SESSION_TOPX_TABLENAME': sessionTopX.tableName,
                    'TopXValue': '10'
                },
                functionName: this.properties.getAppRefName() + 'ScoreboardFn',
                description: 'This function computes the scoreboard',
                memorySize: 128,
                timeout: 60,
                role: new IAM.Role(this, this.properties.getAppRefName() + 'ScoreboardFn_Role', {
                    roleName: this.properties.getAppRefName() + 'ScoreboardFn_Role',
                    assumedBy: new IAM.ServicePrincipal('lambda.amazonaws.com'),
                    managedPolicyArns: ['arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole'],
                    inlinePolicies: {
                        'DynamoDBPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:dynamodb:' + this.properties.region + ':' + this.properties.accountId + ':table/' + this.properties.getAppRefName() + '*')
                            .addAction('dynamodb:GetItem')
                            .addAction('dynamodb:UpdateItem')
                            .addAction('dynamodb:Scan')
                            .addAction('dynamodb:Query')
                            .addAction('dynamodb:Batch*')
                            .addAction('dynamodb:PutItem')
                            .addAction('dynamodb:DeleteItem')),
                        'SystemsManagerPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource('arn:aws:ssm:' + this.properties.region + ':' + this.properties.accountId + ':parameter/' + this.properties.getAppRefName().toLowerCase() + '*')
                            .addAction('ssm:Get*')
                            .addAction('ssm:Get*')
                            .addAction('ssm:List*')),
                        'SQSPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addResource(dlq.queueArn)
                            .addAction('sqs:SendMessage')),
                        'KinesisPermissions': new IAM.PolicyDocument().addStatement(new IAM.PolicyStatement()
                            .allow()
                            .addActions("kinesis:SubscribeToShard", "kinesis:GetShardIterator", "kinesis:GetRecords", "kinesis:DescribeStream")
                            .addAllResources())
                    }
                })
            });
            return createdFunction;
        }
        else
            return undefined;
    }
}
exports.ProcessingLayer = ProcessingLayer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzc2luZ0xheWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicHJvY2Vzc2luZ0xheWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsZ0VBQXNGO0FBRXRGLDhDQUErQztBQUMvQyx3Q0FBeUM7QUFFekMsd0NBQXlDO0FBS3pDLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUU3QixNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBQyxJQUFJLEVBQUMsSUFBSSxFQUFDLFNBQVMsQ0FBQyxDQUFDO0FBRWpFLE1BQWEsZUFBZ0IsU0FBUSwyQ0FBc0I7SUFHaEQsc0JBQXNCO1FBQ3pCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztJQUM3QyxDQUFDO0lBQ00sc0JBQXNCO1FBQ3pCLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDO0lBQ2pDLENBQUM7SUFHTSx3QkFBd0I7UUFDM0IsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDO1FBQUEsQ0FBQztJQUNoRCxDQUFDO0lBR00sd0JBQXdCO1FBQzNCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQztJQUMvQyxDQUFDO0lBQ00sd0JBQXdCO1FBQzNCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDO0lBQ25DLENBQUM7SUFFRCxZQUFZLE1BQWlCLEVBQUUsSUFBWSxFQUFFLEtBQTJCO1FBQ3BFLEtBQUssQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzNCLElBQUksZUFBZSxHQUF1QyxJQUFJLENBQUM7UUFFL0QsZUFBZSxHQUFHLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1FBQ2xELElBQUksZUFBZTtZQUFFLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxlQUFlLENBQUM7UUFFN0QsZUFBZSxHQUFHLElBQUksQ0FBQywwQkFBMEIsRUFB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QGF3cy1jZGsvY2RrJztcbmltcG9ydCB7IFJlc291cmNlQXdhcmVDb25zdHJ1Y3QsIElQYXJhbWV0ZXJBd2FyZVByb3BzIH0gZnJvbSAnLi8uLi9yZXNvdXJjZWF3YXJlc3RhY2snXG5cbmltcG9ydCBMYW1iZGEgPSByZXF1aXJlKCdAYXdzLWNkay9hd3MtbGFtYmRhJyk7XG5pbXBvcnQgSUFNID0gcmVxdWlyZSgnQGF3cy1jZGsvYXdzLWlhbScpO1xuXG5pbXBvcnQgU1FTID0gcmVxdWlyZSgnQGF3cy1jZGsvYXdzLXNxcycpO1xuLy8gTUlTU0lORyBQQVJBTUVURVIgIC0gc2lkZSBlZmZlY3QgLSB1bmNvbW1lbnQgdGhlIG5leHQgbGluZSB0byBmaXggaXRcbi8vIGltcG9ydCB7IENmblBhcmFtZXRlciB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1zc20nO1xuaW1wb3J0IHsgVGFibGUgfSBmcm9tICdAYXdzLWNkay9hd3MtZHluYW1vZGInO1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG5jb25zdCBsYW1iZGFzTG9jYXRpb24gPSBwYXRoLmpvaW4oX19kaXJuYW1lLCcuLicsJy4uJywnbGFtYmRhcycpO1xuXG5leHBvcnQgY2xhc3MgUHJvY2Vzc2luZ0xheWVyIGV4dGVuZHMgUmVzb3VyY2VBd2FyZUNvbnN0cnVjdCB7XG5cbiAgICBwcml2YXRlIGFsbG9jYXRlRnVuY3Rpb246IExhbWJkYS5GdW5jdGlvbjtcbiAgICBwdWJsaWMgZ2V0QWxsb2NhdGVGdW5jdGlvbkFybigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWxsb2NhdGVGdW5jdGlvbi5mdW5jdGlvbkFybjtcbiAgICB9XG4gICAgcHVibGljIGdldEFsbG9jYXRlRnVuY3Rpb25SZWYoKSA6IExhbWJkYS5GdW5jdGlvbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmFsbG9jYXRlRnVuY3Rpb247XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZWFsbG9jYXRlRnVuY3Rpb246IExhbWJkYS5GdW5jdGlvbjtcbiAgICBwdWJsaWMgZ2V0RGVhbGxvY2F0ZUZ1bmN0aW9uQXJuKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kZWFsbG9jYXRlRnVuY3Rpb24uZnVuY3Rpb25Bcm47O1xuICAgIH1cblxuICAgIHByaXZhdGUgc2NvcmVib2FyZEZ1bmN0aW9uIDogTGFtYmRhLkZ1bmN0aW9uO1xuICAgIHB1YmxpYyBnZXRTY29yZWJvYXJkRnVuY3Rpb25Bcm4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNjb3JlYm9hcmRGdW5jdGlvbi5mdW5jdGlvbkFybjtcbiAgICB9XG4gICAgcHVibGljIGdldFNjb3JlYm9hcmRGdW5jdGlvblJlZigpIDogTGFtYmRhLkZ1bmN0aW9uIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NvcmVib2FyZEZ1bmN0aW9uO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHBhcmVudDogQ29uc3RydWN0LCBuYW1lOiBzdHJpbmcsIHByb3BzOiBJUGFyYW1ldGVyQXdhcmVQcm9wcykge1xuICAgICAgICBzdXBlcihwYXJlbnQsIG5hbWUsIHByb3BzKTtcbiAgICAgICAgbGV0IGNyZWF0ZWRGdW5jdGlvbjogTGFtYmRhLkZ1bmN0aW9uIHwgdW5kZWZpbmVkIHwgbnVsbCA9IG51bGw7XG5cbiAgICAgICAgY3JlYXRlZEZ1bmN0aW9uID0gdGhpcy5nZXRBbGxvY2F0ZUdhbWVyRnVuY3Rpb24oKTtcbiAgICAgICAgaWYgKGNyZWF0ZWRGdW5jdGlvbikgdGhpcy5hbGxvY2F0ZUZ1bmN0aW9uID0gY3JlYXRlZEZ1bmN0aW9uO1xuXG4gICAgICAgIGNyZWF0ZWRGdW5jdGlvbiA9IHRoaXMuZ2V0RGVhbGxvY2F0ZUdhbWVyRnVuY3Rpb24oKTtcbiAgICAgICAgaWYgKGNyZWF0ZWRGdW5jdGlvbikgdGhpcy5kZWFsbG9jYXRlRnVuY3Rpb24gPSBjcmVhdGVkRnVuY3Rpb247XG5cbiAgICAgICAgY3JlYXRlZEZ1bmN0aW9uID0gdGhpcy5nZXRTY29yZWJvYXJkRnVuY3Rpb24oKTtcbiAgICAgICAgaWYgKGNyZWF0ZWRGdW5jdGlvbikgdGhpcy5zY29yZWJvYXJkRnVuY3Rpb24gPSBjcmVhdGVkRnVuY3Rpb247XG4gICAgICAgIFxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QWxsb2NhdGVHYW1lckZ1bmN0aW9uKCkge1xuICAgICAgICAvKipcbiAgICAqIFRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgYWNjZXNzIHRvIFxuICAgICogU3lzdGVtc01hbmFnZXJcbiAgICAqICAgICAgcHJvY2Vzcy5lbnYuU0VTU0lPTl9QQVJBTUVURVIgPSAvPGdldEFwcFJlZk5hbWU+L3Nlc3Npb25cbiAgICAqIER5bmFtb0RCIFRhYmxlc1xuICAgICogICAgICBwcm9jZXNzLmVudi5TRVNTSU9OX0NPTlRST0xfVEFCTEVOQU1FID0gZ2V0QXBwUmVmTmFtZSsnU2Vzc2lvbkNvbnRyb2wnXG4gICAgKi9cbiAgICAgICAgLy8gTUlTU0lORyBQQVJBTUVURVIgLSBzaWRlIGVmZmVjdCAtIHJlbW92ZSB0aGUgbmV4dCBsaW5lLCB1bmNvbW1lbnQgdGhlIG5leHQgb25lLlxuICAgICAgICBsZXQgc2Vzc2lvblBhcmFtZXRlciA9IHsgcGFyYW1ldGVyTmFtZSA6ICcvJyt0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpLnRvTG9jYWxlTG93ZXJDYXNlKCkrJy9zZXNzaW9uJ307XG4gICAgICAgIC8vbGV0IHNlc3Npb25QYXJhbWV0ZXIgOiBDZm5QYXJhbWV0ZXIgPSA8Q2ZuUGFyYW1ldGVyPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCdwYXJhbWV0ZXIuc2Vzc2lvbicpO1xuICAgICAgICBsZXQgc2Vzc2lvbkNvbnRyb2xUYWJsZSA6IFRhYmxlID0gPFRhYmxlPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCd0YWJsZS5zZXNzaW9uY29udHJvbCcpO1xuICAgICAgICBpZiAoc2Vzc2lvblBhcmFtZXRlciAmJiBzZXNzaW9uQ29udHJvbFRhYmxlKSB7XG4gICAgICAgICAgICBsZXQgY3JlYXRlZEZ1bmN0aW9uOiBMYW1iZGEuRnVuY3Rpb24gPVxuICAgICAgICAgICAgICAgIG5ldyBMYW1iZGEuRnVuY3Rpb24odGhpcywgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdBbGxvY2F0ZUdhbWVyRm4nLCB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bnRpbWU6IExhbWJkYS5SdW50aW1lLk5vZGVKUzYxMCxcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcjogJ2luZGV4LmhhbmRsZXInLFxuICAgICAgICAgICAgICAgICAgICBjb2RlOiBMYW1iZGEuQ29kZS5hc3NldChwYXRoLmpvaW4obGFtYmRhc0xvY2F0aW9uLCdhbGxvY2F0ZUdhbWVyJykpLFxuICAgICAgICAgICAgICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ1NFU1NJT05fQ09OVFJPTF9UQUJMRU5BTUUnOiBzZXNzaW9uQ29udHJvbFRhYmxlLnRhYmxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdTRVNTSU9OX1BBUkFNRVRFUic6IHNlc3Npb25QYXJhbWV0ZXIucGFyYW1ldGVyTmFtZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICwgZnVuY3Rpb25OYW1lOiB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ0FsbG9jYXRlR2FtZXJGbidcbiAgICAgICAgICAgICAgICAgICAgLCBkZXNjcmlwdGlvbjogJ1RoaXMgZnVuY3Rpb24gc3VwcG9ydHMgdGhlIGFsbG9jYXRpb24gb2YgZ2FtZXJzIHdoZW4gdGhlIGdhbWUgaXMgdG8gc3RhcnQnXG4gICAgICAgICAgICAgICAgICAgICwgbWVtb3J5U2l6ZTogMTI4XG4gICAgICAgICAgICAgICAgICAgICwgdGltZW91dDogNjBcbiAgICAgICAgICAgICAgICAgICAgLCByb2xlOiBuZXcgSUFNLlJvbGUodGhpcywgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdBbGxvY2F0ZUdhbWVyRm5fUm9sZScsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGVOYW1lOiB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ0FsbG9jYXRlR2FtZXJGbl9Sb2xlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgLCBhc3N1bWVkQnk6IG5ldyBJQU0uU2VydmljZVByaW5jaXBhbCgnbGFtYmRhLmFtYXpvbmF3cy5jb20nKVxuICAgICAgICAgICAgICAgICAgICAgICAgLCBtYW5hZ2VkUG9saWN5QXJuczogWydhcm46YXdzOmlhbTo6YXdzOnBvbGljeS9zZXJ2aWNlLXJvbGUvQVdTTGFtYmRhQmFzaWNFeGVjdXRpb25Sb2xlJ11cbiAgICAgICAgICAgICAgICAgICAgICAgICwgaW5saW5lUG9saWNpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRHluYW1vREJQZXJtaXNzaW9ucyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5RG9jdW1lbnQoKS5hZGRTdGF0ZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeVN0YXRlbWVudCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFsbG93KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkUmVzb3VyY2Uoc2Vzc2lvbkNvbnRyb2xUYWJsZS50YWJsZUFybilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdkeW5hbW9kYjpHZXRJdGVtJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdkeW5hbW9kYjpVcGRhdGVJdGVtJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdkeW5hbW9kYjpTY2FuJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdkeW5hbW9kYjpRdWVyeScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1N5c3RlbXNNYW5hZ2VyUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKCdhcm46YXdzOnNzbTonK3RoaXMucHJvcGVydGllcy5yZWdpb24rJzonK3RoaXMucHJvcGVydGllcy5hY2NvdW50SWQrJzpwYXJhbWV0ZXInK3Nlc3Npb25QYXJhbWV0ZXIucGFyYW1ldGVyTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdzc206R2V0UGFyYW1ldGVyJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdzc206R2V0UGFyYW1ldGVycycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlZEZ1bmN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldERlYWxsb2NhdGVHYW1lckZ1bmN0aW9uKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBmdW5jdGlvbiByZXF1aXJlcyBhY2Nlc3MgdG8gXG4gICAgICAgICAqIFN5c3RlbXNNYW5hZ2VyXG4gICAgICAgICAqICAgICAgcHJvY2Vzcy5lbnYuU0VTU0lPTl9QQVJBTUVURVIgPSAvPGdldEFwcFJlZk5hbWU+L3Nlc3Npb25cbiAgICAgICAgICogRHluYW1vREIgVGFibGVzXG4gICAgICAgICAqICAgICAgcHJvY2Vzcy5lbnYuU0VTU0lPTl9DT05UUk9MX1RBQkxFTkFNRSA9IGdldEFwcFJlZk5hbWUrJ1Nlc3Npb25Db250cm9sJ1xuICAgICAgICAgKi9cbiAgICAgICAgLy8gTUlTU0lORyBQQVJBTUVURVIgLSBzaWRlIGVmZmVjdCAtIHJlbW92ZSB0aGUgbmV4dCBsaW5lLCB1bmNvbW1lbnQgdGhlIG5leHQgb25lLlxuICAgICAgICBsZXQgc2Vzc2lvblBhcmFtZXRlciA9IHsgcGFyYW1ldGVyTmFtZSA6ICcvJyt0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpLnRvTG9jYWxlTG93ZXJDYXNlKCkrJy9zZXNzaW9uJ307XG4gICAgICAgIC8vbGV0IHNlc3Npb25QYXJhbWV0ZXI6IENmblBhcmFtZXRlciA9IDxDZm5QYXJhbWV0ZXI+ICB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCdwYXJhbWV0ZXIuc2Vzc2lvbicpO1xuICAgICAgICBsZXQgc2Vzc2lvbkNvbnRyb2xUYWJsZTogVGFibGUgfCB1bmRlZmluZWQgPSA8VGFibGU+IHRoaXMucHJvcGVydGllcy5nZXRQYXJhbWV0ZXIoJ3RhYmxlLnNlc3Npb25Db250cm9sJyk7XG4gICAgICAgIGlmIChzZXNzaW9uUGFyYW1ldGVyICYmIHNlc3Npb25Db250cm9sVGFibGUpIHtcbiAgICAgICAgICAgIGxldCBjcmVhdGVkRnVuY3Rpb246IExhbWJkYS5GdW5jdGlvbiA9XG4gICAgICAgICAgICAgICAgbmV3IExhbWJkYS5GdW5jdGlvbih0aGlzLCB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ0RlYWxsb2NhdGVHYW1lckZuJywge1xuICAgICAgICAgICAgICAgICAgICBydW50aW1lOiBMYW1iZGEuUnVudGltZS5Ob2RlSlM2MTAsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6ICdpbmRleC5oYW5kbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgY29kZTogTGFtYmRhLkNvZGUuYXNzZXQocGF0aC5qb2luKGxhbWJkYXNMb2NhdGlvbiwnZGVhbGxvY2F0ZUdhbWVyJykpLFxuICAgICAgICAgICAgICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ1NFU1NJT05fQ09OVFJPTF9UQUJMRU5BTUUnOiBzZXNzaW9uQ29udHJvbFRhYmxlLnRhYmxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdTRVNTSU9OX1BBUkFNRVRFUic6IHNlc3Npb25QYXJhbWV0ZXIucGFyYW1ldGVyTmFtZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICwgZnVuY3Rpb25OYW1lOiB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ0RlYWxsb2NhdGVHYW1lckZuJ1xuICAgICAgICAgICAgICAgICAgICAsIGRlc2NyaXB0aW9uOiAnVGhpcyBmdW5jdGlvbiBkZWFsbG9jYXRlcyB0aGUgZ2FtZXIgd2hlbiBhIHJlbGV2YW50IGV2ZW50IGlzIGlkZW50aWZpZWQgKHNpZ24gb3V0LCBjbG9zZSB3aW5kb3cgZXRjKSdcbiAgICAgICAgICAgICAgICAgICAgLCBtZW1vcnlTaXplOiAxMjhcbiAgICAgICAgICAgICAgICAgICAgLCB0aW1lb3V0OiA2MFxuICAgICAgICAgICAgICAgICAgICAsIHJvbGU6IG5ldyBJQU0uUm9sZSh0aGlzLCB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ0RlYWxsb2NhdGVHYW1lckZuX1JvbGUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb2xlTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdEZWFsbG9jYXRlR2FtZXJGbl9Sb2xlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgLCBhc3N1bWVkQnk6IG5ldyBJQU0uU2VydmljZVByaW5jaXBhbCgnbGFtYmRhLmFtYXpvbmF3cy5jb20nKVxuICAgICAgICAgICAgICAgICAgICAgICAgLCBtYW5hZ2VkUG9saWN5QXJuczogWydhcm46YXdzOmlhbTo6YXdzOnBvbGljeS9zZXJ2aWNlLXJvbGUvQVdTTGFtYmRhQmFzaWNFeGVjdXRpb25Sb2xlJ11cbiAgICAgICAgICAgICAgICAgICAgICAgICwgaW5saW5lUG9saWNpZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRHluYW1vREJQZXJtaXNzaW9ucyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJQU0uUG9saWN5RG9jdW1lbnQoKS5hZGRTdGF0ZW1lbnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeVN0YXRlbWVudCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFsbG93KClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkUmVzb3VyY2Uoc2Vzc2lvbkNvbnRyb2xUYWJsZS50YWJsZUFybilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdkeW5hbW9kYjpHZXRJdGVtJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdkeW5hbW9kYjpVcGRhdGVJdGVtJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdkeW5hbW9kYjpTY2FuJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdkeW5hbW9kYjpRdWVyeScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1N5c3RlbXNNYW5hZ2VyUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKCdhcm46YXdzOnNzbTonK3RoaXMucHJvcGVydGllcy5yZWdpb24rJzonK3RoaXMucHJvcGVydGllcy5hY2NvdW50SWQrJzpwYXJhbWV0ZXInK3Nlc3Npb25QYXJhbWV0ZXIucGFyYW1ldGVyTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdzc206R2V0UGFyYW1ldGVyJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdzc206R2V0UGFyYW1ldGVycycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlZEZ1bmN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldFNjb3JlYm9hcmRGdW5jdGlvbigpIHtcblxuICAgICAgICBsZXQgZGxxID0gbmV3IFNRUy5RdWV1ZSh0aGlzLCB0aGlzLnByb3BlcnRpZXMuZ2V0QXBwUmVmTmFtZSgpICsgJ0RMUScsIHtcbiAgICAgICAgICAgIHF1ZXVlTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdETFEnXG4gICAgICAgIH0pXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoaXMgZnVuY3Rpb24gcmVxdWlyZXMgYWNjZXNzIHRvIFxuICAgICAgICAgKiBRdWV1ZVxuICAgICAgICAgKiAgICAgIHByb2Nlc3MuZW52LkRMUV9VUkwgPSBcImh0dHBzOi8vc3FzLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tLzIzMjE4OTk0ODYwMi9TcGFjZUludmFkZXJzX0RMUVwiXG4gICAgICAgICAqIFN5c3RlbXNNYW5hZ2VyXG4gICAgICAgICAqICAgICAgcHJvY2Vzcy5lbnYuU0VTU0lPTl9QQVJBTUVURVIgPSAvPGdldEFwcFJlZk5hbWU+L3Nlc3Npb25cbiAgICAgICAgICogRHluYW1vREIgVGFibGVzXG4gICAgICAgICAqICAgICAgcHJvY2Vzcy5lbnYuU0VTU0lPTl9UQUJMRU5BTUUgPSBnZXRBcHBSZWZOYW1lKydTZXNzaW9uJ1xuICAgICAgICAgKiAgICAgIHByb2Nlc3MuZW52LlNFU1NJT05fQ09OVFJPTF9UQUJMRU5BTUUgPSBnZXRBcHBSZWZOYW1lKydTZXNzaW9uQ29udHJvbCdcbiAgICAgICAgICogICAgICBwcm9jZXNzLmVudi5TRVNTSU9OVE9QWF9UQUJMRU5BTUUgPSBnZXRBcHBSZWZOYW1lKydTZXNzaW9uVG9wWCdcbiAgICAgICAgICovXG4gICAgICAgIC8vIE1JU1NJTkcgUEFSQU1FVEVSIC0gc2lkZSBlZmZlY3QgLSByZW1vdmUgdGhlIG5leHQgbGluZSwgdW5jb21tZW50IHRoZSBuZXh0IG9uZS5cbiAgICAgICAgbGV0IHNlc3Npb25QYXJhbWV0ZXIgPSB7IHBhcmFtZXRlck5hbWUgOiAnLycrdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKS50b0xvY2FsZUxvd2VyQ2FzZSgpKycvc2Vzc2lvbid9O1xuICAgICAgICAvL2xldCBzZXNzaW9uUGFyYW1ldGVyOiBDZm5QYXJhbWV0ZXIgfCB1bmRlZmluZWQgPSA8Q2ZuUGFyYW1ldGVyPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCdwYXJhbWV0ZXIuc2Vzc2lvbicpO1xuICAgICAgICBsZXQgc2Vzc2lvbkNvbnRyb2xUYWJsZTogVGFibGUgfCB1bmRlZmluZWQgPSA8VGFibGU+IHRoaXMucHJvcGVydGllcy5nZXRQYXJhbWV0ZXIoJ3RhYmxlLnNlc3Npb25Db250cm9sJyk7XG4gICAgICAgIGxldCBzZXNzaW9uVG9wWDogVGFibGUgfCB1bmRlZmluZWQgPSA8VGFibGU+IHRoaXMucHJvcGVydGllcy5nZXRQYXJhbWV0ZXIoJ3RhYmxlLnNlc3Npb25Ub3BYJyk7XG4gICAgICAgIGxldCBzZXNzaW9uVGFibGU6IFRhYmxlIHwgdW5kZWZpbmVkID0gPFRhYmxlPiB0aGlzLnByb3BlcnRpZXMuZ2V0UGFyYW1ldGVyKCd0YWJsZS5zZXNzaW9uJyk7XG4gICAgICAgIGlmIChzZXNzaW9uUGFyYW1ldGVyICYmIHNlc3Npb25Db250cm9sVGFibGUgJiYgc2Vzc2lvblRvcFggJiYgc2Vzc2lvblRhYmxlKSB7XG4gICAgICAgICAgICBsZXQgY3JlYXRlZEZ1bmN0aW9uOiBMYW1iZGEuRnVuY3Rpb24gPVxuICAgICAgICAgICAgICAgIG5ldyBMYW1iZGEuRnVuY3Rpb24odGhpcywgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdTY29yZWJvYXJkRm4nLCB7XG4gICAgICAgICAgICAgICAgICAgIHJ1bnRpbWU6IExhbWJkYS5SdW50aW1lLk5vZGVKUzYxMCxcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcjogJ2luZGV4LmhhbmRsZXInLFxuICAgICAgICAgICAgICAgICAgICBjb2RlOiBMYW1iZGEuQ29kZS5hc3NldChwYXRoLmpvaW4obGFtYmRhc0xvY2F0aW9uLCdzY29yZWJvYXJkJykpLFxuICAgICAgICAgICAgICAgICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0RMUV9VUkwnOiBkbHEucXVldWVVcmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAnU0VTU0lPTl9QQVJBTUVURVInOiBzZXNzaW9uUGFyYW1ldGVyLnBhcmFtZXRlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnU0VTU0lPTl9UQUJMRU5BTUUnOiBzZXNzaW9uVGFibGUudGFibGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1NFU1NJT05fQ09OVFJPTF9UQUJMRU5BTUUnOiBzZXNzaW9uQ29udHJvbFRhYmxlLnRhYmxlTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdTRVNTSU9OX1RPUFhfVEFCTEVOQU1FJzogc2Vzc2lvblRvcFgudGFibGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ1RvcFhWYWx1ZSc6ICcxMCdcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAsIGZ1bmN0aW9uTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdTY29yZWJvYXJkRm4nXG4gICAgICAgICAgICAgICAgICAgICwgZGVzY3JpcHRpb246ICdUaGlzIGZ1bmN0aW9uIGNvbXB1dGVzIHRoZSBzY29yZWJvYXJkJ1xuICAgICAgICAgICAgICAgICAgICAsIG1lbW9yeVNpemU6IDEyOFxuICAgICAgICAgICAgICAgICAgICAsIHRpbWVvdXQ6IDYwXG4gICAgICAgICAgICAgICAgICAgICwgcm9sZTogbmV3IElBTS5Sb2xlKHRoaXMsIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnU2NvcmVib2FyZEZuX1JvbGUnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb2xlTmFtZTogdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKSArICdTY29yZWJvYXJkRm5fUm9sZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICwgYXNzdW1lZEJ5OiBuZXcgSUFNLlNlcnZpY2VQcmluY2lwYWwoJ2xhbWJkYS5hbWF6b25hd3MuY29tJylcbiAgICAgICAgICAgICAgICAgICAgICAgICwgbWFuYWdlZFBvbGljeUFybnM6IFsnYXJuOmF3czppYW06OmF3czpwb2xpY3kvc2VydmljZS1yb2xlL0FXU0xhbWJkYUJhc2ljRXhlY3V0aW9uUm9sZSddXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGlubGluZVBvbGljaWVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0R5bmFtb0RCUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKCdhcm46YXdzOmR5bmFtb2RiOicgKyB0aGlzLnByb3BlcnRpZXMucmVnaW9uICsgJzonICsgdGhpcy5wcm9wZXJ0aWVzLmFjY291bnRJZCArICc6dGFibGUvJyArIHRoaXMucHJvcGVydGllcy5nZXRBcHBSZWZOYW1lKCkgKyAnKicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6R2V0SXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6VXBkYXRlSXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6U2NhbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6UXVlcnknKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ2R5bmFtb2RiOkJhdGNoKicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6UHV0SXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignZHluYW1vZGI6RGVsZXRlSXRlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1N5c3RlbXNNYW5hZ2VyUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKCdhcm46YXdzOnNzbTonICsgdGhpcy5wcm9wZXJ0aWVzLnJlZ2lvbiArICc6JyArIHRoaXMucHJvcGVydGllcy5hY2NvdW50SWQgKyAnOnBhcmFtZXRlci8nICsgdGhpcy5wcm9wZXJ0aWVzLmdldEFwcFJlZk5hbWUoKS50b0xvd2VyQ2FzZSgpICsgJyonKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBY3Rpb24oJ3NzbTpHZXQqJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdzc206R2V0KicpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbignc3NtOkxpc3QqJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU1FTUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZFJlc291cmNlKGRscS5xdWV1ZUFybilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQWN0aW9uKCdzcXM6U2VuZE1lc3NhZ2UnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdLaW5lc2lzUGVybWlzc2lvbnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgSUFNLlBvbGljeURvY3VtZW50KCkuYWRkU3RhdGVtZW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IElBTS5Qb2xpY3lTdGF0ZW1lbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbGxvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZEFjdGlvbnMoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwia2luZXNpczpTdWJzY3JpYmVUb1NoYXJkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwia2luZXNpczpHZXRTaGFyZEl0ZXJhdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwia2luZXNpczpHZXRSZWNvcmRzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwia2luZXNpczpEZXNjcmliZVN0cmVhbVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRBbGxSZXNvdXJjZXMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRlZEZ1bmN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbn1cblxuIl19