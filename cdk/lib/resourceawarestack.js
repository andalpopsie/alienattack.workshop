"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cdk_1 = require("@aws-cdk/cdk");
class ResourceBag {
    constructor(resources) {
        if (resources && resources.getResources()) {
            if (!this.resources)
                this.resources = new Map();
            resources.getResources().forEach((v, k) => {
                this.resources.set(k.toLowerCase(), v);
            });
        }
        ;
    }
    getResources() {
        return this.resources;
    }
    ;
    addResources(resources) {
        if (resources) {
            if (!this.resources)
                this.resources = new Map();
            for (let resourceName of resources.keys()) {
                let name = resourceName.toLowerCase();
                this.resources.set(name, resources.get(name));
            }
        }
    }
    ;
    addResource(key, resource) {
        if (resource) {
            if (!this.resources)
                this.resources = new Map();
            this.resources.set(key.toLowerCase(), resource);
        }
    }
    getResource(key) {
        return this.resources.get(key.toLowerCase());
    }
    getResourcesNames() {
        if (this.resources)
            return this.resources.keys();
        else
            return [];
    }
}
exports.ResourceBag = ResourceBag;
class ParameterAwareProps {
    constructor(props) {
        this.applicationName = (props && props.applicationName && props.applicationName.length > 0) ? props.applicationName : ParameterAwareProps.defaultApplicationName;
        this.suffix = (props && props.suffix && props.suffix.length > 0) ? props.suffix : '';
        if (props) {
            this.suffix = props.suffix;
            this.region = props.region;
            this.accountId = props.accountId;
            if (props.getParameters())
                props.getParameters().forEach((v, k) => this.addParameter(k, v));
        }
    }
    setApplicationName(appName) {
        if (appName && appName.length > 0)
            this.applicationName = appName;
    }
    getAppRefName() {
        let appName = this.applicationName ? this.applicationName : ParameterAwareProps.defaultApplicationName;
        if (this.suffix && this.suffix.length > 0)
            return appName + this.suffix;
        else
            return appName;
    }
    setSuffix(suffix) {
        if (suffix && suffix.length > 0)
            this.suffix = suffix;
    }
    getParameters() {
        return this.parameters;
    }
    ;
    addParameters(parameters) {
        if (parameters) {
            if (!this.parameters)
                this.parameters = new Map();
            for (let parameterName of parameters.keys()) {
                this.parameters.set(parameterName.toLowerCase(), parameters.get(parameterName));
            }
        }
    }
    ;
    addParameter(key, parameter) {
        if (parameter) {
            if (!this.parameters)
                this.parameters = new Map();
            this.parameters.set(key.toLowerCase(), parameter);
        }
    }
    getParameter(key) {
        if (!this.parameters)
            this.parameters = new Map();
        return this.parameters.get(key.toLowerCase());
    }
}
// handling/defining the application name.
// Default is NRTA - Near Real-Time Application
ParameterAwareProps.defaultApplicationName = 'NRTA';
exports.ParameterAwareProps = ParameterAwareProps;
class ResourceAwareStack extends cdk_1.Stack {
    constructor(parent, name, props) {
        super(parent, name, props);
        this.scope = parent;
        if (!this.properties)
            this.properties = new ParameterAwareProps(props);
        if (!this.properties.accountId)
            this.properties.accountId = this.accountId;
        if (!this.properties.region)
            this.properties.region = this.region;
    }
    getResources() {
        return this.resources;
    }
    ;
    addResources(resources) {
        if (resources) {
            if (!this.resources)
                this.resources = new Map();
            for (let resourceName of resources.keys()) {
                let name = resourceName.toLowerCase();
                this.resources.set(name, resources.get(name));
            }
        }
    }
    ;
    addResource(key, resource) {
        if (resource) {
            if (!this.resources)
                this.resources = new Map();
            this.resources.set(key.toLowerCase(), resource);
        }
    }
    getResource(key) {
        if (!this.resources)
            this.resources = new Map();
        return this.resources.get(key.toLowerCase());
    }
    getResourcesNames() {
        if (this.resources)
            return this.resources.keys();
        else
            return [];
    }
    getProperties() {
        return this.properties;
    }
}
exports.ResourceAwareStack = ResourceAwareStack;
class ResourceAwareConstruct extends cdk_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        this.properties = props;
    }
    getResources() {
        return this.resources;
    }
    ;
    addResources(resources) {
        if (resources) {
            if (!this.resources)
                this.resources = new Map();
            for (let resourceName of resources.keys()) {
                let name = resourceName.toLowerCase();
                this.resources.set(name, resources.get(name));
            }
        }
    }
    ;
    addResource(key, resource) {
        if (resource) {
            if (!this.resources)
                this.resources = new Map();
            this.resources.set(key.toLowerCase(), resource);
        }
    }
    getResource(key) {
        return this.resources.get(key.toLowerCase());
    }
    getResourcesNames() {
        if (this.resources)
            return this.resources.keys();
        else
            return [];
    }
    getProperties() {
        return this.properties;
    }
}
exports.ResourceAwareConstruct = ResourceAwareConstruct;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVzb3VyY2Vhd2FyZXN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicmVzb3VyY2Vhd2FyZXN0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQStEO0FBNEIvRCxNQUFhLFdBQVc7SUFJcEIsWUFBWSxTQUEyQjtRQUNuQyxJQUFJLFNBQVMsSUFBSSxTQUFTLENBQUMsWUFBWSxFQUFFLEVBQUU7WUFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTO2dCQUFFLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxHQUFHLEVBQWMsQ0FBQztZQUM1RCxTQUFTLENBQUMsWUFBWSxFQUFFLENBQUMsT0FBTyxDQUFFLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBRSxFQUFFO2dCQUN0QyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUMsQ0FBQyxDQUFDLENBQUE7U0FDTDtRQUFBLENBQUM7SUFDTixDQUFDO0lBRUQsWUFBWTtRQUNSLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUMxQixDQUFDO0lBQUEsQ0FBQztJQUVGLFlBQVksQ0FBQyxTQUEyQjtRQUNwQyxJQUFJLFNBQVMsRUFBRTtZQUNYLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUztnQkFBRSxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksR0FBRyxFQUFjLENBQUM7WUFDNUQsS0FBSyxJQUFJLFlBQVksSUFBSSxTQUFTLENBQUMsSUFBSSxFQUFFLEVBQUU7Z0JBQ3ZDLElBQUksSUFBSSxHQUFHLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDdEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUNqRDtTQUNKO0lBQ0wsQ0FBQztJQUFBLENBQUM7SUFFRixXQUFXLENBQUMsR0FBVyxF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UyxHQUFHLElBQUksR0FBRyxFQUFjLENBQUM7WUFDNUQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxFQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ2xEO0lBQ0wsQ0FBQztJQUVELFdBQVcsQ0FBQyxHQUFXO1FBQ25CLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVELGlCQUFpQjtRQUNiLElBQUksSUFBSSxDQUFDLFNBQVM7WUFBRSxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7O1lBQzVDLE9BQU8sRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFFRCxhQUFhO1FBQ1QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBQzNCLENBQUM7Q0FDSjtBQTNDRCx3REEyQ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0FwcCwgU3RhY2ssIENvbnN0cnVjdCwgU3RhY2tQcm9wc30gZnJvbSAnQGF3cy1jZGsvY2RrJztcblxuZXhwb3J0IGludGVyZmFjZSBJRmxleE5hbWVBcHBsaWNhdGlvbiB7XG4gICAgYXBwbGljYXRpb25OYW1lPyA6IHN0cmluZyxcbiAgICBzdWZmaXg/OiBzdHJpbmcsXG4gICAgZ2V0QXBwUmVmTmFtZSgpIDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVJlc291cmNlQXdhcmUge1xuICAgIGdldFJlc291cmNlcygpIDogTWFwPHN0cmluZyxhbnk+O1xuICAgIGdldFJlc291cmNlKHJlc291cmNlTmFtZTogc3RyaW5nKSA6IGFueSB8IHVuZGVmaW5lZDtcbiAgICBhZGRSZXNvdXJjZXMocmVzb3VyY2VzIDogTWFwPHN0cmluZyxhbnk+KSA6IHZvaWQ7XG4gICAgYWRkUmVzb3VyY2UobWFwOiBzdHJpbmcsIHJlc291cmNlOmFueSkgOiB2b2lkO1xuICAgIGdldFJlc291cmNlc05hbWVzKCkgOiBJdGVyYWJsZUl0ZXJhdG9yPHN0cmluZz4gfCBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJUGFyYW1ldGVyQXdhcmUge1xuICAgIGdldFBhcmFtZXRlcnMoKSA6IE1hcDxzdHJpbmcsYW55PjtcbiAgICBnZXRQYXJhbWV0ZXIocGFyYW1ldGVyTmFtZTogc3RyaW5nKSA6IGFueSB8IHVuZGVmaW5lZDtcbiAgICBhZGRQYXJhbWV0ZXJzKHBhcmFtZXRlcnMgOiBNYXA8c3RyaW5nLGFueT4pIDogdm9pZDtcbiAgICBhZGRQYXJhbWV0ZXIobWFwOiBzdHJpbmcsIHJlc291cmNlOmFueSkgOiB2b2lkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElEZXBsb3ltZW50VGFyZ2V0IHtcbiAgICBhY2NvdW50SWQ/IDogc3RyaW5nLFxuICAgIHJlZ2lvbj8gOiBzdHJpbmdcbn1cblxuZXhwb3J0IGNsYXNzIFJlc291cmNlQmFnIGltcGxlbWVudHMgSVJlc291cmNlQXdhcmUge1xuXG4gICAgcHJpdmF0ZSByZXNvdXJjZXMgOiBNYXA8c3RyaW5nLGFueT47XG5cbiAgICBjb25zdHJ1Y3RvcihyZXNvdXJjZXM/IDogSVJlc291cmNlQXdhcmUpIHtcbiAgICAgICAgaWYgKHJlc291cmNlcyAmJiByZXNvdXJjZXMuZ2V0UmVzb3VyY2VzKCkpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5yZXNvdXJjZXMpIHRoaXMucmVzb3VyY2VzID0gbmV3IE1hcDxzdHJpbmcsYW55PigpO1xuICAgICAgICAgICAgcmVzb3VyY2VzLmdldFJlc291cmNlcygpLmZvckVhY2goICh2LGspID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc291cmNlcy5zZXQoay50b0xvd2VyQ2FzZSgpLHYpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBnZXRSZXNvdXJjZXMoKSA6IE1hcDxzdHJpbmcsYW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc291cmNlcztcbiAgICB9O1xuICAgIFxuICAgIGFkZFJlc291cmNlcyhyZXNvdXJjZXMgOiBNYXA8c3RyaW5nLGFueT4pIHtcbiAgICAgICAgaWYgKHJlc291cmNlcykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnJlc291cmNlcykgdGhpcy5yZXNvdXJjZXMgPSBuZXcgTWFwPHN0cmluZyxhbnk+KCk7XG4gICAgICAgICAgICBmb3IgKGxldCByZXNvdXJjZU5hbWUgb2YgcmVzb3VyY2VzLmtleXMoKSkge1xuICAgICAgICAgICAgICAgIGxldCBuYW1lID0gcmVzb3VyY2VOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNvdXJjZXMuc2V0KG5hbWUsIHJlc291cmNlcy5nZXQobmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBcbiAgICBhZGRSZXNvdXJjZShrZXk6IHN0cmluZywgcmVzb3VyY2U6YW55KSA6IHZvaWQge1xuICAgICAgICBpZiAocmVzb3VyY2UpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5yZXNvdXJjZXMpIHRoaXMucmVzb3VyY2VzID0gbmV3IE1hcDxzdHJpbmcsYW55PigpO1xuICAgICAgICAgICAgdGhpcy5yZXNvdXJjZXMuc2V0KGtleS50b0xvd2VyQ2FzZSgpLHJlc291cmNlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFJlc291cmNlKGtleTogc3RyaW5nKSA6IGFueSB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc291cmNlcy5nZXQoa2V5LnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cblxuICAgIGdldFJlc291cmNlc05hbWVzKCkge1xuICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMpIHJldHVybiB0aGlzLnJlc291cmNlcy5rZXlzKCk7XG4gICAgICAgIGVsc2UgcmV0dXJuIFtdOyBcbiAgICB9XG5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJUGFyYW1ldGVyQXdhcmVQcm9wcyBleHRlbmRzIFN0YWNrUHJvcHMsIElQYXJhbWV0ZXJBd2FyZSwgSUZsZXhOYW1lQXBwbGljYXRpb24sIElEZXBsb3ltZW50VGFyZ2V0IHtcbn1cblxuZXhwb3J0IGNsYXNzIFBhcmFtZXRlckF3YXJlUHJvcHMgaW1wbGVtZW50cyBJUGFyYW1ldGVyQXdhcmVQcm9wcyB7XG5cbiAgICBhY2NvdW50SWQ/IDogc3RyaW5nO1xuICAgIHJlZ2lvbj8gOiBzdHJpbmc7XG4gICAgXG4gICAgXG4gICAgLy8gaGFuZGxpbmcvZGVmaW5pbmcgdGhlIGFwcGxpY2F0aW9uIG5hbWUuXG4gICAgLy8gRGVmYXVsdCBpcyBOUlRBIC0gTmVhciBSZWFsLVRpbWUgQXBwbGljYXRpb25cbiAgICBzdGF0aWMgZGVmYXVsdEFwcGxpY2F0aW9uTmFtZSA6IHN0cmluZyA9ICdOUlRBJztcbiAgICBhcHBsaWNhdGlvbk5hbWU/IDogc3RyaW5nO1xuICAgIHNldEFwcGxpY2F0aW9uTmFtZShhcHBOYW1lIDogc3RyaW5nKSB7XG4gICAgICAgIGlmIChhcHBOYW1lICYmIGFwcE5hbWUubGVuZ3RoPjApIHRoaXMuYXBwbGljYXRpb25OYW1lID0gYXBwTmFtZTtcbiAgICB9XG4gICAgZ2V0QXBwUmVmTmFtZSgpIHtcbiAgICAgICAgbGV0IGFwcE5hbWUgPSB0aGlzLmFwcGxpY2F0aW9uTmFtZSA/IHRoaXMuYXBwbGljYXRpb25OYW1lICA6IFBhcmFtZXRlckF3YXJlUHJvcHMuZGVmYXVsdEFwcGxpY2F0aW9uTmFtZTtcbiAgICAgICAgaWYgKHRoaXMuc3VmZml4ICYmIHRoaXMuc3VmZml4Lmxlbmd0aD4wKSAgcmV0dXJuIGFwcE5hbWUrdGhpcy5zdWZmaXg7XG4gICAgICAgIGVsc2UgcmV0dXJuIGFwcE5hbWU7XG4gICAgfSAgICBcbiAgICBzdWZmaXg/OiBzdHJpbmc7XG4gICAgc2V0U3VmZml4KHN1ZmZpeCA6IHN0cmluZykge1xuICAgICAgICBpZiAoc3VmZml4ICYmIHN1ZmZpeC5sZW5ndGg+MCkgdGhpcy5zdWZmaXggPSBzdWZmaXg7XG4gICAgfVxuICAgIFxuICAgIHBhcmFtZXRlcnMgOiBNYXA8c3RyaW5nLGFueT47XG5cbiAgICBcbiAgICBnZXRQYXJhbWV0ZXJzKCkgOiBNYXA8c3RyaW5nLGFueT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJhbWV0ZXJzO1xuICAgIH07XG4gICAgXG4gICAgYWRkUGFyYW1ldGVycyhwYXJhbWV0ZXJzIDogTWFwPHN0cmluZyxhbnk+KSB7XG4gICAgICAgIGlmIChwYXJhbWV0ZXJzKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMucGFyYW1ldGVycykgdGhpcy5wYXJhbWV0ZXJzID0gbmV3IE1hcDxzdHJpbmcsYW55PigpO1xuICAgICAgICAgICAgZm9yIChsZXQgcGFyYW1ldGVyTmFtZSBvZiBwYXJhbWV0ZXJzLmtleXMoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGFyYW1ldGVycy5zZXQocGFyYW1ldGVyTmFtZS50b0xvd2VyQ2FzZSgpLCBwYXJhbWV0ZXJzLmdldChwYXJhbWV0ZXJOYW1lKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgXG4gICAgYWRkUGFyYW1ldGVyKGtleTogc3RyaW5nLCBwYXJhbWV0ZXI6YW55KSA6IHZvaWQge1xuICAgICAgICBpZiAocGFyYW1ldGVyKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMucGFyYW1ldGVycykgdGhpcy5wYXJhbWV0ZXJzID0gbmV3IE1hcDxzdHJpbmcsYW55PigpO1xuICAgICAgICAgICAgdGhpcy5wYXJhbWV0ZXJzLnNldChrZXkudG9Mb3dlckNhc2UoKSxwYXJhbWV0ZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0UGFyYW1ldGVyKGtleTogc3RyaW5nKSA6IGFueSB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGlmICghdGhpcy5wYXJhbWV0ZXJzKSB0aGlzLnBhcmFtZXRlcnMgPSBuZXcgTWFwPHN0cmluZyxhbnk+KCk7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcmFtZXRlcnMuZ2V0KGtleS50b0xvd2VyQ2FzZSgpKTtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcz86IElQYXJhbWV0ZXJBd2FyZVByb3BzKSB7XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb25OYW1lID0gKHByb3BzICYmIHByb3BzLmFwcGxpY2F0aW9uTmFtZSAmJiBwcm9wcy5hcHBsaWNhdGlvbk5hbWUubGVuZ3RoID4gMCkgPyBwcm9wcy5hcHBsaWNhdGlvbk5hbWUgOiBQYXJhbWV0ZXJBd2FyZVByb3BzLmRlZmF1bHRBcHBsaWNhdGlvbk5hbWU7XG4gICAgICAgIHRoaXMuc3VmZml4ID0gIChwcm9wcyAmJiBwcm9wcy5zdWZmaXggJiYgcHJvcHMuc3VmZml4Lmxlbmd0aD4wKSA/IHByb3BzLnN1ZmZpeCA6ICAnJztcbiAgICAgICAgaWYgKHByb3BzKSB7XG4gICAgICAgICAgICB0aGlzLnN1ZmZpeCA9IHByb3BzLnN1ZmZpeDtcbiAgICAgICAgICAgIHRoaXMucmVnaW9uID0gcHJvcHMucmVnaW9uO1xuICAgICAgICAgICAgdGhpcy5hY2NvdW50SWQgPSBwcm9wcy5hY2NvdW50SWQ7XG4gICAgICAgICAgICBpZiAocHJvcHMuZ2V0UGFyYW1ldGVycygpKSBwcm9wcy5nZXRQYXJhbWV0ZXJzKCkuZm9yRWFjaCggKHYsaykgPT4gdGhpcy5hZGRQYXJhbWV0ZXIoayx2KSApO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5cbmV4cG9ydCBjbGFzcyBSZXNvdXJjZUF3YXJlU3RhY2sgZXh0ZW5kcyBTdGFjayBpbXBsZW1lbnRzIElSZXNvdXJjZUF3YXJlIHtcblxuICAgIHByb3RlY3RlZCByZXNvdXJjZXMgOiBNYXA8c3RyaW5nLGFueT47XG4gICAgcHJvdGVjdGVkIHNjb3BlIDogQXBwO1xuICAgIHByb3RlY3RlZCBwcm9wZXJ0aWVzIDogSVBhcmFtZXRlckF3YXJlUHJvcHM7XG5cbiAgICBjb25zdHJ1Y3RvcihwYXJlbnQgOiBBcHAsIG5hbWU6IHN0cmluZywgcHJvcHM/OiBJUGFyYW1ldGVyQXdhcmVQcm9wcykge1xuICAgICAgICBzdXBlcihwYXJlbnQsbmFtZSxwcm9wcyk7XG4gICAgICAgIHRoaXMuc2NvcGUgPSBwYXJlbnQ7XG4gICAgICAgIGlmICghdGhpcy5wcm9wZXJ0aWVzKSB0aGlzLnByb3BlcnRpZXMgPSBuZXcgUGFyYW1ldGVyQXdhcmVQcm9wcyhwcm9wcyk7XG4gICAgICAgIGlmICghdGhpcy5wcm9wZXJ0aWVzLmFjY291bnRJZCkgdGhpcy5wcm9wZXJ0aWVzLmFjY291bnRJZCA9IHRoaXMuYWNjb3VudElkO1xuICAgICAgICBpZiAoIXRoaXMucHJvcGVydGllcy5yZWdpb24pIHRoaXMucHJvcGVydGllcy5yZWdpb24gPSB0aGlzLnJlZ2lvbjtcbiAgICB9XG4gICAgXG4gICAgZ2V0UmVzb3VyY2VzKCkgOiBNYXA8c3RyaW5nLGFueT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXNvdXJjZXM7XG4gICAgfTtcbiAgICBcbiAgICBhZGRSZXNvdXJjZXMocmVzb3VyY2VzIDogTWFwPHN0cmluZyxhbnk+KSB7XG4gICAgICAgIGlmIChyZXNvdXJjZXMpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5yZXNvdXJjZXMpIHRoaXMucmVzb3VyY2VzID0gbmV3IE1hcDxzdHJpbmcsYW55PigpO1xuICAgICAgICAgICAgZm9yIChsZXQgcmVzb3VyY2VOYW1lIG9mIHJlc291cmNlcy5rZXlzKCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgbmFtZSA9IHJlc291cmNlTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVzb3VyY2VzLnNldChuYW1lLCByZXNvdXJjZXMuZ2V0KG5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgXG4gICAgYWRkUmVzb3VyY2Uoa2V5OiBzdHJpbmcsIHJlc291cmNlOmFueSkgOiB2b2lkIHtcbiAgICAgICAgaWYgKHJlc291cmNlKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMucmVzb3VyY2VzKSB0aGlzLnJlc291cmNlcyA9IG5ldyBNYXA8c3RyaW5nLGFueT4oKTtcbiAgICAgICAgICAgIHRoaXMucmVzb3VyY2VzLnNldChrZXkudG9Mb3dlckNhc2UoKSxyZXNvdXJjZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRSZXNvdXJjZShrZXk6IHN0cmluZykgOiBhbnkgfCB1bmRlZmluZWQge1xuICAgICAgICBpZiAoIXRoaXMucmVzb3VyY2VzKSB0aGlzLnJlc291cmNlcyA9IG5ldyBNYXA8c3RyaW5nLGFueT4oKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzb3VyY2VzLmdldChrZXkudG9Mb3dlckNhc2UoKSk7XG4gICAgfVxuXG4gICAgZ2V0UmVzb3VyY2VzTmFtZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlc291cmNlcykgcmV0dXJuIHRoaXMucmVzb3VyY2VzLmtleXMoKTtcbiAgICAgICAgZWxzZSByZXR1cm4gW107IFxuICAgIH1cblxuICAgIGdldFByb3BlcnRpZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BlcnRpZXM7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBjbGFzcyBSZXNvdXJjZUF3YXJlQ29uc3RydWN0IGV4dGVuZHMgQ29uc3RydWN0IGltcGxlbWVudHMgSVJlc291cmNlQXdhcmUge1xuXG4gICAgcmVzb3VyY2VzIDogTWFwPHN0cmluZyxhbnk+O1xuICAgIHByb3RlY3RlZCBwcm9wZXJ0aWVzIDogSVBhcmFtZXRlckF3YXJlUHJvcHM7XG5cbiAgICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogSVBhcmFtZXRlckF3YXJlUHJvcHMpIHtcbiAgICAgICAgc3VwZXIoc2NvcGUsaWQpO1xuICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSBwcm9wcztcbiAgICB9XG5cbiAgICBnZXRSZXNvdXJjZXMoKSA6IE1hcDxzdHJpbmcsYW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc291cmNlcztcbiAgICB9O1xuICAgIFxuICAgIGFkZFJlc291cmNlcyhyZXNvdXJjZXMgOiBNYXA8c3RyaW5nLGFueT4pIHtcbiAgICAgICAgaWYgKHJlc291cmNlcykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnJlc291cmNlcykgdGhpcy5yZXNvdXJjZXMgPSBuZXcgTWFwPHN0cmluZyxhbnk+KCk7XG4gICAgICAgICAgICBmb3IgKGxldCByZXNvdXJjZU5hbWUgb2YgcmVzb3VyY2VzLmtleXMoKSkge1xuICAgICAgICAgICAgICAgIGxldCBuYW1lID0gcmVzb3VyY2VOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNvdXJjZXMuc2V0KG5hbWUsIHJlc291cmNlcy5nZXQobmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBcbiAgICBhZGRSZXNvdXJjZShrZXk6IHN0cmluZywgcmVzb3VyY2U6YW55KSA6IHZvaWQge1xuICAgICAgICBpZiAocmVzb3VyY2UpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5yZXNvdXJjZXMpIHRoaXMucmVzb3VyY2VzID0gbmV3IE1hcDxzdHJpbmcsYW55PigpO1xuICAgICAgICAgICAgdGhpcy5yZXNvdXJjZXMuc2V0KGtleS50b0xvd2VyQ2FzZSgpLHJlc291cmNlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFJlc291cmNlKGtleTogc3RyaW5nKSA6IGFueSB8IHVuZGVmaW5lZCB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc291cmNlcy5nZXQoa2V5LnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cblxuICAgIGdldFJlc291cmNlc05hbWVzKCkge1xuICAgICAgICBpZiAodGhpcy5yZXNvdXJjZXMpIHJldHVybiB0aGlzLnJlc291cmNlcy5rZXlzKCk7XG4gICAgICAgIGVsc2UgcmV0dXJuIFtdOyBcbiAgICB9XG5cbiAgICBnZXRQcm9wZXJ0aWVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0aWVzO1xuICAgIH1cbn1cbiJdfQ==