"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const events = require("@aws-cdk/aws-events");
const artifact_1 = require("./artifact");
const validation = require("./validation");
var ActionCategory;
(function (ActionCategory) {
    ActionCategory["Source"] = "Source";
    ActionCategory["Build"] = "Build";
    ActionCategory["Test"] = "Test";
    ActionCategory["Approval"] = "Approval";
    ActionCategory["Deploy"] = "Deploy";
    ActionCategory["Invoke"] = "Invoke";
})(ActionCategory = exports.ActionCategory || (exports.ActionCategory = {}));
function defaultBounds() {
    return {
        minInputs: 0,
        maxInputs: 5,
        minOutputs: 0,
        maxOutputs: 5
    };
}
exports.defaultBounds = defaultBounds;
/**
 * Low-level class for generic CodePipeline Actions.
 * It is recommended that concrete types are used instead, such as {@link codecommit.PipelineSourceAction} or
 * {@link codebuild.PipelineBuildAction}.
 */
class Action {
    constructor(props) {
        this._actionInputArtifacts = new Array();
        this._actionOutputArtifacts = new Array();
        validation.validateName('Action', props.actionName);
        this.owner = props.owner || 'AWS';
        this.version = props.version || '1';
        this.category = props.category;
        this.provider = props.provider;
        this.region = props.region;
        this.configuration = props.configuration;
        this.artifactBounds = props.artifactBounds;
        this.runOrder = props.runOrder === undefined ? 1 : props.runOrder;
        this.actionName = props.actionName;
        this.role = props.role;
    }
    onStateChange(name, target, options) {
        const rule = new events.EventRule(this.scope, name, options);
        rule.addTarget(target);
        rule.addEventPattern({
            detailType: ['CodePipeline Stage Execution State Change'],
            source: ['aws.codepipeline'],
            resources: [this.stage.pipeline.pipelineArn],
            detail: {
                stage: [this.stage.stageName],
                action: [this.actionName],
            },
        });
        return rule;
    }
    get _inputArtifacts() {
        return this._actionInputArtifacts.slice();
    }
    get _outputArtifacts() {
        return this._actionOutputArtifacts.slice();
    }
    validate() {
        return validation.validateArtifactBounds('input', this._actionInputArtifacts, this.artifactBounds.minInputs, this.artifactBounds.maxInputs, this.category, this.provider)
            .concat(validation.validateArtifactBounds('output', this._actionOutputArtifacts, this.artifactBounds.minOutputs, this.artifactBounds.maxOutputs, this.category, this.provider));
    }
    addOutputArtifact(name) {
        const artifact = new artifact_1.Artifact(name);
        this._actionOutputArtifacts.push(artifact);
        return artifact;
    }
    addInputArtifact(artifact) {
        this._actionInputArtifacts.push(artifact);
        return this;
    }
    /**
     * Retrieves the Construct scope of this Action.
     * Only available after the Action has been added to a Stage,
     * and that Stage to a Pipeline.
     */
    get scope() {
        if (this._scope) {
            return this._scope;
        }
        else {
            throw new Error('Action must be added to a stage that is part of a pipeline first');
        }
    }
    // ignore unused private method (it's actually used in Stage)
    // @ts-ignore
    _attachActionToPipeline(stage, scope) {
        if (this._stage) {
            throw new Error(`Action '${this.actionName}' has been added to a pipeline twice`);
        }
        this._stage = stage;
        this._scope = scope;
        this.bind(stage, scope);
    }
    get stage() {
        if (this._stage) {
            return this._stage;
        }
        else {
            throw new Error('Action must be added to a stage that is part of a pipeline before using onStateChange');
        }
    }
}
exports.Action = Action;
// export class ElasticBeanstalkDeploy extends DeployAction {
//   constructor(scope: Stage, id: string, applicationName: string, environmentName: string) {
//     super(scope, id, 'ElasticBeanstalk', { minInputs: 1, maxInputs: 1, minOutputs: 0, maxOutputs: 0 }, {
//       ApplicationName: applicationName,
//       EnvironmentName: environmentName
//     });
//   }
// }
// export class OpsWorksDeploy extends DeployAction {
//   constructor(scope: Stage, id: string, app: string, stack: string, layer?: string) {
//     super(scope, id, 'OpsWorks', { minInputs: 1, maxInputs: 1, minOutputs: 0, maxOutputs: 0 }, {
//       Stack: stack,
//       App: app,
//       Layer: layer,
//     });
//   }
// }
// export class ECSDeploy extends DeployAction {
//   constructor(scope: Stage, id: string, clusterName: string, serviceName: string, fileName?: string) {
//     super(scope, id, 'ECS', { minInputs: 1, maxInputs: 1, minOutputs: 0, maxOutputs: 0 }, {
//       ClusterName: clusterName,
//       ServiceName: serviceName,
//       FileName: fileName,
//     });
//   }
// }
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOENBQStDO0FBRy9DLHlDQUFzQztBQUN0QywyQ0FBNEM7QUFFNUMsSUFBWSxjQU9YO0FBUEQsV0FBWSxjQUFjO0lBQ3hCLG1DQUFpQixDQUFBO0lBQ2pCLGlDQUFlLENBQUE7SUFDZiwrQkFBYSxDQUFBO0lBQ2IsdUNBQXFCLENBQUE7SUFDckIsbUNBQWlCLENBQUE7SUFDakIsbUNBQWlCLENBQUE7QUFDbkIsQ0FBQyxFQVBXLGNBQWMsR0FBZCxzQkFBYyxLQUFkLHNCQUFjLFFBT3pCO0FBZ0JELFNBQWdCLGFBQWE7SUFDM0IsT0FBTztRQUNMLFNBQVMsRUFBRSxDQUFDO1FBQ1osU0FBUyxFQUFFLENBQUM7UUFDWixVQUFVLEVBQUUsQ0FBQztRQUNiLFVBQVUsRUFBRSxDQUFDO0tBQ2QsQ0FBQztBQUNKLENBQUM7QUFQRCxzQ0FPQztBQTBHRDs7OztHQUlHO0FBQ0gsTUFBc0IsTUFBTTtJQTREMUIsWUFBWSxLQUFrQjtRQVBiLDBCQUFxQixHQUFHLElBQUksS0FBSyxFQUFZLENBQUM7UUFDOUMsMkJBQXNCLEdBQUcsSUFBSSxLQUFLLEVBQVksQ0FBQztRQU85RCxVQUFVLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFcEQsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQztRQUNsQyxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLElBQUksR0FBRyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQztRQUMvQixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7UUFDL0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQzNCLElB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QUFNLEVBQUU7WUFDZixNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsSUFBSSxDQUFDLFVBQVUsc0NBQXNDLENBQUMsQ0FBQztTQUNuRjtRQUVELElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBRXBCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFRCxJQUFZLEtBQUs7UUFDZixJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDZixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7U0FDcEI7YUFBTTtZQUNMLE1BQU0sSUFBSSxLQUFLLENBQUMsdUZBQXVGLENBQUMsQ0FBQztTQUMxRztJQUNILENBQUM7Q0FDRjtBQWpLRCx3QkFpS0M7QUFFRCw2REFBNkQ7QUFDN0QsOEZBQThGO0FBQzlGLDJHQUEyRztBQUMzRywwQ0FBMEM7QUFDMUMseUNBQXlDO0FBQ3pDLFVBQVU7QUFDVixNQUFNO0FBQ04sSUFBSTtBQUVKLHFEQUFxRDtBQUNyRCx3RkFBd0Y7QUFDeEYsbUdBQW1HO0FBQ25HLHNCQUFzQjtBQUN0QixrQkFBa0I7QUFDbEIsc0JBQXNCO0FBQ3RCLFVBQVU7QUFDVixNQUFNO0FBQ04sSUFBSTtBQUVKLGdEQUFnRDtBQUNoRCx5R0FBeUc7QUFDekcsOEZBQThGO0FBQzlGLGtDQUFrQztBQUNsQyxrQ0FBa0M7QUFDbEMsNEJBQTRCO0FBQzVCLFVBQVU7QUFDVixNQUFNO0FBQ04sSUFBSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBldmVudHMgPSByZXF1aXJlKCdAYXdzLWNkay9hd3MtZXZlbnRzJyk7XG5pbXBvcnQgaWFtID0gcmVxdWlyZSgnQGF3cy1jZGsvYXdzLWlhbScpO1xuaW1wb3J0IGNkayA9IHJlcXVpcmUoJ0Bhd3MtY2RrL2NkaycpO1xuaW1wb3J0IHsgQXJ0aWZhY3QgfSBmcm9tICcuL2FydGlmYWN0JztcbmltcG9ydCB2YWxpZGF0aW9uID0gcmVxdWlyZSgnLi92YWxpZGF0aW9uJyk7XG5cbmV4cG9ydCBlbnVtIEFjdGlvbkNhdGVnb3J5IHtcbiAgU291cmNlID0gJ1NvdXJjZScsXG4gIEJ1aWxkID0gJ0J1aWxkJyxcbiAgVGVzdCA9ICdUZXN0JyxcbiAgQXBwcm92YWwgPSAnQXBwcm92YWwnLFxuICBEZXBsb3kgPSAnRGVwbG95JyxcbiAgSW52b2tlID0gJ0ludm9rZSdcbn1cblxuLyoqXG4gKiBTcGVjaWZpZXMgdGhlIGNvbnN0cmFpbnRzIG9uIHRoZSBudW1iZXIgb2YgaW5wdXQgYW5kIG91dHB1dFxuICogYXJ0aWZhY3RzIGFuIGFjdGlvbiBjYW4gaGF2ZS5cbiAqXG4gKiBUaGUgY29uc3RyYWludHMgZm9yIGVhY2ggYWN0aW9uIHR5cGUgYXJlIGRvY3VtZW50ZWQgb24gdGhlXG4gKiB7QGxpbmsgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2NvZGVwaXBlbGluZS9sYXRlc3QvdXNlcmd1aWRlL3JlZmVyZW5jZS1waXBlbGluZS1zdHJ1Y3R1cmUuaHRtbCBQaXBlbGluZSBTdHJ1Y3R1cmUgUmVmZXJlbmNlfSBwYWdlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFjdGlvbkFydGlmYWN0Qm91bmRzIHtcbiAgcmVhZG9ubHkgbWluSW5wdXRzOiBudW1iZXI7XG4gIHJlYWRvbmx5IG1heElucHV0czogbnVtYmVyO1xuICByZWFkb25seSBtaW5PdXRwdXRzOiBudW1iZXI7XG4gIHJlYWRvbmx5IG1heE91dHB1dHM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlZmF1bHRCb3VuZHMoKTogQWN0aW9uQXJ0aWZhY3RCb3VuZHMge1xuICByZXR1cm4ge1xuICAgIG1pbklucHV0czogMCxcbiAgICBtYXhJbnB1dHM6IDUsXG4gICAgbWluT3V0cHV0czogMCxcbiAgICBtYXhPdXRwdXRzOiA1XG4gIH07XG59XG5cbi8qKlxuICogVGhlIGFic3RyYWN0IHZpZXcgb2YgYW4gQVdTIENvZGVQaXBlbGluZSBhcyByZXF1aXJlZCBhbmQgdXNlZCBieSBBY3Rpb25zLlxuICogSXQgZXh0ZW5kcyB7QGxpbmsgZXZlbnRzLklFdmVudFJ1bGVUYXJnZXR9LFxuICogc28gdGhpcyBpbnRlcmZhY2UgY2FuIGJlIHVzZWQgYXMgYSBUYXJnZXQgZm9yIENsb3VkV2F0Y2ggRXZlbnRzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElQaXBlbGluZSBleHRlbmRzIGNkay5JQ29uc3RydWN0LCBldmVudHMuSUV2ZW50UnVsZVRhcmdldCB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgUGlwZWxpbmUuXG4gICAqL1xuICByZWFkb25seSBwaXBlbGluZU5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgUGlwZWxpbmUuXG4gICAqL1xuICByZWFkb25seSBwaXBlbGluZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgc2VydmljZSBSb2xlIG9mIHRoZSBQaXBlbGluZS5cbiAgICovXG4gIHJlYWRvbmx5IHJvbGU6IGlhbS5Sb2xlO1xuXG4gIC8qKlxuICAgKiBHcmFudHMgcmVhZCBwZXJtaXNzaW9ucyB0byB0aGUgUGlwZWxpbmUncyBTMyBCdWNrZXQgdG8gdGhlIGdpdmVuIElkZW50aXR5LlxuICAgKlxuICAgKiBAcGFyYW0gaWRlbnRpdHkgdGhlIElBTSBJZGVudGl0eSB0byBncmFudCB0aGUgcGVybWlzc2lvbnMgdG9cbiAgICovXG4gIGdyYW50QnVja2V0UmVhZChpZGVudGl0eT86IGlhbS5JUHJpbmNpcGFsKTogdm9pZDtcblxuICAvKipcbiAgICogR3JhbnRzIHJlYWQgJiB3cml0ZSBwZXJtaXNzaW9ucyB0byB0aGUgUGlwZWxpbmUncyBTMyBCdWNrZXQgdG8gdGhlIGdpdmVuIElkZW50aXR5LlxuICAgKlxuICAgKiBAcGFyYW0gaWRlbnRpdHkgdGhlIElBTSBJZGVudGl0eSB0byBncmFudCB0aGUgcGVybWlzc2lvbnMgdG9cbiAgICovXG4gIGdyYW50QnVja2V0UmVhZFdyaXRlKGlkZW50aXR5PzogaWFtLklQcmluY2lwYWwpOiB2b2lkO1xufVxuXG4vKipcbiAqIFRoZSBhYnN0cmFjdCBpbnRlcmZhY2Ugb2YgYSBQaXBlbGluZSBTdGFnZSB0aGF0IGlzIHVzZWQgYnkgQWN0aW9ucy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJU3RhZ2Uge1xuICAvKipcbiAgICogVGhlIHBoeXNpY2FsLCBodW1hbi1yZWFkYWJsZSBuYW1lIG9mIHRoaXMgUGlwZWxpbmUgU3RhZ2UuXG4gICAqL1xuICByZWFkb25seSBzdGFnZU5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIFBpcGVsaW5lIHRoaXMgU3RhZ2UgYmVsb25ncyB0by5cbiAgICovXG4gIHJlYWRvbmx5IHBpcGVsaW5lOiBJUGlwZWxpbmU7XG5cbiAgYWRkQWN0aW9uKGFjdGlvbjogQWN0aW9uKTogdm9pZDtcblxuICBvblN0YXRlQ2hhbmdlKG5hbWU6IHN0cmluZywgdGFyZ2V0PzogZXZlbnRzLklFdmVudFJ1bGVUYXJnZXQsIG9wdGlvbnM/OiBldmVudHMuRXZlbnRSdWxlUHJvcHMpOiBldmVudHMuRXZlbnRSdWxlO1xufVxuXG4vKipcbiAqIENvbW1vbiBwcm9wZXJ0aWVzIHNoYXJlZCBieSBhbGwgQWN0aW9ucy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDb21tb25BY3Rpb25Qcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgcGh5c2ljYWwsIGh1bWFuLXJlYWRhYmxlIG5hbWUgb2YgdGhlIEFjdGlvbi5cbiAgICogTm90IHRoYXQgQWN0aW9uIG5hbWVzIG11c3QgYmUgdW5pcXVlIHdpdGhpbiBhIHNpbmdsZSBTdGFnZS5cbiAgICovXG4gIGFjdGlvbk5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHJ1bk9yZGVyIHByb3BlcnR5IGZvciB0aGlzIEFjdGlvbi5cbiAgICogUnVuT3JkZXIgZGV0ZXJtaW5lcyB0aGUgcmVsYXRpdmUgb3JkZXIgaW4gd2hpY2ggbXVsdGlwbGUgQWN0aW9ucyBpbiB0aGUgc2FtZSBTdGFnZSBleGVjdXRlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAxXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2NvZGVwaXBlbGluZS9sYXRlc3QvdXNlcmd1aWRlL3JlZmVyZW5jZS1waXBlbGluZS1zdHJ1Y3R1cmUuaHRtbFxuICAgKi9cbiAgcnVuT3JkZXI/OiBudW1iZXI7XG59XG5cbi8qKlxuICogQ29uc3RydWN0aW9uIHByb3BlcnRpZXMgb2YgdGhlIGxvdy1sZXZlbCB7QGxpbmsgQWN0aW9uIEFjdGlvbiBjbGFzc30uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWN0aW9uUHJvcHMgZXh0ZW5kcyBDb21tb25BY3Rpb25Qcm9wcyB7XG4gIGNhdGVnb3J5OiBBY3Rpb25DYXRlZ29yeTtcbiAgcHJvdmlkZXI6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHJlZ2lvbiB0aGlzIEFjdGlvbiByZXNpZGVzIGluLlxuICAgKlxuICAgKiBAZGVmYXVsdCB0aGUgQWN0aW9uIHJlc2lkZXMgaW4gdGhlIHNhbWUgcmVnaW9uIGFzIHRoZSBQaXBlbGluZVxuICAgKi9cbiAgcmVnaW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgc2VydmljZSByb2xlIHRoYXQgaXMgYXNzdW1lZCBkdXJpbmcgZXhlY3V0aW9uIG9mIGFjdGlvbi5cbiAgICogVGhpcyByb2xlIGlzIG5vdCBtYW5kYXRvcnksIGhvd2V2ZXIgbW9yZSBhZHZhbmNlZCBjb25maWd1cmF0aW9uXG4gICAqIG1heSByZXF1aXJlIHNwZWNpZnlpbmcgaXQuXG4gICAqXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL0FXU0Nsb3VkRm9ybWF0aW9uL2xhdGVzdC9Vc2VyR3VpZGUvYXdzLXByb3BlcnRpZXMtY29kZXBpcGVsaW5lLXBpcGVsaW5lLXN0YWdlcy1hY3Rpb25zLmh0bWxcbiAgICovXG4gIHJvbGU/OiBpYW0uSVJvbGU7XG5cbiAgYXJ0aWZhY3RCb3VuZHM6IEFjdGlvbkFydGlmYWN0Qm91bmRzO1xuICBjb25maWd1cmF0aW9uPzogYW55O1xuICB2ZXJzaW9uPzogc3RyaW5nO1xuICBvd25lcj86IHN0cmluZztcbn1cblxuLyoqXG4gKiBMb3ctbGV2ZWwgY2xhc3MgZm9yIGdlbmVyaWMgQ29kZVBpcGVsaW5lIEFjdGlvbnMuXG4gKiBJdCBpcyByZWNvbW1lbmRlZCB0aGF0IGNvbmNyZXRlIHR5cGVzIGFyZSB1c2VkIGluc3RlYWQsIHN1Y2ggYXMge0BsaW5rIGNvZGVjb21taXQuUGlwZWxpbmVTb3VyY2VBY3Rpb259IG9yXG4gKiB7QGxpbmsgY29kZWJ1aWxkLlBpcGVsaW5lQnVpbGRBY3Rpb259LlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQWN0aW9uIHtcbiAgLyoqXG4gICAqIFRoZSBjYXRlZ29yeSBvZiB0aGUgYWN0aW9uLlxuICAgKiBUaGUgY2F0ZWdvcnkgZGVmaW5lcyB3aGljaCBhY3Rpb24gdHlwZSB0aGUgb3duZXJcbiAgICogKHRoZSBlbnRpdHkgdGhhdCBwZXJmb3JtcyB0aGUgYWN0aW9uKSBwZXJmb3Jtcy5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjYXRlZ29yeTogQWN0aW9uQ2F0ZWdvcnk7XG5cbiAgLyoqXG4gICAqIFRoZSBzZXJ2aWNlIHByb3ZpZGVyIHRoYXQgdGhlIGFjdGlvbiBjYWxscy5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBwcm92aWRlcjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgQVdTIHJlZ2lvbiB0aGUgZ2l2ZW4gQWN0aW9uIHJlc2lkZXMgaW4uXG4gICAqIE5vdGUgdGhhdCBhIGNyb3NzLXJlZ2lvbiBQaXBlbGluZSByZXF1aXJlcyByZXBsaWNhdGlvbiBidWNrZXRzIHRvIGZ1bmN0aW9uIGNvcnJlY3RseS5cbiAgICogWW91IGNhbiBwcm92aWRlIHRoZWlyIG5hbWVzIHdpdGggdGhlIHtAbGluayBQaXBlbGluZVByb3BzI2Nyb3NzUmVnaW9uUmVwbGljYXRpb25CdWNrZXRzfSBwcm9wZXJ0eS5cbiAgICogSWYgeW91IGRvbid0LCB0aGUgQ29kZVBpcGVsaW5lIENvbnN0cnVjdCB3aWxsIGNyZWF0ZSBuZXcgU3RhY2tzIGluIHlvdXIgQ0RLIGFwcCBjb250YWluaW5nIHRob3NlIGJ1Y2tldHMsXG4gICAqIHRoYXQgeW91IHdpbGwgbmVlZCB0byBgY2RrIGRlcGxveWAgYmVmb3JlIGRlcGxveWluZyB0aGUgbWFpbiwgUGlwZWxpbmUtY29udGFpbmluZyBTdGFjay5cbiAgICpcbiAgICogQGRlZmF1bHQgdGhlIEFjdGlvbiByZXNpZGVzIGluIHRoZSBzYW1lIHJlZ2lvbiBhcyB0aGUgUGlwZWxpbmVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSByZWdpb24/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBhY3Rpb24ncyBjb25maWd1cmF0aW9uLiBUaGVzZSBhcmUga2V5LXZhbHVlIHBhaXJzIHRoYXQgc3BlY2lmeSBpbnB1dCB2YWx1ZXMgZm9yIGFuIGFjdGlvbi5cbiAgICogRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZSB0aGUgQVdTIENvZGVQaXBlbGluZSBVc2VyIEd1aWRlLlxuICAgKlxuICAgKiBodHRwOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2RlcGlwZWxpbmUvbGF0ZXN0L3VzZXJndWlkZS9yZWZlcmVuY2UtcGlwZWxpbmUtc3RydWN0dXJlLmh0bWwjYWN0aW9uLXJlcXVpcmVtZW50c1xuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGNvbmZpZ3VyYXRpb24/OiBhbnk7XG5cbiAgLyoqXG4gICAqIFRoZSBzZXJ2aWNlIHJvbGUgdGhhdCBpcyBhc3N1bWVkIGR1cmluZyBleGVjdXRpb24gb2YgYWN0aW9uLlxuICAgKiBUaGlzIHJvbGUgaXMgbm90IG1hbmRhdG9yeSwgaG93ZXZlciBtb3JlIGFkdmFuY2VkIGNvbmZpZ3VyYXRpb25cbiAgICogbWF5IHJlcXVpcmUgc3BlY2lmeWluZyBpdC5cbiAgICpcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vQVdTQ2xvdWRGb3JtYXRpb24vbGF0ZXN0L1VzZXJHdWlkZS9hd3MtcHJvcGVydGllcy1jb2RlcGlwZWxpbmUtcGlwZWxpbmUtc3RhZ2VzLWFjdGlvbnMuaHRtbFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHJvbGU/OiBpYW0uSVJvbGU7XG5cbiAgLyoqXG4gICAqIFRoZSBvcmRlciBpbiB3aGljaCBBV1MgQ29kZVBpcGVsaW5lIHJ1bnMgdGhpcyBhY3Rpb24uXG4gICAqIEZvciBtb3JlIGluZm9ybWF0aW9uLCBzZWUgdGhlIEFXUyBDb2RlUGlwZWxpbmUgVXNlciBHdWlkZS5cbiAgICpcbiAgICogaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2NvZGVwaXBlbGluZS9sYXRlc3QvdXNlcmd1aWRlL3JlZmVyZW5jZS1waXBlbGluZS1zdHJ1Y3R1cmUuaHRtbCNhY3Rpb24tcmVxdWlyZW1lbnRzXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcnVuT3JkZXI6IG51bWJlcjtcblxuICBwdWJsaWMgcmVhZG9ubHkgb3duZXI6IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IHZlcnNpb246IHN0cmluZztcbiAgcHVibGljIHJlYWRvbmx5IGFjdGlvbk5hbWU6IHN0cmluZztcblxuICBwcml2YXRlIHJlYWRvbmx5IF9hY3Rpb25JbnB1dEFydGlmYWN0cyA9IG5ldyBBcnJheTxBcnRpZmFjdD4oKTtcbiAgcHJpdmF0ZSByZWFkb25seSBfYWN0aW9uT3V0cHV0QXJ0aWZhY3RzID0gbmV3IEFycmF5PEFydGlmYWN0PigpO1xuICBwcml2YXRlIHJlYWRvbmx5IGFydGlmYWN0Qm91bmRzOiBBY3Rpb25BcnRpZmFjdEJvdW5kcztcblxuICBwcml2YXRlIF9zdGFnZT86IElTdGFnZTtcbiAgcHJpdmF0ZSBfc2NvcGU/OiBjZGsuQ29uc3RydWN0O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzOiBBY3Rpb25Qcm9wcykge1xuICAgIHZhbGlkYXRpb24udmFsaWRhdGVOYW1lKCdBY3Rpb24nLCBwcm9wcy5hY3Rpb25OYW1lKTtcblxuICAgIHRoaXMub3duZXIgPSBwcm9wcy5vd25lciB8fCAnQVdTJztcbiAgICB0aGlzLnZlcnNpb24gPSBwcm9wcy52ZXJzaW9uIHx8ICcxJztcbiAgICB0aGlzLmNhdGVnb3J5ID0gcHJvcHMuY2F0ZWdvcnk7XG4gICAgdGhpcy5wcm92aWRlciA9IHByb3BzLnByb3ZpZGVyO1xuICAgIHRoaXMucmVnaW9uID0gcHJvcHMucmVnaW9uO1xuICAgIHRoaXMuY29uZmlndXJhdGlvbiA9IHByb3BzLmNvbmZpZ3VyYXRpb247XG4gICAgdGhpcy5hcnRpZmFjdEJvdW5kcyA9IHByb3BzLmFydGlmYWN0Qm91bmRzO1xuICAgIHRoaXMucnVuT3JkZXIgPSBwcm9wcy5ydW5PcmRlciA9PT0gdW5kZWZpbmVkID8gMSA6IHByb3BzLnJ1bk9yZGVyO1xuICAgIHRoaXMuYWN0aW9uTmFtZSA9IHByb3BzLmFjdGlvbk5hbWU7XG4gICAgdGhpcy5yb2xlID0gcHJvcHMucm9sZTtcbiAgfVxuXG4gIHB1YmxpYyBvblN0YXRlQ2hhbmdlKG5hbWU6IHN0cmluZywgdGFyZ2V0PzogZXZlbnRzLklFdmVudFJ1bGVUYXJnZXQsIG9wdGlvbnM/OiBldmVudHMuRXZlbnRSdWxlUHJvcHMpIHtcbiAgICBjb25zdCBydWxlID0gbmV3IGV2ZW50cy5FdmVudFJ1bGUodGhpcy5zY29wZSwgbmFtZSwgb3B0aW9ucyk7XG4gICAgcnVsZS5hZGRUYXJnZXQodGFyZ2V0KTtcbiAgICBydWxlLmFkZEV2ZW50UGF0dGVybih7XG4gICAgICBkZXRhaWxUeXBlOiBbICdDb2RlUGlwZWxpbmUgU3RhZ2UgRXhlY3V0aW9uIFN0YXRlIENoYW5nZScgXSxcbiAgICAgIHNvdXJjZTogWyAnYXdzLmNvZGVwaXBlbGluZScgXSxcbiAgICAgIHJlc291cmNlczogWyB0aGlzLnN0YWdlLnBpcGVsaW5lLnBpcGVsaW5lQXJuIF0sXG4gICAgICBkZXRhaWw6IHtcbiAgICAgICAgc3RhZ2U6IFsgdGhpcy5zdGFnZS5zdGFnZU5hbWUgXSxcbiAgICAgICAgYWN0aW9uOiBbIHRoaXMuYWN0aW9uTmFtZSBdLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICByZXR1cm4gcnVsZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgX2lucHV0QXJ0aWZhY3RzKCk6IEFydGlmYWN0W10ge1xuICAgIHJldHVybiB0aGlzLl9hY3Rpb25JbnB1dEFydGlmYWN0cy5zbGljZSgpO1xuICB9XG5cbiAgcHVibGljIGdldCBfb3V0cHV0QXJ0aWZhY3RzKCk6IEFydGlmYWN0W10ge1xuICAgIHJldHVybiB0aGlzLl9hY3Rpb25PdXRwdXRBcnRpZmFjdHMuc2xpY2UoKTtcbiAgfVxuXG4gIHByb3RlY3RlZCB2YWxpZGF0ZSgpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHZhbGlkYXRpb24udmFsaWRhdGVBcnRpZmFjdEJvdW5kcygnaW5wdXQnLCB0aGlzLl9hY3Rpb25JbnB1dEFydGlmYWN0cywgdGhpcy5hcnRpZmFjdEJvdW5kcy5taW5JbnB1dHMsXG4gICAgICAgIHRoaXMuYXJ0aWZhY3RCb3VuZHMubWF4SW5wdXRzLCB0aGlzLmNhdGVnb3J5LCB0aGlzLnByb3ZpZGVyKVxuICAgICAgLmNvbmNhdCh2YWxpZGF0aW9uLnZhbGlkYXRlQXJ0aWZhY3RCb3VuZHMoJ291dHB1dCcsIHRoaXMuX2FjdGlvbk91dHB1dEFydGlmYWN0cywgdGhpcy5hcnRpZmFjdEJvdW5kcy5taW5PdXRwdXRzLFxuICAgICAgICB0aGlzLmFydGlmYWN0Qm91bmRzLm1heE91dHB1dHMsIHRoaXMuY2F0ZWdvcnksIHRoaXMucHJvdmlkZXIpXG4gICAgKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBhZGRPdXRwdXRBcnRpZmFjdChuYW1lOiBzdHJpbmcpOiBBcnRpZmFjdCB7XG4gICAgY29uc3QgYXJ0aWZhY3QgPSBuZXcgQXJ0aWZhY3QobmFtZSk7XG4gICAgdGhpcy5fYWN0aW9uT3V0cHV0QXJ0aWZhY3RzLnB1c2goYXJ0aWZhY3QpO1xuICAgIHJldHVybiBhcnRpZmFjdDtcbiAgfVxuXG4gIHByb3RlY3RlZCBhZGRJbnB1dEFydGlmYWN0KGFydGlmYWN0OiBBcnRpZmFjdCk6IEFjdGlvbiB7XG4gICAgdGhpcy5fYWN0aW9uSW5wdXRBcnRpZmFjdHMucHVzaChhcnRpZmFjdCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSBDb25zdHJ1Y3Qgc2NvcGUgb2YgdGhpcyBBY3Rpb24uXG4gICAqIE9ubHkgYXZhaWxhYmxlIGFmdGVyIHRoZSBBY3Rpb24gaGFzIGJlZW4gYWRkZWQgdG8gYSBTdGFnZSxcbiAgICogYW5kIHRoYXQgU3RhZ2UgdG8gYSBQaXBlbGluZS5cbiAgICovXG4gIHByb3RlY3RlZCBnZXQgc2NvcGUoKTogY2RrLkNvbnN0cnVjdCB7XG4gICAgaWYgKHRoaXMuX3Njb3BlKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc2NvcGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQWN0aW9uIG11c3QgYmUgYWRkZWQgdG8gYSBzdGFnZSB0aGF0IGlzIHBhcnQgb2YgYSBwaXBlbGluZSBmaXJzdCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgbWV0aG9kIGNhbGxlZCB3aGVuIGFuIEFjdGlvbiBpcyBhdHRhY2hlZCB0byBhIFBpcGVsaW5lLlxuICAgKiBUaGlzIG1ldGhvZCBpcyBndWFyYW50ZWVkIHRvIGJlIGNhbGxlZCBvbmx5IG9uY2UgZm9yIGVhY2ggQWN0aW9uIGluc3RhbmNlLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhZ2UgdGhlIHN0YWdlIHRoaXMgYWN0aW9uIGhhcyBiZWVuIGFkZGVkIHRvXG4gICAqICAgKGluY2x1ZGVzIGEgcmVmZXJlbmNlIHRvIHRoZSBwaXBlbGluZSBhcyB3ZWxsKVxuICAgKiBAcGFyYW0gc2NvcGUgdGhlIHNjb3BlIGNvbnN0cnVjdCBmb3IgdGhpcyBhY3Rpb24sXG4gICAqICAgY2FuIGJlIHVzZWQgYnkgdGhlIGFjdGlvbiBpbXBsZW1lbnRhdGlvbiB0byBjcmVhdGUgYW55IHJlc291cmNlcyBpdCBuZWVkcyB0byB3b3JrIGNvcnJlY3RseVxuICAgKi9cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGJpbmQoc3RhZ2U6IElTdGFnZSwgc2NvcGU6IGNkay5Db25zdHJ1Y3QpOiB2b2lkO1xuXG4gIC8vIGlnbm9yZSB1bnVzZWQgcHJpdmF0ZSBtZXRob2QgKGl0J3MgYWN0dWFsbHkgdXNlZCBpbiBTdGFnZSlcbiAgLy8gQHRzLWlnbm9yZVxuICBwcml2YXRlIF9hdHRhY2hBY3Rpb25Ub1BpcGVsaW5lKHN0YWdlOiBJU3RhZ2UsIHNjb3BlOiBjZGsuQ29uc3RydWN0KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX3N0YWdlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFjdGlvbiAnJHt0aGlzLmFjdGlvbk5hbWV9JyBoYXMgYmVlbiBhZGRlZCB0byBhIHBpcGVsaW5lIHR3aWNlYCk7XG4gICAgfVxuXG4gICAgdGhpcy5fc3RhZ2UgPSBzdGFnZTtcbiAgICB0aGlzLl9zY29wZSA9IHNjb3BlO1xuXG4gICAgdGhpcy5iaW5kKHN0YWdlLCBzY29wZSk7XG4gIH1cblxuICBwcml2YXRlIGdldCBzdGFnZSgpOiBJU3RhZ2Uge1xuICAgIGlmICh0aGlzLl9zdGFnZSkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N0YWdlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FjdGlvbiBtdXN0IGJlIGFkZGVkIHRvIGEgc3RhZ2UgdGhhdCBpcyBwYXJ0IG9mIGEgcGlwZWxpbmUgYmVmb3JlIHVzaW5nIG9uU3RhdGVDaGFuZ2UnKTtcbiAgICB9XG4gIH1cbn1cblxuLy8gZXhwb3J0IGNsYXNzIEVsYXN0aWNCZWFuc3RhbGtEZXBsb3kgZXh0ZW5kcyBEZXBsb3lBY3Rpb24ge1xuLy8gICBjb25zdHJ1Y3RvcihzY29wZTogU3RhZ2UsIGlkOiBzdHJpbmcsIGFwcGxpY2F0aW9uTmFtZTogc3RyaW5nLCBlbnZpcm9ubWVudE5hbWU6IHN0cmluZykge1xuLy8gICAgIHN1cGVyKHNjb3BlLCBpZCwgJ0VsYXN0aWNCZWFuc3RhbGsnLCB7IG1pbklucHV0czogMSwgbWF4SW5wdXRzOiAxLCBtaW5PdXRwdXRzOiAwLCBtYXhPdXRwdXRzOiAwIH0sIHtcbi8vICAgICAgIEFwcGxpY2F0aW9uTmFtZTogYXBwbGljYXRpb25OYW1lLFxuLy8gICAgICAgRW52aXJvbm1lbnROYW1lOiBlbnZpcm9ubWVudE5hbWVcbi8vICAgICB9KTtcbi8vICAgfVxuLy8gfVxuXG4vLyBleHBvcnQgY2xhc3MgT3BzV29ya3NEZXBsb3kgZXh0ZW5kcyBEZXBsb3lBY3Rpb24ge1xuLy8gICBjb25zdHJ1Y3RvcihzY29wZTogU3RhZ2UsIGlkOiBzdHJpbmcsIGFwcDogc3RyaW5nLCBzdGFjazogc3RyaW5nLCBsYXllcj86IHN0cmluZykge1xuLy8gICAgIHN1cGVyKHNjb3BlLCBpZCwgJ09wc1dvcmtzJywgeyBtaW5JbnB1dHM6IDEsIG1heElucHV0czogMSwgbWluT3V0cHV0czogMCwgbWF4T3V0cHV0czogMCB9LCB7XG4vLyAgICAgICBTdGFjazogc3RhY2ssXG4vLyAgICAgICBBcHA6IGFwcCxcbi8vICAgICAgIExheWVyOiBsYXllcixcbi8vICAgICB9KTtcbi8vICAgfVxuLy8gfVxuXG4vLyBleHBvcnQgY2xhc3MgRUNTRGVwbG95IGV4dGVuZHMgRGVwbG95QWN0aW9uIHtcbi8vICAgY29uc3RydWN0b3Ioc2NvcGU6IFN0YWdlLCBpZDogc3RyaW5nLCBjbHVzdGVyTmFtZTogc3RyaW5nLCBzZXJ2aWNlTmFtZTogc3RyaW5nLCBmaWxlTmFtZT86IHN0cmluZykge1xuLy8gICAgIHN1cGVyKHNjb3BlLCBpZCwgJ0VDUycsIHsgbWluSW5wdXRzOiAxLCBtYXhJbnB1dHM6IDEsIG1pbk91dHB1dHM6IDAsIG1heE91dHB1dHM6IDAgfSwge1xuLy8gICAgICAgQ2x1c3Rlck5hbWU6IGNsdXN0ZXJOYW1lLFxuLy8gICAgICAgU2VydmljZU5hbWU6IHNlcnZpY2VOYW1lLFxuLy8gICAgICAgRmlsZU5hbWU6IGZpbGVOYW1lLFxuLy8gICAgIH0pO1xuLy8gICB9XG4vLyB9XG4iXX0=