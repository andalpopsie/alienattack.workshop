"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cdk_1 = require("@aws-cdk/cdk");
/**
 * Select the latest version of the indicated Windows version
 *
 * The AMI ID is selected using the values published to the SSM parameter store.
 *
 * https://aws.amazon.com/blogs/mt/query-for-the-latest-windows-ami-using-systems-manager-parameter-store/
 */
class WindowsImage {
    constructor(version) {
        this.version = version;
    }
    /**
     * Return the image to use in the given context
     */
    getImage(scope) {
        const ssmProvider = new cdk_1.SSMParameterProvider(scope, {
            parameterName: this.imageParameterName(this.version),
        });
        const ami = ssmProvider.parameterValue();
        return new MachineImage(ami, new WindowsOS());
    }
    /**
     * Construct the SSM parameter name for the given Windows image
     */
    imageParameterName(version) {
        return '/aws/service/ami-windows-latest/' + version;
    }
}
exports.WindowsImage = WindowsImage;
/**
 * Selects the latest version of Amazon Linux
 *
 * The AMI ID is selected using the values published to the SSM parameter store.
 */
class AmazonLinuxImage {
    constructor(props) {
        this.generation = (props && props.generation) || AmazonLinuxGeneration.AmazonLinux;
        this.edition = (props && props.edition) || AmazonLinuxEdition.Standard;
        this.virtualization = (props && props.virtualization) || AmazonLinuxVirt.HVM;
        this.storage = (props && props.storage) || AmazonLinuxStorage.GeneralPurpose;
    }
    /**
     * Return the image to use in the given context
     */
    getImage(scope) {
        const parts = [
            this.generation,
            'ami',
            this.edition !== AmazonLinuxEdition.Standard ? this.edition : undefined,
            this.virtualization,
            'x86_64',
            this.storage
        ].filter(x => x !== undefined); // Get rid of undefineds
        const parameterName = '/aws/service/ami-amazon-linux-latest/' + parts.join('-');
        const ssmProvider = new cdk_1.SSMParameterProvider(scope, {
            parameterName,
        });
        const ami = ssmProvider.parameterValue();
        return new MachineImage(ami, new LinuxOS());
    }
}
exports.AmazonLinuxImage = AmazonLinuxImage;
/**
 * What generation of Amazon Linux to use
 */
var AmazonLinuxGeneration;
(function (AmazonLinuxGeneration) {
    /**
     * Amazon Linux
     */
    AmazonLinuxGeneration["AmazonLinux"] = "amzn";
    /**
     * Amazon Linux 2
     */
    AmazonLinuxGeneration["AmazonLinux2"] = "amzn2";
})(AmazonLinuxGeneration = exports.AmazonLinuxGeneration || (exports.AmazonLinuxGeneration = {}));
/**
 * Amazon Linux edition
 */
var AmazonLinuxEdition;
(function (AmazonLinuxEdition) {
    /**
     * Standard edition
     */
    AmazonLinuxEdition["Standard"] = "standard";
    /**
     * Minimal edition
     */
    AmazonLinuxEdition["Minimal"] = "minimal";
})(AmazonLinuxEdition = exports.AmazonLinuxEdition || (exports.AmazonLinuxEdition = {}));
/**
 * Virtualization type for Amazon Linux
 */
var AmazonLinuxVirt;
(function (AmazonLinuxVirt) {
    /**
     * HVM virtualization (recommended)
     */
    AmazonLinuxVirt["HVM"] = "hvm";
    /**
     * PV virtualization
     */
    AmazonLinuxVirt["PV"] = "pv";
})(AmazonLinuxVirt = exports.AmazonLinuxVirt || (exports.AmazonLinuxVirt = {}));
var AmazonLinuxStorage;
(function (AmazonLinuxStorage) {
    /**
     * EBS-backed storage
     */
    AmazonLinuxStorage["EBS"] = "ebs";
    /**
     * S3-backed storage
     */
    AmazonLinuxStorage["S3"] = "ebs";
    /**
     * General Purpose-based storage (recommended)
     */
    AmazonLinuxStorage["GeneralPurpose"] = "gp2";
})(AmazonLinuxStorage = exports.AmazonLinuxStorage || (exports.AmazonLinuxStorage = {}));
/**
 * Construct a Linux machine image from an AMI map
 *
 * Linux images IDs are not published to SSM parameter store yet, so you'll have to
 * manually specify an AMI map.
 */
class GenericLinuxImage {
    constructor(amiMap) {
        this.amiMap = amiMap;
    }
    getImage(scope) {
        const region = scope.node.stack.requireRegion('AMI cannot be determined');
        const ami = region !== 'test-region' ? this.amiMap[region] : 'ami-12345';
        if (!ami) {
            throw new Error(`Unable to find AMI in AMI map: no AMI specified for region '${region}'`);
        }
        return new MachineImage(ami, new LinuxOS());
    }
}
exports.GenericLinuxImage = GenericLinuxImage;
/**
 * The Windows version to use for the WindowsImage
 */
var WindowsVersion;
(function (WindowsVersion) {
    WindowsVersion["WindowsServer2016TurksihFullBase"] = "Windows_Server-2016-Turkish-Full-Base";
    WindowsVersion["WindowsServer2016SwedishFullBase"] = "Windows_Server-2016-Swedish-Full-Base";
    WindowsVersion["WindowsServer2016SpanishFullBase"] = "Windows_Server-2016-Spanish-Full-Base";
    WindowsVersion["WindowsServer2016RussianFullBase"] = "Windows_Server-2016-Russian-Full-Base";
    WindowsVersion["WindowsServer2016PortuguesePortugalFullBase"] = "Windows_Server-2016-Portuguese_Portugal-Full-Base";
    WindowsVersion["WindowsServer2016PortugueseBrazilFullBase"] = "Windows_Server-2016-Portuguese_Brazil-Full-Base";
    WindowsVersion["WindowsServer2016PolishFullBase"] = "Windows_Server-2016-Polish-Full-Base";
    WindowsVersion["WindowsServer2016KoreanFullSQL2016Base"] = "Windows_Server-2016-Korean-Full-SQL_2016_SP1_Standard";
    WindowsVersion["WindowsServer2016KoreanFullBase"] = "Windows_Server-2016-Korean-Full-Base";
    WindowsVersion["WindowsServer2016JapaneseFullSQL2016Web"] = "Windows_Server-2016-Japanese-Full-SQL_2016_SP1_Web";
    WindowsVersion["WindowsServer2016JapaneseFullSQL2016Standard"] = "Windows_Server-2016-Japanese-Full-SQL_2016_SP1_Standard";
    WindowsVersion["WindowsServer2016JapaneseFullSQL2016Express"] = "Windows_Server-2016-Japanese-Full-SQL_2016_SP1_Express";
    WindowsVersion["WindowsServer2016JapaneseFullSQL2016Enterprise"] = "Windows_Server-2016-Japanese-Full-SQL_2016_SP1_Enterprise";
    WindowsVersion["WindowsServer2016JapaneseFullBase"] = "Windows_Server-2016-Japanese-Full-Base";
    WindowsVersion["WindowsServer2016ItalianFullBase"] = "Windows_Server-2016-Italian-Full-Base";
    WindowsVersion["WindowsServer2016HungarianFullBase"] = "Windows_Server-2016-Hungarian-Full-Base";
    WindowsVersion["WindowsServer2016GermanFullBase"] = "Windows_Server-2016-German-Full-Base";
    WindowsVersion["WindowsServer2016FrenchFullBase"] = "Windows_Server-2016-French-Full-Base";
    WindowsVersion["WindowsServer2016EnglishNanoBase"] = "Windows_Server-2016-English-Nano-Base";
    WindowsVersion["WindowsServer2016EnglishFullSQL2017Web"] = "Windows_Server-2016-English-Full-SQL_2017_Web";
    WindowsVersion["WindowsServer2016EnglishFullSQL2017Standard"] = "Windows_Server-2016-English-Full-SQL_2017_Standard";
    WindowsVersion["WindowsServer2016EnglishFullSQL2017Express"] = "Windows_Server-2016-English-Full-SQL_2017_Express";
    WindowsVersion["WindowsServer2016EnglishFullSQL2017Enterprise"] = "Windows_Server-2016-English-Full-SQL_2017_Enterprise";
})(WindowsVersion = exports.WindowsVersion || (exports.WindowsVersion = {}));
/**
 * Representation of a machine to be launched
 *
 * Combines an AMI ID with an OS.
 */
class MachineImage {
    constructor(imageId, os) {
        this.imageId = imageId;
        this.os = os;
    }
}
exports.MachineImage = MachineImage;
/**
 * The OS type of a particular image
 */
var OperatingSystemType;
(function (OperatingSystemType) {
    OperatingSystemType[OperatingSystemType["Linux"] = 0] = "Linux";
    OperatingSystemType[OperatingSystemType["Windows"] = 1] = "Windows";
})(OperatingSystemType = exports.OperatingSystemType || (exports.OperatingSystemType = {}));
/**
 * Abstraction of OS features we need to be aware of
 */
class OperatingSystem {
}
exports.OperatingSystem = OperatingSystem;
/**
 * OS features specialized for Windows
 */
class WindowsOS extends OperatingSystem {
    createUserData(scripts) {
        return `<powershell>${scripts.join('\n')}</powershell>`;
    }
    get type() {
        return OperatingSystemType.Windows;
    }
}
exports.WindowsOS = WindowsOS;
/**
 * OS features specialized for Linux
 */
class LinuxOS extends OperatingSystem {
    createUserData(scripts) {
        return '#!/bin/bash\n' + scripts.join('\n');
    }
    get type() {
        return OperatingSystemType.Linux;
    }
}
exports.LinuxOS = LinuxOS;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFjaGluZS1pbWFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1hY2hpbmUtaW1hZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBK0Q7QUFZL0Q7Ozs7OztHQU1HO0FBQ0gsTUFBYSxZQUFZO0lBQ3ZCLFlBQTZCLE9BQXVCO1FBQXZCLFlBQU8sR0FBUCxPQUFPLENBQWdCO0lBQ3BELENBQUM7SUFFRDs7T0FFRztJQUNJLFFBQVEsQ0FBQyxLQUFnQjtRQUM5QixNQUFNLFdBQVcsR0FBRyxJQUFJLDBCQUFvQixDQUFDLEtBQUssRUFBRTtZQUNsRCxhQUFhLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7U0FDckQsQ0FBQyxDQUFDO1FBRUgsTUFBTSxHQUFHLEdBQUcsV0FBVyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3pDLE9BQU8sSUFBSSxZQUFZLENBQUMsR0FBRyxFQUFFLElBQUksU0FBUyxFQUFFLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxrQkFBa0IsQ0FBQyxPQUF1QjtRQUNoRCxPQUFPLGtDQUFrQyxHQUFHLE9BQU8sQ0FBQztJQUN0RCxDQUFDO0NBQ0Y7QUF0QkQsb0NBc0JDO0FBbUNEOzs7O0dBSUc7QUFDSCxNQUFhLGdCQUFnQjtJQU0zQixZQUFZLEtBQTZCO1FBQ3ZDLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLHFCQUFxQixDQUFDLFdBQVcsQ0FBQztRQUNuRixJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxrQkFBa0IsQ0FBQyxRQUFRLENBQUM7UUFDdkUsSUFBSSxDQUFDLGNBQWMsR0FBRyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLElBQUksZUFBZSxDQUFDLEdBQUcsQ0FBQztRQUM3RSxJQUFJLENB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LENBQUM7SUFFRCxJQUFJLElBQUk7UUFDTixPQUFPLG1CQUFtQixDQUFDLE9BQU8sQ0FBQztJQUNyQyxDQUFDO0NBQ0Y7QUFSRCw4QkFRQztBQUVEOztHQUVHO0FBQ0gsTUFBYSxPQUFRLFNBQVEsZUFBZTtJQUNuQyxjQUFjLENBQUMsT0FBaUI7UUFDckMsT0FBTyxlQUFlLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQsSUFBSSxJQUFJO1FBQ04sT0FBTyxtQkFBbUIsQ0FBQyxLQUFLLENBQUM7SUFDbkMsQ0FBQztDQUNGO0FBUkQsMEJBUUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb25zdHJ1Y3QsIFNTTVBhcmFtZXRlclByb3ZpZGVyIH0gZnJvbSAnQGF3cy1jZGsvY2RrJztcblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIGNsYXNzZXMgdGhhdCBjYW4gc2VsZWN0IGFuIGFwcHJvcHJpYXRlIG1hY2hpbmUgaW1hZ2UgdG8gdXNlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSU1hY2hpbmVJbWFnZVNvdXJjZSB7XG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGltYWdlIHRvIHVzZSBpbiB0aGUgZ2l2ZW4gY29udGV4dFxuICAgKi9cbiAgZ2V0SW1hZ2Uoc2NvcGU6IENvbnN0cnVjdCk6IE1hY2hpbmVJbWFnZTtcbn1cblxuLyoqXG4gKiBTZWxlY3QgdGhlIGxhdGVzdCB2ZXJzaW9uIG9mIHRoZSBpbmRpY2F0ZWQgV2luZG93cyB2ZXJzaW9uXG4gKlxuICogVGhlIEFNSSBJRCBpcyBzZWxlY3RlZCB1c2luZyB0aGUgdmFsdWVzIHB1Ymxpc2hlZCB0byB0aGUgU1NNIHBhcmFtZXRlciBzdG9yZS5cbiAqXG4gKiBodHRwczovL2F3cy5hbWF6b24uY29tL2Jsb2dzL210L3F1ZXJ5LWZvci10aGUtbGF0ZXN0LXdpbmRvd3MtYW1pLXVzaW5nLXN5c3RlbXMtbWFuYWdlci1wYXJhbWV0ZXItc3RvcmUvXG4gKi9cbmV4cG9ydCBjbGFzcyBXaW5kb3dzSW1hZ2UgaW1wbGVtZW50cyBJTWFjaGluZUltYWdlU291cmNlICB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgdmVyc2lvbjogV2luZG93c1ZlcnNpb24pIHtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGltYWdlIHRvIHVzZSBpbiB0aGUgZ2l2ZW4gY29udGV4dFxuICAgKi9cbiAgcHVibGljIGdldEltYWdlKHNjb3BlOiBDb25zdHJ1Y3QpOiBNYWNoaW5lSW1hZ2Uge1xuICAgIGNvbnN0IHNzbVByb3ZpZGVyID0gbmV3IFNTTVBhcmFtZXRlclByb3ZpZGVyKHNjb3BlLCB7XG4gICAgICBwYXJhbWV0ZXJOYW1lOiB0aGlzLmltYWdlUGFyYW1ldGVyTmFtZSh0aGlzLnZlcnNpb24pLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYW1pID0gc3NtUHJvdmlkZXIucGFyYW1ldGVyVmFsdWUoKTtcbiAgICByZXR1cm4gbmV3IE1hY2hpbmVJbWFnZShhbWksIG5ldyBXaW5kb3dzT1MoKSk7XG4gIH1cblxuICAvKipcbiAgICogQ29uc3RydWN0IHRoZSBTU00gcGFyYW1ldGVyIG5hbWUgZm9yIHRoZSBnaXZlbiBXaW5kb3dzIGltYWdlXG4gICAqL1xuICBwcml2YXRlIGltYWdlUGFyYW1ldGVyTmFtZSh2ZXJzaW9uOiBXaW5kb3dzVmVyc2lvbik6IHN0cmluZyB7XG4gICAgcmV0dXJuICcvYXdzL3NlcnZpY2UvYW1pLXdpbmRvd3MtbGF0ZXN0LycgKyB2ZXJzaW9uO1xuICB9XG59XG5cbi8qKlxuICogQW1hem9uIExpbnV4IGltYWdlIHByb3BlcnRpZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBbWF6b25MaW51eEltYWdlUHJvcHMge1xuICAvKipcbiAgICogV2hhdCBnZW5lcmF0aW9uIG9mIEFtYXpvbiBMaW51eCB0byB1c2VcbiAgICpcbiAgICogQGRlZmF1bHQgQW1hem9uTGludXhcbiAgICovXG4gIGdlbmVyYXRpb24/OiBBbWF6b25MaW51eEdlbmVyYXRpb247XG5cbiAgLyoqXG4gICAqIFdoYXQgZWRpdGlvbiBvZiBBbWF6b24gTGludXggdG8gdXNlXG4gICAqXG4gICAqIEBkZWZhdWx0IFN0YW5kYXJkXG4gICAqL1xuICBlZGl0aW9uPzogQW1hem9uTGludXhFZGl0aW9uO1xuXG4gIC8qKlxuICAgKiBWaXJ0dWFsaXphdGlvbiB0eXBlXG4gICAqXG4gICAqIEBkZWZhdWx0IEhWTVxuICAgKi9cbiAgdmlydHVhbGl6YXRpb24/OiBBbWF6b25MaW51eFZpcnQ7XG5cbiAgLyoqXG4gICAqIFdoYXQgc3RvcmFnZSBiYWNrZWQgaW1hZ2UgdG8gdXNlXG4gICAqXG4gICAqIEBkZWZhdWx0IEdlbmVyYWxQdXJwb3NlXG4gICAqL1xuICBzdG9yYWdlPzogQW1hem9uTGludXhTdG9yYWdlO1xufVxuXG4vKipcbiAqIFNlbGVjdHMgdGhlIGxhdGVzdCB2ZXJzaW9uIG9mIEFtYXpvbiBMaW51eFxuICpcbiAqIFRoZSBBTUkgSUQgaXMgc2VsZWN0ZWQgdXNpbmcgdGhlIHZhbHVlcyBwdWJsaXNoZWQgdG8gdGhlIFNTTSBwYXJhbWV0ZXIgc3RvcmUuXG4gKi9cbmV4cG9ydCBjbGFzcyBBbWF6b25MaW51eEltYWdlIGltcGxlbWVudHMgSU1hY2hpbmVJbWFnZVNvdXJjZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgZ2VuZXJhdGlvbjogQW1hem9uTGludXhHZW5lcmF0aW9uO1xuICBwcml2YXRlIHJlYWRvbmx5IGVkaXRpb246IEFtYXpvbkxpbnV4RWRpdGlvbjtcbiAgcHJpdmF0ZSByZWFkb25seSB2aXJ0dWFsaXphdGlvbjogQW1hem9uTGludXhWaXJ0O1xuICBwcml2YXRlIHJlYWRvbmx5IHN0b3JhZ2U6IEFtYXpvbkxpbnV4U3RvcmFnZTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcz86IEFtYXpvbkxpbnV4SW1hZ2VQcm9wcykge1xuICAgIHRoaXMuZ2VuZXJhdGlvbiA9IChwcm9wcyAmJiBwcm9wcy5nZW5lcmF0aW9uKSB8fCBBbWF6b25MaW51eEdlbmVyYXRpb24uQW1hem9uTGludXg7XG4gICAgdGhpcy5lZGl0aW9uID0gKHByb3BzICYmIHByb3BzLmVkaXRpb24pIHx8IEFtYXpvbkxpbnV4RWRpdGlvbi5TdGFuZGFyZDtcbiAgICB0aGlzLnZpcnR1YWxpemF0aW9uID0gKHByb3BzICYmIHByb3BzLnZpcnR1YWxpemF0aW9uKSB8fCBBbWF6b25MaW51eFZpcnQuSFZNO1xuICAgIHRoaXMuc3RvcmFnZSA9IChwcm9wcyAmJiBwcm9wcy5zdG9yYWdlKSB8fCBBbWF6b25MaW51eFN0b3JhZ2UuR2VuZXJhbFB1cnBvc2U7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRoZSBpbWFnZSB0byB1c2UgaW4gdGhlIGdpdmVuIGNvbnRleHRcbiAgICovXG4gIHB1YmxpYyBnZXRJbWFnZShzY29wZTogQ29uc3RydWN0KTogTWFjaGluZUltYWdlIHtcbiAgICBjb25zdCBwYXJ0czogQXJyYXk8c3RyaW5nfHVuZGVmaW5lZD4gPSBbXG4gICAgICB0aGlzLmdlbmVyYXRpb24sXG4gICAgICAnYW1pJyxcbiAgICAgIHRoaXMuZWRpdGlvbiAhPT0gQW1hem9uTGludXhFZGl0aW9uLlN0YW5kYXJkID8gdGhpcy5lZGl0aW9uIDogdW5kZWZpbmVkLFxuICAgICAgdGhpcy52aXJ0dWFsaXphdGlvbixcbiAgICAgICd4ODZfNjQnLCAvLyBObyAzMi1iaXRzIGltYWdlcyB2ZW5kZWQgdGhyb3VnaCB0aGlzXG4gICAgICB0aGlzLnN0b3JhZ2VcbiAgICBdLmZpbHRlcih4ID0+IHggIT09IHVuZGVmaW5lZCk7IC8vIEdldCByaWQgb2YgdW5kZWZpbmVkc1xuXG4gICAgY29uc3QgcGFyYW1ldGVyTmFtZSA9ICcvYXdzL3NlcnZpY2UvYW1pLWFtYXpvbi1saW51eC1sYXRlc3QvJyArIHBhcnRzLmpvaW4oJy0nKTtcblxuICAgIGNvbnN0IHNzbVByb3ZpZGVyID0gbmV3IFNTTVBhcmFtZXRlclByb3ZpZGVyKHNjb3BlLCB7XG4gICAgICBwYXJhbWV0ZXJOYW1lLFxuICAgIH0pO1xuICAgIGNvbnN0IGFtaSA9IHNzbVByb3ZpZGVyLnBhcmFtZXRlclZhbHVlKCk7XG4gICAgcmV0dXJuIG5ldyBNYWNoaW5lSW1hZ2UoYW1pLCBuZXcgTGludXhPUygpKTtcbiAgfVxufVxuXG4vKipcbiAqIFdoYXQgZ2VuZXJhdGlvbiBvZiBBbWF6b24gTGludXggdG8gdXNlXG4gKi9cbmV4cG9ydCBlbnVtIEFtYXpvbkxpbnV4R2VuZXJhdGlvbiB7XG4gIC8qKlxuICAgKiBBbWF6b24gTGludXhcbiAgICovXG4gIEFtYXpvbkxpbnV4ID0gJ2Ftem4nLFxuXG4gIC8qKlxuICAgKiBBbWF6b24gTGludXggMlxuICAgKi9cbiAgQW1hem9uTGludXgyID0gJ2Ftem4yJyxcbn1cblxuLyoqXG4gKiBBbWF6b24gTGludXggZWRpdGlvblxuICovXG5leHBvcnQgZW51bSBBbWF6b25MaW51eEVkaXRpb24ge1xuICAvKipcbiAgICogU3RhbmRhcmQgZWRpdGlvblxuICAgKi9cbiAgU3RhbmRhcmQgPSAnc3RhbmRhcmQnLFxuXG4gIC8qKlxuICAgKiBNaW5pbWFsIGVkaXRpb25cbiAgICovXG4gIE1pbmltYWwgPSAnbWluaW1hbCdcbn1cblxuLyoqXG4gKiBWaXJ0dWFsaXphdGlvbiB0eXBlIGZvciBBbWF6b24gTGludXhcbiAqL1xuZXhwb3J0IGVudW0gQW1hem9uTGludXhWaXJ0IHtcbiAgLyoqXG4gICAqIEhWTSB2aXJ0dWFsaXphdGlvbiAocmVjb21tZW5kZWQpXG4gICAqL1xuICBIVk0gPSAnaHZtJyxcblxuICAvKipcbiAgICogUFYgdmlydHVhbGl6YXRpb25cbiAgICovXG4gIFBWID0gJ3B2J1xufVxuXG5leHBvcnQgZW51bSBBbWF6b25MaW51eFN0b3JhZ2Uge1xuICAvKipcbiAgICogRUJTLWJhY2tlZCBzdG9yYWdlXG4gICAqL1xuICBFQlMgPSAnZWJzJyxcblxuICAvKipcbiAgICogUzMtYmFja2VkIHN0b3JhZ2VcbiAgICovXG4gIFMzID0gJ2VicycsXG5cbiAgLyoqXG4gICAqIEdlbmVyYWwgUHVycG9zZS1iYXNlZCBzdG9yYWdlIChyZWNvbW1lbmRlZClcbiAgICovXG4gIEdlbmVyYWxQdXJwb3NlID0gJ2dwMicsXG59XG5cbi8qKlxuICogQ29uc3RydWN0IGEgTGludXggbWFjaGluZSBpbWFnZSBmcm9tIGFuIEFNSSBtYXBcbiAqXG4gKiBMaW51eCBpbWFnZXMgSURzIGFyZSBub3QgcHVibGlzaGVkIHRvIFNTTSBwYXJhbWV0ZXIgc3RvcmUgeWV0LCBzbyB5b3UnbGwgaGF2ZSB0b1xuICogbWFudWFsbHkgc3BlY2lmeSBhbiBBTUkgbWFwLlxuICovXG5leHBvcnQgY2xhc3MgR2VuZXJpY0xpbnV4SW1hZ2UgaW1wbGVtZW50cyBJTWFjaGluZUltYWdlU291cmNlICB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgYW1pTWFwOiB7W3JlZ2lvbjogc3RyaW5nXTogc3RyaW5nfSkge1xuICB9XG5cbiAgcHVibGljIGdldEltYWdlKHNjb3BlOiBDb25zdHJ1Y3QpOiBNYWNoaW5lSW1hZ2Uge1xuICAgIGNvbnN0IHJlZ2lvbiA9IHNjb3BlLm5vZGUuc3RhY2sucmVxdWlyZVJlZ2lvbignQU1JIGNhbm5vdCBiZSBkZXRlcm1pbmVkJyk7XG4gICAgY29uc3QgYW1pID0gcmVnaW9uICE9PSAndGVzdC1yZWdpb24nID8gdGhpcy5hbWlNYXBbcmVnaW9uXSA6ICdhbWktMTIzNDUnO1xuICAgIGlmICghYW1pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIEFNSSBpbiBBTUkgbWFwOiBubyBBTUkgc3BlY2lmaWVkIGZvciByZWdpb24gJyR7cmVnaW9ufSdgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IE1hY2hpbmVJbWFnZShhbWksIG5ldyBMaW51eE9TKCkpO1xuICB9XG59XG5cbi8qKlxuICogVGhlIFdpbmRvd3MgdmVyc2lvbiB0byB1c2UgZm9yIHRoZSBXaW5kb3dzSW1hZ2VcbiAqL1xuZXhwb3J0IGVudW0gV2luZG93c1ZlcnNpb24ge1xuICBXaW5kb3dzU2VydmVyMjAxNlR1cmtzaWhGdWxsQmFzZSA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LVR1cmtpc2gtRnVsbC1CYXNlJyxcbiAgV2luZG93c1NlcnZlcjIwMTZTd2VkaXNoRnVsbEJhc2UgPSAnV2luZG93c19TZXJ2ZXItMjAxNi1Td2VkaXNoLUZ1bGwtQmFzZScsXG4gIFdpbmRvd3NTZXJ2ZXIyMDE2U3BhbmlzaEZ1bGxCYXNlID0gJ1dpbmRvd3NfU2VydmVyLTIwMTYtU3BhbmlzaC1GdWxsLUJhc2UnLFxuICBXaW5kb3dzU2VydmVyMjAxNlJ1c3NpYW5GdWxsQmFzZSA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LVJ1c3NpYW4tRnVsbC1CYXNlJyxcbiAgV2luZG93c1NlcnZlcjIwMTZQb3J0dWd1ZXNlUG9ydHVnYWxGdWxsQmFzZSA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LVBvcnR1Z3Vlc2VfUG9ydHVnYWwtRnVsbC1CYXNlJyxcbiAgV2luZG93c1NlcnZlcjIwMTZQb3J0dWd1ZXNlQnJhemlsRnVsbEJhc2UgPSAnV2luZG93c19TZXJ2ZXItMjAxNi1Qb3J0dWd1ZXNlX0JyYXppbC1GdWxsLUJhc2UnLFxuICBXaW5kb3dzU2VydmVyMjAxNlBvbGlzaEZ1bGxCYXNlID0gJ1dpbmRvd3NfU2VydmVyLTIwMTYtUG9saXNoLUZ1bGwtQmFzZScsXG4gIFdpbmRvd3NTZXJ2ZXIyMDE2S29yZWFuRnVsbFNRTDIwMTZCYXNlID0gJ1dpbmRvd3NfU2VydmVyLTIwMTYtS29yZWFuLUZ1bGwtU1FMXzIwMTZfU1AxX1N0YW5kYXJkJyxcbiAgV2luZG93c1NlcnZlcjIwMTZLb3JlYW5GdWxsQmFzZSA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LUtvcmVhbi1GdWxsLUJhc2UnLFxuICBXaW5kb3dzU2VydmVyMjAxNkphcGFuZXNlRnVsbFNRTDIwMTZXZWIgPSAnV2luZG93c19TZXJ2ZXItMjAxNi1KYXBhbmVzZS1GdWxsLVNRTF8yMDE2X1NQMV9XZWInLFxuICBXaW5kb3dzU2VydmVyMjAxNkphcGFuZXNlRnVsbFNRTDIwMTZTdGFuZGFyZCA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LUphcGFuZXNlLUZ1bGwtU1FMXzIwMTZfU1AxX1N0YW5kYXJkJyxcbiAgV2luZG93c1NlcnZlcjIwMTZKYXBhbmVzZUZ1bGxTUUwyMDE2RXhwcmVzcyA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LUphcGFuZXNlLUZ1bGwtU1FMXzIwMTZfU1AxX0V4cHJlc3MnLFxuICBXaW5kb3dzU2VydmVyMjAxNkphcGFuZXNlRnVsbFNRTDIwMTZFbnRlcnByaXNlID0gJ1dpbmRvd3NfU2VydmVyLTIwMTYtSmFwYW5lc2UtRnVsbC1TUUxfMjAxNl9TUDFfRW50ZXJwcmlzZScsXG4gIFdpbmRvd3NTZXJ2ZXIyMDE2SmFwYW5lc2VGdWxsQmFzZSA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LUphcGFuZXNlLUZ1bGwtQmFzZScsXG4gIFdpbmRvd3NTZXJ2ZXIyMDE2SXRhbGlhbkZ1bGxCYXNlID0gJ1dpbmRvd3NfU2VydmVyLTIwMTYtSXRhbGlhbi1GdWxsLUJhc2UnLFxuICBXaW5kb3dzU2VydmVyMjAxNkh1bmdhcmlhbkZ1bGxCYXNlID0gJ1dpbmRvd3NfU2VydmVyLTIwMTYtSHVuZ2FyaWFuLUZ1bGwtQmFzZScsXG4gIFdpbmRvd3NTZXJ2ZXIyMDE2R2VybWFuRnVsbEJhc2UgPSAnV2luZG93c19TZXJ2ZXItMjAxNi1HZXJtYW4tRnVsbC1CYXNlJyxcbiAgV2luZG93c1NlcnZlcjIwMTZGcmVuY2hGdWxsQmFzZSA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LUZyZW5jaC1GdWxsLUJhc2UnLFxuICBXaW5kb3dzU2VydmVyMjAxNkVuZ2xpc2hOYW5vQmFzZSA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LUVuZ2xpc2gtTmFuby1CYXNlJyxcbiAgV2luZG93c1NlcnZlcjIwMTZFbmdsaXNoRnVsbFNRTDIwMTdXZWIgPSAnV2luZG93c19TZXJ2ZXItMjAxNi1FbmdsaXNoLUZ1bGwtU1FMXzIwMTdfV2ViJyxcbiAgV2luZG93c1NlcnZlcjIwMTZFbmdsaXNoRnVsbFNRTDIwMTdTdGFuZGFyZCA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LUVuZ2xpc2gtRnVsbC1TUUxfMjAxN19TdGFuZGFyZCcsXG4gIFdpbmRvd3NTZXJ2ZXIyMDE2RW5nbGlzaEZ1bGxTUUwyMDE3RXhwcmVzcyA9ICdXaW5kb3dzX1NlcnZlci0yMDE2LUVuZ2xpc2gtRnVsbC1TUUxfMjAxN19FeHByZXNzJyxcbiAgV2luZG93c1NlcnZlcjIwMTZFbmdsaXNoRnVsbFNRTDIwMTdFbnRlcnByaXNlID0gJ1dpbmRvd3NfU2VydmVyLTIwMTYtRW5nbGlzaC1GdWxsLVNRTF8yMDE3X0VudGVycHJpc2UnLFxufVxuXG4vKipcbiAqIFJlcHJlc2VudGF0aW9uIG9mIGEgbWFjaGluZSB0byBiZSBsYXVuY2hlZFxuICpcbiAqIENvbWJpbmVzIGFuIEFNSSBJRCB3aXRoIGFuIE9TLlxuICovXG5leHBvcnQgY2xhc3MgTWFjaGluZUltYWdlIHtcbiAgY29uc3RydWN0b3IocHVibGljIHJlYWRvbmx5IGltYWdlSWQ6IHN0cmluZywgcHVibGljIHJlYWRvbmx5IG9zOiBPcGVyYXRpbmdTeXN0ZW0pIHtcbiAgfVxufVxuXG4vKipcbiAqIFRoZSBPUyB0eXBlIG9mIGEgcGFydGljdWxhciBpbWFnZVxuICovXG5leHBvcnQgZW51bSBPcGVyYXRpbmdTeXN0ZW1UeXBlIHtcbiAgTGludXgsXG4gIFdpbmRvd3MsXG59XG5cbi8qKlxuICogQWJzdHJhY3Rpb24gb2YgT1MgZmVhdHVyZXMgd2UgbmVlZCB0byBiZSBhd2FyZSBvZlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgT3BlcmF0aW5nU3lzdGVtIHtcbiAgcHVibGljIGFic3RyYWN0IGNyZWF0ZVVzZXJEYXRhKHNjcmlwdHM6IHN0cmluZ1tdKTogc3RyaW5nO1xuICBhYnN0cmFjdCBnZXQgdHlwZSgpOiBPcGVyYXRpbmdTeXN0ZW1UeXBlO1xufVxuXG4vKipcbiAqIE9TIGZlYXR1cmVzIHNwZWNpYWxpemVkIGZvciBXaW5kb3dzXG4gKi9cbmV4cG9ydCBjbGFzcyBXaW5kb3dzT1MgZXh0ZW5kcyBPcGVyYXRpbmdTeXN0ZW0ge1xuICBwdWJsaWMgY3JlYXRlVXNlckRhdGEoc2NyaXB0czogc3RyaW5nW10pOiBzdHJpbmcge1xuICAgIHJldHVybiBgPHBvd2Vyc2hlbGw+JHtzY3JpcHRzLmpvaW4oJ1xcbicpfTwvcG93ZXJzaGVsbD5gO1xuICB9XG5cbiAgZ2V0IHR5cGUoKTogT3BlcmF0aW5nU3lzdGVtVHlwZSB7XG4gICAgcmV0dXJuIE9wZXJhdGluZ1N5c3RlbVR5cGUuV2luZG93cztcbiAgfVxufVxuXG4vKipcbiAqIE9TIGZlYXR1cmVzIHNwZWNpYWxpemVkIGZvciBMaW51eFxuICovXG5leHBvcnQgY2xhc3MgTGludXhPUyBleHRlbmRzIE9wZXJhdGluZ1N5c3RlbSB7XG4gIHB1YmxpYyBjcmVhdGVVc2VyRGF0YShzY3JpcHRzOiBzdHJpbmdbXSk6IHN0cmluZyB7XG4gICAgcmV0dXJuICcjIS9iaW4vYmFzaFxcbicgKyBzY3JpcHRzLmpvaW4oJ1xcbicpO1xuICB9XG5cbiAgZ2V0IHR5cGUoKTogT3BlcmF0aW5nU3lzdGVtVHlwZSB7XG4gICAgcmV0dXJuIE9wZXJhdGluZ1N5c3RlbVR5cGUuTGludXg7XG4gIH1cbn1cbiJdfQ==